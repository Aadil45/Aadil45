(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1053:function(x,C,b){function a(fa){var Ca=this;fa=void 0===fa?null:fa;this.hT=0;this.oP=null;this.zug=0;var Sa=pa.a.Ce();this.Ypg=this.Sdh(fa).then(function(Gb){return Gb?Ca.O8h():(t.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",Ca.nv(),Math.floor(pa.a.Ce()-Sa)),Gb=ma.a.Xr(),void 0!==Gb&&null!==Gb&&(Gb.set("AuthLibrary",Ca.nv()),Gb=Object.assign(new va.a,
{durationMs:Math.floor(pa.a.Ce()-Sa),extendedProperties:Gb}),ka.Health.instance.recordKpiFailure(a.kpiName,"StrategyPickFailed",!1,!0,Gb)),Promise.resolve(1))}).then(function(Gb){return 0!==Gb?Promise.resolve(Gb):Ca.Yri()})}function c(fa){this.EPc=fa;this.JXa="UnsupportedAuthTokenStrategy Reason="+E.a[this.EPc]}function e(){this.Ns=null;this.eTb=0;this.Xjb=this.XXa=this.tFc=this.KDa=this.fM=this.sie=null;this.Xv=new W.a(null,null);this.NXb=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",
!1);this.JXa="SharedAuthTokenStrategy "+(this.NXb?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.wY=Q.a.uuj;this.uge=Q.a.tuj;this.Q5d=Q.a.enableConsoleLogging;this.Dng=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.iwg=M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.NXb);this.Uqa={};this.iqg=new m(1500)}function f(fa,Ca,Sa,Gb,kb,lb,Nb){var Aa=
Z.call(this,!1,!1,!0)||this;Aa.I1=null;Aa.e5d=null;Aa.wY=fa;Aa.Qtg=Sa;Aa.Xv=Gb;Aa.Jxg=kb;Aa.KDa=lb;Aa.Ns=document.createElement("iframe");Aa.Ns.id="SharedAuthInteractiveFrame";Aa.Ns.setAttribute("name","SharedAuthInteractiveFrame");Aa.Ns.setAttribute("title","SharedAuthInteractiveFrame");Aa.Ns.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");Aa.Ns.style.border="0";Aa.Ns.style.height="48px";Aa.Ns.style.width="190px";$addHandler(Aa.Ns,"error",Object(ca.a)(Aa,Aa.mRi,
"onSharedAuthFrameError"));fa=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",Aa.wY,Ca,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",M.AFrameworkApplication.userType);Nb&&(fa+="&vnext=1");Aa.Ns.src=fa;Aa.ing=new Promise(function(qa){Aa.e5d=qa});Aa.f5d=!1;return Aa}function l(){this.correlationId=this.resolve=null}function m(fa){fa=void 0===fa?0:fa;this.XB=0;this.Nkb=!1;this.Dm=new aa.a;this._timeout=fa}function r(){this.reject=this.resolve=null;this.startTime=
0;this.jJf=this.cte=null}function h(){this.tje=null;var fa=M.AFrameworkApplication.ga.Ua(M.AFrameworkApplication.sea),Ca=M.AFrameworkApplication.ga.Ua(M.AFrameworkApplication.Aag);this.JXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",fa&&""!==fa?fa:"Unspecified",Ca&&""!==Ca?Ca:"Unspecified")}function w(fa,Ca,Sa,Gb,kb){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=fa;this.scope=Ca;this.silentLogin=Sa;this.options=
Gb;this.correlationId=kb}function n(){}function v(fa){this.ksg=fa}function u(){}b.r(C);x=b(0);var t=b(14),y=b(904),E=b(1127),B;(function(fa){fa[fa.external=0]="external";fa[fa.msa=1]="msa";fa[fa.aad=2]="aad"})(B||(B={}));Object(x.b)("AuthorityType",B);Object(x.a)(u,"OAuthResult",null,[]);v.prototype.initialize=function(){return Promise.resolve(0)};v.prototype.Wjc=function(){return Promise.resolve(0)};v.prototype.US=function(){t.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");
return Promise.resolve(Object.assign(new u,{IsSuccess:!0,Token:this.ksg}))};v.prototype.VAc=function(){return Promise.resolve(Object.assign(new u,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};v.prototype.szc=function(){return!1};v.prototype.nwb=function(){return"MockAuthTokenStrategy"};Object(x.a)(v,"MockAuthTokenStrategy",null,[838]);var z=b(1152);n.get=function(fa,Ca,Sa){if(!Sa)return fa;
var Gb=0;return Promise.race([fa,new Promise(function(kb){Gb=window.setTimeout(function(){kb(Ca)},Sa)})]).then(function(kb){window.clearTimeout(Gb);return Promise.resolve(kb)}).catch(function(){window.clearTimeout(Gb);return Promise.resolve(Ca)})};Object(x.a)(n,"PromiseWithTimeout",null,[]);var M=b(4),Q=b(942);Object(x.a)(w,"TokenRequestParameters",null,[630]);var P=b(24),L=b(85);h.prototype.initialize=function(){var fa=this;return new Promise(function(Ca){L.a.instance.lc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Sa){fa.tje=
Sa;Ca(0)})})};h.prototype.zi=function(fa){for(var Ca=!1,Sa=fa.toLocaleUpperCase(),Gb=El(["HTTPS:","API:"]),kb=Gb.next();!kb.done;kb=Gb.next())if(Sa.startsWith(kb.value)){Ca=!0;break}return Ca||this.dii(fa)?fa+"/.default":fa};h.prototype.dii=function(fa){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(fa)};h.prototype.Wjc=function(){return Promise.resolve(0)};h.prototype.US=function(fa,Ca,Sa,Gb,kb,lb,Nb){if(P.a.Nka){kb=Q.a.RVj;if(!kb)return Ca=Object.assign(new u,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(Ca);if(!Array.contains(kb,fa))return Ca=Object.assign(new u,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+fa}),Promise.resolve(Ca)}fa=this.zi(Sa);Sa=new w(Sa,fa,!Gb,null,M.AFrameworkApplication.userSessionId);return this.tje.getAccessToken(Sa,Ca,Nb).then(function(Aa){return Object.assign(new u,{IsSuccess:!0,Token:Aa.accessToken})},function(Aa){return Object.assign(new u,
{IsSuccess:!1,ErrorCode:Aa})})};h.prototype.VAc=function(){return Promise.resolve(Object.assign(new u,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};h.prototype.szc=function(){return!1};h.prototype.nwb=function(){return this.JXa};Object(x.a)(h,"ParentFrameTokenStrategy",null,[838]);var ca=b(82),U=b(1060),aa=b(202);Object(x.a)(r,"PromiseWrapper",null,[]);m.prototype.enqueue=function(fa){var Ca=
this;return new Promise(function(Sa,Gb){Ca.Dm.add(Object.assign(new r,{jJf:fa,resolve:Sa,reject:Gb}));Ca.process()})};m.prototype.process=function(){var fa=this;if(this.Nkb||this.XB===this.Dm.count)return!1;var Ca=this.Dm.oa(this.XB++);try{this.Nkb=!0,Ca.jJf().then(function(Sa){fa.Nkb=!1;fa.Z1c(Ca,Sa,null,!0)}).catch(function(Sa){fa.Nkb=!1;fa.Z1c(Ca,null,Sa,!1)})}catch(Sa){this.Nkb=!1,this.Z1c(Ca,null,Sa,!1)}return!0};m.prototype.Z1c=function(fa,Ca,Sa,Gb){var kb=this;Gb?0<this._timeout?window.setTimeout(function(){fa.resolve(Ca);
kb.process()},this._timeout):(fa.resolve(Ca),kb.process()):0<this._timeout?window.setTimeout(function(){fa.reject(Sa);kb.process()},this._timeout):(fa.reject(Sa),kb.process())};Object(x.a)(m,"PromiseQueue",null,[]);Object(x.a)(l,"ResolveWithCorrelation",null,[]);var F=b(83),D=b(149),J=b(1029),R=b(168),Z=D.a;Am(f,Z);f.prototype.Ixc=function(){var fa={};fa=(fa.promptMessage=this.Qtg,fa.errorText=CommonUIStrings.l_InternalError,fa.rtl=M.AFrameworkApplication.isRtl,fa.frameLoaded=!1,fa.createFrame=Object(ca.a)(this,
this.k6g,"createFrame"),fa.resolveDialogStyles=this.e5d,fa);var Ca={};this.I1=(Ca.id="SharedAuthConsentDialog",Ca.bodyControls=fa,Ca);this.jc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(ca.a)(this,this.suj,"sharedAuthConsentDialogHandler"),this.I1)};f.prototype.fCc=function(fa,Ca,Sa){fa=void 0===fa?!1:fa;Ca=void 0===Ca?!1:Ca;Sa=void 0===Sa?5:Sa;this.I1&&this.I1.bodyControls&&(fa!==Object(F.a)(Object,this.I1.bodyControls).frameLoaded&&(Object(F.a)(Object,this.I1.bodyControls).frameLoaded=
fa),Ca!==Object(F.a)(Object,this.I1.bodyControls).frameLoadSuccess&&(Object(F.a)(Object,this.I1.bodyControls).frameLoadSuccess=Ca),Sa!==this.I1.dialogButtonsOption&&(this.I1.dialogButtonsOption=null,this.jc=Sa),this.update(this.I1))};f.prototype.JAj=function(fa,Ca){var Sa=new J.a(R.a.wuj),Gb={};fa=(Gb.signInLabel=CommonUIStrings.l_SignIn,Gb.cancelLabel=CommonUIStrings.l_DialogCancel,Gb.rtl=M.AFrameworkApplication.isRtl,Gb.messageCorrelationId=fa,Gb.dialogStyles=Ca,Gb);Sa.Values=fa;this.Xv.mRa(Sa,
this.Ns.contentWindow,this.wY)};f.prototype.CUe=function(){this.fCc(!0,!1,6)};f.prototype.mRi=function(){this.CUe()};f.prototype.k6g=function(){return this.Ns};f.prototype.suj=function(fa){0===fa&&(this.Jxg.reject(Object.assign(new u,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.KDa(null))};Ek.Object.defineProperties(f.prototype,{E0f:{configurable:!0,enumerable:!0,get:function(){return this.Ns}},Feh:{configurable:!0,enumerable:!0,get:function(){var fa=
this;return this.ing.then(function(Ca){fa.f5d=!0;return Ca})}},Geh:{configurable:!0,enumerable:!0,get:function(){return this.f5d}}});Object(x.a)(f,"SharedAuthConsentDialog",D.a,[854]);var W=b(1317),ka=b(100),ma=b(134),pa=b(39),xa=b(176),va=b(356);e.prototype.nwb=function(){return this.JXa};e.prototype.initialize=function(){var fa=b(1053).OAuthManager;if("loadFrame"in this.Uqa)return this.Uqa.loadFrame.cte;if(!this.wY)return ka.Health.instance.recordKpiFailure(fa.kpiName,"SharedAuthFrameOriginNotSet",
!1,!1,null),t.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);fa=this.bzc("loadFrame");this.eTb=pa.a.Ce();var Ca=this.wY+this.uge+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+M.AFrameworkApplication.userSessionId+"&WacUserType="+M.AFrameworkApplication.userType;this.NXb&&(Ca+="&vnext=1");this.Ns=document.createElement("iframe");this.v$h(this.Ns);this.Ns.style.cssText="height:0;width:0;display:none;";
this.Ns.id="SharedAuthFrame";this.Ns.setAttribute("name","SharedAuthFrame");this.Ns.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Ns.setAttribute("title","SharedAuthFrame");this.Ns.src=Ca;document.body.appendChild(this.Ns);Ca=pa.a.Ce()-this.eTb;t.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",Ca,this.Ns.src);return fa};e.prototype.Wjc=function(fa){this.tFc=fa;var Ca=new J.a(R.a.H0f);
Ca.Values=this.Ese(fa);fa=this.bzc("initFrame");this.Xv.mRa(Ca,this.Ns.contentWindow,this.wY);t.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return fa};e.prototype.US=function(fa,Ca,Sa,Gb,kb,lb){var Nb=this,Aa=new J.a(R.a.xuj),qa=this.w1e();Aa.Values=this.U$f(fa,Ca,Sa,Gb,kb,lb,qa);fa=this.bzc(qa);Gb&&M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.iqg.enqueue(function(){return new Promise(function(Xa){Nb.DMj(lb,
Aa,Xa,qa)})}):(this.Xv.mRa(Aa,this.Ns.contentWindow,this.wY),t.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",Ca));return fa};e.prototype.DMj=function(fa,Ca,Sa,Gb){var kb=this.Uqa[Gb];kb&&(this.XXa=Ca,this.KDa=Object.assign(new l,{resolve:Sa,correlationId:Gb}),this.fM=new f(this.wY,this.uge,fa,this.Xv,kb,Sa,this.NXb),this.fM.Ixc())};e.prototype.w1e=function(){return xa.a.create().toString()};e.prototype.U$f=function(fa,Ca,Sa,Gb,kb,lb,Nb){var Aa=
{};Aa.appName=fa;Aa.appId=Ca;Aa.target=Sa;Aa.withPopup=Gb;Aa.claims=kb;Aa.promptMessage=lb;Aa.messageCorrelationId=Nb;return Aa};e.prototype.v$h=function(fa){$addHandler(fa,"load",Object(ca.a)(this,this.nMi,"onIFrameLoaded"));$addHandler(fa,"error",Object(ca.a)(this,this.unc,"onIFrameError"));this.Xv.zFa(this.wY);this.Xv.io(R.a.K0f);this.Xv.Rl(R.a.K0f,Object(ca.a)(this,this.GQi,"onScriptLoaded"));this.Xv.io(R.a.J0f);this.Xv.Rl(R.a.J0f,Object(ca.a)(this,this.FQi,"onScriptInitialized"));this.Xv.io(R.a.F0f);
this.Xv.Rl(R.a.F0f,Object(ca.a)(this,this.PLi,"onGetTokenResponse"));this.Xv.io(R.a.L0f);this.Xv.Rl(R.a.L0f,Object(ca.a)(this,this.GNi,"onLoginResponse"));this.Xv.io(R.a.I0f);this.Xv.Rl(R.a.I0f,Object(ca.a)(this,this.HMi,"onInteractiveFlowReady"));this.Xv.io(R.a.G0f);this.Xv.Rl(R.a.G0f,Object(ca.a)(this,this.gMi,"onHideDialog"));this.Xv.io(R.a.D0f);this.Xv.Rl(R.a.D0f,Object(ca.a)(this,this.lHi,"onCloseDialog"))};e.prototype.bzc=function(fa){var Ca=new r;Ca.startTime=pa.a.Ce();var Sa=new Promise(function(Gb,
kb){Ca.resolve=Gb;Ca.reject=kb});Ca.cte=Sa;this.Uqa[fa]=Ca;return Sa};e.prototype.nMi=function(){var fa=pa.a.Ce()-this.eTb;t.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",fa)};e.prototype.unc=function(fa){var Ca=b(1053).OAuthManager,Sa=pa.a.Ce()-this.eTb,Gb=Object.assign(new va.a,{durationMs:Sa});ka.Health.instance.recordKpiFailure(Ca.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,Gb);t.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",
Sa,this.Q5d?JSON.stringify(fa):"")};e.prototype.GQi=function(fa){var Ca=b(1053).OAuthManager,Sa=this.Uqa.loadFrame,Gb=pa.a.Ce()-Sa.startTime,kb=fa.Values.AuthLibrary.toString();fa=fa.Values.Success.toString();t.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",fa,kb,Gb);kb&&(this.JXa="SharedAuthTokenStrategy "+kb);kb=Boolean.parse(fa);kb||(fa=ma.a.Xr(),void 0!==fa&&null!==fa&&(fa.set("AuthLibrary",this.nwb()),Gb=Object.assign(new va.a,
{durationMs:Gb,extendedProperties:fa}),ka.Health.instance.recordKpiFailure(Ca.kpiName,"SharedAuthStrategyInitFailed",!1,!0,Gb)));Sa.resolve(kb?0:1)};e.prototype.FQi=function(fa){var Ca=this;if(fa.Values.interactive&&this.XXa&&this.XXa.Values.messageCorrelationId){var Sa=this.XXa.Values.messageCorrelationId.toString();if(fa.Values.interactive&&this.fM){this.fM.Feh.then(function(kb){Ca.Xv.mRa(Ca.XXa,Ca.fM.E0f.contentWindow,Ca.wY);Ca.fM.JAj(Sa,kb);Ca.fM.fCc(!0,!0);Ca.XXa=null});return}}fa=this.Uqa.initFrame;
var Gb=pa.a.Ce()-fa.startTime;t.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",Gb);fa.resolve(0)};e.prototype.PLi=function(fa){if(fa.Values.messageCorrelationId&&fa.Values.messageCorrelationId.toString()){var Ca=fa.Values.messageCorrelationId.toString(),Sa=this.Uqa[Ca];if(Sa){var Gb=pa.a.Ce()-Sa.startTime;t.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",Gb);fa.Values.isSuccess&&fa.Values.isSuccess?Sa.resolve(fa.Values.response):
Sa.reject(fa.Values.response);this.iag(Ca)}else t.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};e.prototype.HMi=function(){if(this.fM.Geh)this.fM.CUe();else if(this.tFc&&this.fM){var fa=new J.a(R.a.H0f);fa.Values=this.Ese(this.tFc,!0);this.Xv.mRa(fa,this.fM.E0f.contentWindow,this.wY)}};e.prototype.gMi=
function(){this.fM&&this.fM.wxb()};e.prototype.lHi=function(fa){fa.Values.cancelled&&fa.Values.cancelled&&fa.Values.messageCorrelationId&&this.iag(fa.Values.messageCorrelationId.toString());this.fM&&this.fM.hide()};e.prototype.Ese=function(fa,Ca){Ca=void 0===Ca?!1:Ca;var Sa={};Sa.appIds=this.qIh();Sa.upn=fa.loginHint;Sa.authority=fa.authority;Sa.authorityType=Object(y.a)(B,fa.authorityType);Sa.tenantId=fa.tenantId;Sa.correlationId=M.AFrameworkApplication.userSessionId;Sa.enableConsoleLogging=this.Q5d;
Sa.enablePopupFlash=this.Dng;Sa.skipUpnCheck=this.iwg;Sa.interactive=Ca;return Sa};e.prototype.qIh=function(){var fa=[],Ca=Q.a.AWc,Sa;for(Sa in Ca)Array.add(fa,Ca[Sa]);return fa};e.prototype.VAc=function(fa,Ca,Sa,Gb,kb,lb){var Nb=new J.a(R.a.vuj),Aa=this.w1e();Nb.Values=this.U$f(fa,Ca,Sa,Gb,kb,lb,Aa);this.sie=Nb;fa=this.bzc(Aa);t.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",Ca);this.qyj();return fa};e.prototype.szc=function(){return!0};e.prototype.qyj=
function(){var fa=this;this.Xjb||(this.Xjb=new U.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Xjb.id=16,this.Xjb.yef=!1,this.Xjb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){t.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");fa.Xv.mRa(fa.sie,fa.Ns.contentWindow,fa.wY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),t.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};
e.prototype.GNi=function(fa){if(fa.Values.messageCorrelationId&&fa.Values.messageCorrelationId.toString()){var Ca=this.Uqa[fa.Values.messageCorrelationId.toString()];if(Ca){var Sa=pa.a.Ce()-Ca.startTime;t.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Sa);fa.Values.isSuccess&&fa.Values.isSuccess?Ca.resolve(fa.Values.response):Ca.reject(fa.Values.response)}else t.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else t.ULS.sendTraceTag(555049439,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};e.prototype.iag=function(fa){this.KDa&&this.KDa.correlationId===fa&&(this.KDa.resolve(null),this.KDa=null)};Object(x.a)(e,"SharedAuthTokenStrategy",null,[838]);c.prototype.initialize=function(){return Promise.resolve(0)};c.prototype.Wjc=function(){return Promise.resolve(0)};c.prototype.US=function(){return Promise.resolve(Object.assign(new u,{IsSuccess:!1,ErrorCode:E.a[this.EPc],ErrorMessage:"Unable to get a token. Reason: ["+
E.a[this.EPc]+"]"}))};c.prototype.VAc=function(){return Promise.resolve(Object.assign(new u,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};c.prototype.szc=function(){return!1};c.prototype.nwb=function(){return this.JXa};Object(x.a)(c,"UnsupportedAuthTokenStrategy",null,[838]);var ta=b(935);b.d(C,"OAuthManager",function(){return a});a.prototype.Tdh=function(){var fa=Q.a.mAi;fa&&0<fa.length?
(this.hT=1,this.oP=new v(fa)):M.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||M.AFrameworkApplication.ga.ra("IsO365CommercialHost")?M.AFrameworkApplication.ga.ra("IsAnonymousUser")?(this.hT=2,this.oP=new c(this.hT)):(fa=z.a.getAuthContext().loginHint)&&fa.length?Q.a.Axb?(this.hT=1,this.oP=new h):(this.hT=1,this.oP=new e):(this.hT=3,this.oP=new c(this.hT)):(this.hT=4,this.oP=new c(this.hT))};a.prototype.nv=function(){return this.oP?this.oP.nwb()||"Unknown":"None"};a.prototype.Sdh=function(fa){var Ca=
this;fa=void 0===fa?null:fa;t.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Sa=pa.a.Ce();return M.AFrameworkApplication.ga.Eed().then(function(Gb){Gb?(Ca.Tdh(),fa&&(Ca.oP=fa),t.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",Q.a.clientVersion,Q.a.appVersion,Q.a.Pgh,Ca.nv(),Math.floor(pa.a.Ce()-Sa))):t.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",
Math.floor(pa.a.Ce()-Sa));return Promise.resolve(Gb)},function(){t.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(pa.a.Ce()-Sa));return Promise.resolve(!1)})};a.prototype.O8h=function(){var fa=this;t.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.nv());var Ca=pa.a.Ce();return n.get(this.oP.initialize(),2,Q.a.PFd).then(function(Sa){if(0===Sa)t.ULS.sendTraceTag(42084353,3E3,
50,"Initialization succeeded for {0} in {1} ms.",fa.nv(),Math.floor(pa.a.Ce()-Ca));else if(1===Sa){t.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",fa.nv(),Math.floor(pa.a.Ce()-Ca));var Gb=ma.a.Xr();void 0!==Gb&&null!==Gb&&(Gb.set("AuthLibrary",fa.nv()),Gb=Object.assign(new va.a,{durationMs:Math.floor(pa.a.Ce()-Ca),extendedProperties:Gb}),ka.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,Gb))}else 2===
Sa&&(t.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",fa.nv(),Math.floor(pa.a.Ce()-Ca)),Gb=ma.a.Xr(),void 0!==Gb&&null!==Gb&&(Gb.set("AuthLibrary",fa.nv()),Gb=Object.assign(new va.a,{durationMs:Math.floor(pa.a.Ce()-Ca),extendedProperties:Gb}),ka.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,Gb)));return Promise.resolve(Sa)},function(){t.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",
fa.nv(),Math.floor(pa.a.Ce()-Ca));return Promise.resolve(1)})};a.prototype.Yri=function(){var fa=this;t.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.nv());var Ca=pa.a.Ce();return n.get(this.oP.Wjc(z.a.getAuthContext()),2,Q.a.PFd).then(function(Sa){if(0===Sa)t.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",fa.nv(),Math.floor(pa.a.Ce()-Ca));else if(1===Sa){t.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
fa.nv(),Math.floor(pa.a.Ce()-Ca));var Gb=ma.a.Xr();void 0!==Gb&&null!==Gb&&(Gb.set("AuthLibrary",fa.nv()),Gb=Object.assign(new va.a,{durationMs:Math.floor(pa.a.Ce()-Ca),extendedProperties:Gb}),ka.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadFailed",!1,!0,Gb))}else 2===Sa&&(t.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",fa.nv(),Math.floor(pa.a.Ce()-Ca)),Gb=ma.a.Xr(),void 0!==Gb&&null!==Gb&&(Gb.set("AuthLibrary",fa.nv()),
Gb=Object.assign(new va.a,{durationMs:Math.floor(pa.a.Ce()-Ca),extendedProperties:Gb}),ka.Health.instance.recordKpiFailure(a.kpiName,"StrategyLoadTimedOut",!1,!0,Gb)));return Promise.resolve(Sa)},function(){t.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",fa.nv(),Math.floor(pa.a.Ce()-Ca));return Promise.resolve(1)})};a.prototype.US=function(fa,Ca,Sa){return this.TAc(fa,Ca,!1,null,"",void 0===Sa?null:Sa)};a.prototype.V$f=function(fa,
Ca,Sa,Gb,kb){return this.TAc(fa,Ca,!0,Sa,Gb,void 0===kb?null:kb)};a.prototype.TAc=function(fa,Ca,Sa,Gb,kb,lb,Nb){Nb=void 0===Nb?0:Nb;Nb+=1;t.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",fa,this.XQa(fa,Ca),this.nv(),Nb);var Aa=ma.a.Xr();void 0!==Aa&&null!==Aa&&(Aa.set("AuthLibrary",this.nv()),Aa.set("AppName",fa),Aa.set("Target",this.XQa(fa,Ca)),ka.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",Aa));if(!Q.a.isEnabled){var qa;
return this.hud((qa=new u,qa.IsSuccess=!1,qa.Token=null,qa.ErrorCode="NotEnabled",qa.ErrorMessage="OAuthManager is disabled.",qa),fa)}var Xa=Q.a.AWc[fa];if(void 0===Xa||null===Xa){t.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",fa);var Ha;return this.hud((Ha=new u,Ha.IsSuccess=!1,Ha.Token=null,Ha.ErrorCode="DisallowedApp",Ha.ErrorMessage="Disallowed appName: "+fa,Ha),fa)}var Ra=pa.a.Ce(),mb=this;Aa=this.Ypg.then(function(gb){return mb.Adi(fa,
Xa,Ca,Sa,Gb,kb,lb,gb)});qa=Sa?0:Q.a.PFd;var La;Ha=(La=new u,La.IsSuccess=!1,La.Token=null,La.ErrorCode="authTokenStrategy_timeout",La.ErrorMessage="Auth Strategy timed out after ["+qa+"] ms when fetching token",La);var ha=this,Ia=this;return n.get(Aa,Ha,qa).then(function(gb){return Nb<=a.Syi&&(gb.ErrorCode===a.g9f||gb.ErrorCode===a.mFj)?(t.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Nb,Math.floor(pa.a.Ce()-Ra)),ha.TAc(fa,Ca,Sa,Gb,kb,lb,Nb)):gb.ErrorCode===
a.Whf&&!Sa&&(t.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Nb,a.RKe),a.$jh&&ha.oP.szc()&&ha.oP.VAc(fa,Xa,Ca,Sa,Gb,kb).then(function(Sb){return Promise.resolve(ha.nkc(Sb,fa,Ca,Xa,Ra))}).catch(function(){var Sb,wc=(Sb=new u,Sb.IsSuccess=!1,Sb.Token=null,Sb.ErrorCode="authTokenStrategy_failure",Sb.ErrorMessage="LoginPopup failed, GetToken could not be called",Sb);return Promise.resolve(ha.nkc(wc,fa,Ca,Xa,Ra))}),a.RKe)?ha.TAc(fa,
Ca,!0,Gb,kb,lb,Nb):Promise.resolve(ha.nkc(gb,fa,Ca,Xa,Ra))}).catch(function(){var gb,Sb=(gb=new u,gb.IsSuccess=!1,gb.Token=null,gb.ErrorCode="authTokenStrategy_failure",gb.ErrorMessage="Auth Strategy failed with an unknown error",gb);return Promise.resolve(Ia.nkc(Sb,fa,Ca,Xa,Ra))})};a.prototype.Adi=function(fa,Ca,Sa,Gb,kb,lb,Nb,Aa){var qa=this;return 1===Aa||2===Aa?this.hud(Object.assign(new u,{IsSuccess:!1,Token:null,ErrorCode:1===Aa?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),
fa):this.oP.US(fa,Ca,Sa,Gb,kb,lb,Nb).then(function(Xa){return Promise.resolve(qa.Brf(Xa,!0,fa))}).catch(function(Xa){return Promise.resolve(qa.Brf(Xa,!1,fa))})};a.prototype.nkc=function(fa,Ca,Sa,Gb,kb){var lb={};kb=pa.a.Ce()-kb;lb.IsSuccess=fa.IsSuccess;lb.ErrorCode=fa.IsSuccess?"Success":fa.ErrorCode||"";lb.ErrorMessage=fa.IsSuccess?"Success":this.XQa(Ca,fa.ErrorMessage||"");lb.Target=this.XQa(Ca,Sa||"");lb.TimeInMS=Math.floor(kb);lb.AuthLibrary=this.nv();lb.AppName=Ca;lb.AuthorityType=Object(y.a)(B,
z.a.iac());lb.UserType=this.l_h(z.a.getAuthContext());lb.IsAuthSupportedInSession=E.a[this.hT];lb.RequestCount=++this.zug;lb.AppId=Gb;t.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(lb));fa.IsSuccess||(Sa=ma.a.Xr(),void 0!==Sa&&null!==Sa&&(Sa.set("AppName",Ca),Sa.set("AuthLibrary",this.nv()),Sa.set("ErrorCode",fa.ErrorCode),Sa.set("ErrorMessage",this.XQa(Ca,fa.ErrorMessage)),Ca=Object.assign(new va.a,{durationMs:kb,extendedProperties:Sa}),ka.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",
!1,!0,Ca)));return fa};a.prototype.hud=function(fa,Ca){t.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",Ca,this.XQa(Ca,fa.ErrorMessage));var Sa=ma.a.Xr();void 0!==Sa&&null!==Sa&&(Sa.set("AppName",Ca),Sa.set("AuthLibrary",this.nv()),Sa.set("ErrorCode",fa.ErrorCode),Sa.set("ErrorMessage",this.XQa(Ca,fa.ErrorMessage)),Ca=Object.assign(new va.a,{extendedProperties:Sa}),ka.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",
!1,!0,Ca));return Promise.resolve(fa)};a.prototype.ddf=function(fa){return fa===ta.a.dAc};a.prototype.XQa=function(fa,Ca){return this.ddf(fa)&&Ca?"REDACTED":Ca};a.prototype.l_h=function(fa){return M.AFrameworkApplication.ga.ra("IsAnonymousUser")?"anonymous":!fa.loginHint||1>fa.loginHint.length?"empty":-1<fa.loginHint.indexOf("guest#")?"guest":-1<fa.loginHint.indexOf("ext#")?"external":0>fa.upn.indexOf("@")?"no-at":"supported"};a.prototype.V5a=function(){return 1===this.hT};a.prototype.Brf=function(fa,
Ca,Sa){var Gb=null,kb=null,lb=null,Nb=null;fa?fa.ErrorCode||fa.ErrorMessage?(kb=fa.ErrorCode?fa.ErrorCode:a.aRe,lb=fa.ErrorMessage?fa.ErrorMessage:"No message"):fa.Token?Ca?Gb=fa.Token:(kb=a.U8i,lb="A rejected promise returned a token."):(kb=a.aRe,lb=JSON.stringify(fa)):(kb=a.MCi,lb="No result came from Auth Token Strategy");fa&&fa.Telemetry&&!this.ddf(Sa)&&(Nb=fa.Telemetry,t.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Nb)));if(kb===a.yAi||kb===a.WJj)kb=a.g9f,lb="Auth Library Timed Out";kb===
a.pMg&&-1<lb.indexOf(a.zyg)&&(kb=a.Whf);if(kb||lb)Gb=null;return Object.assign(new u,{IsSuccess:!!Gb,Token:Gb,ErrorCode:kb,ErrorMessage:lb,Telemetry:Nb})};Ek.Object.defineProperties(a,{RKe:{configurable:!0,enumerable:!0,get:function(){return M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}},$jh:{configurable:!0,enumerable:!0,get:function(){return M.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}});a.WJj="token_renewal_error";a.aRe="Exception";a.MCi="NoResult";a.U8i="RejectToken";a.yAi="monitor_window_timeout";a.g9f="Timeout";a.mFj="authTokenStrategy_timeout";a.pMg="login_required";a.zyg="AADSTS50058";a.Whf="Cookies Disabled";a.kpiName="OAuthManager";a.Syi=2;Object(x.a)(a,"OAuthManager",null,[807])},1127:function(x,C,b){b.d(C,"a",function(){return a});x=b(0);var a;(function(c){c[c.unknown=0]="unknown";c[c.supported=1]="supported";c[c.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
c[c.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";c[c.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(x.b)("SupportStatus",a)},1464:function(x,C,b){function a(aa){var F=U.call(this)||this;F.$=aa;F.Tb();return F}function c(aa){this.oAuthManager=aa}function e(){}function f(aa){this.OUb=aa}function l(){}function m(){}b.r(C);x=b(0);var r=b(14),h=b(1053),w=b(1127),n=b(4),v=b(100),u=b(942),t=b(255),y=b(39),E=b(24),B=b(85),z=b(356);m.prototype.ei=function(aa){aa.register(807,"Common.App.OAuth.IOAuthManager").Hc().Oc(function(){return new h.OAuthManager})};
m.prototype.init=function(){var aa=B.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.nNj(aa)};m.prototype.nNj=function(aa){var F=n.AFrameworkApplication.ga.Ua("FileSource");if(n.AFrameworkApplication.ga.ra("IsO365ConsumerHost")||n.AFrameworkApplication.ga.ra("IsO365CommercialHost")||"WopiTest"===F){var D=u.a.zEh,J=u.a.authority;if(void 0!==D&&null!==D&&D.length&&void 0!==J&&null!==J&&J.length){var R=w.a[aa.hT],Z=E.a.DGa,W=aa.nv();try{var ka=new Map;void 0!==ka&&null!==ka?(ka.set("SupportStatus",
R),ka.set("Browser",Z),ka.set("AuthStrategy",W)):ka=null}catch(pa){ka=null}v.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",ka);var ma=y.a.Ce();aa.US("Core",D).then(function(pa){var xa=Math.floor(y.a.Ce()-ma);R=w.a[aa.hT];Z=E.a.DGa;W=aa.nv();r.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',xa,pa.IsSuccess,R,pa.ErrorCode,
F,Z,W);ka&&(ka.set("SupportStatus",R),ka.set("Browser",Z),ka.set("AuthStrategy",W));xa=Object.assign(new z.a,{durationMs:xa,extendedProperties:ka});pa.IsSuccess?v.Health.instance.recordKpiSuccess("WacCorePFT",xa):v.Health.instance.recordKpiFailure("WacCorePFT",pa.ErrorCode,!1,!1,xa)}).catch(function(pa){var xa=Math.floor(y.a.Ce()-ma);xa=Object.assign(new z.a,{durationMs:xa,extendedProperties:ka});v.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+pa.toString(),!1,!1,xa)})}}};m.prototype.dispose=
function(){};m.main=function(){t.a.instance.hj(new m)};Ek.Object.defineProperties(m.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(x.a)(m,"OAuthPackage",null,[4,5]);var M=b(1152);Object(x.a)(l,"LokiTokenResult",null,[]);f.prototype.nfd=function(){var aa=this,F=this.KRh();return F?f.Apd?new Promise(function(D,J){aa.OUb.continueWith(function(){aa.OUb.Oh||aa.OUb.ig?J(Error.create("Error downloading auth library")):aa.OUb.result.US("Loki",
F).then(function(R){R=n.AFrameworkApplication.ga.ra("ForceLokiFallbackToACLPTokenIsEnabled")?aa.NRh():R.IsSuccess&&R.Token?Object.assign(new l,{isSuccess:!0,token:R.Token,errorMessage:null}):Object.assign(new l,{isSuccess:!1,token:null,errorMessage:JSON.stringify(R)});D(R);return R})})}):Promise.resolve(Object.assign(new l,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new l,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",
M.a.IWe())}))};f.prototype.NRh=function(){var aa=n.AFrameworkApplication.ga.Ua("LokiUserDataSignature")||"";return Object.assign(new l,{isSuccess:!0,token:aa,errorMessage:null})};f.prototype.KRh=function(){var aa=null,F=M.a.iac();2===F?aa=n.AFrameworkApplication.ga.Ua("LokiAADAppId"):1===F&&(aa=n.AFrameworkApplication.ga.Ua("LokiMSAAppId"));return aa};Ek.Object.defineProperties(f,{Apd:{configurable:!0,enumerable:!0,get:function(){return n.AFrameworkApplication.ga.ra("IsO365CommercialHost")||n.AFrameworkApplication.ga.ra("IsO365ConsumerHost")}}});
Object(x.a)(f,"LokiTokenManager",null,[820]);var Q=b(566);e.prototype.init=function(){B.a.instance.resolve("Common.ILokiTokenManager")};e.prototype.dispose=function(){};e.prototype.ei=function(aa){aa.register(f,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Hc().Oc(function(){return new f(Q.a.ar(aa.lc("Common.App.OAuth.IOAuthManager")))})};e.main=function(){t.a.instance.hj(new e)};Ek.Object.defineProperties(e.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});
Object(x.a)(e,"LivePersonaUtilsPackage",null,[4,5]);var P=b(11);C=b(228);var L=b(7),ca=b(1023);c.prototype.US=function(aa,F){return this.oAuthManager?this.oAuthManager.US(aa,F).then(function(D){D.IsSuccess||r.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+D.ErrorMessage+" Error code: "+D.ErrorCode+" App name: "+aa);return Object(L.a)(new ca.a,{IsSuccess:D.IsSuccess,Token:D.Token,ErrorCode:D.ErrorCode,ErrorMessage:D.ErrorMessage})}):(r.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),
Promise.resolve(Object(L.a)(new ca.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};c.prototype.V5a=function(){return this.oAuthManager?this.oAuthManager.V5a():null};Object(x.a)(c,"OAuthManagerWrapper",null,[821]);var U=C.a;Am(a,U);a.prototype.create=function(){this.Eb(this.$.da.Aa(349)||new c(B.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.ka=function(aa){aa.da.Ga(350,new a(aa))};Object(x.a)(a,"OAuthManagerFactory",
C.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Type.registerNamespace("Common.App.OAuth");m.main();Type.registerNamespace("Common.App.LivePersonaUtils");e.main();(function(){P.a.Fa(function(aa){a.ka(aa)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.oauth.js.map/299dd784bb76ac9f0f0530f00bcfcc8a/EwaDS.oauth.js.map