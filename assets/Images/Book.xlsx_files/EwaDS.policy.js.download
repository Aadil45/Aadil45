(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[32],{1452:function(x,C,b){function a(lc){return dg.call(this,lc)||this}function c(lc){this.$=lc}function e(lc){var Nc=qg.call(this)||this;Nc.$=lc;Nc.Tb();return Nc}function f(lc,Nc,Nd,le,ke){var xd=pf.call(this)||this;xd.statusBarManager=null;xd.FYc=!1;xd.i$=null;xd.kCc=!1;xd.VNd=null;xd.Pxa=null;xd.QDd=!1;xd.Ao=!1;xd.Sp=null;xd.Jde=null;xd.Kfa=null;xd.Cce=null;xd.UDa=null;xd.OKe=function(){qa.ULS.sendTraceTag(537154520,306,
50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");var fc=xd.qNf(1);qa.ULS.sendTraceTag(537154519,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: {0}.",fc)};xd.lSd=function(fc,fe){fe?(xd.Sp=fe.title,xd.Jde=fe.aqc,xd.Kfa=fe.buttonText,xd.Cce=fe.buf,xd.sE.eg(27,null),qa.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):qa.ULS.sendTraceTag(537154510,306,15,
"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};xd.P3f=function(fc,fe){var oa=Object(Ub.a)(ca,fe);oa?oa.n3f?xd.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(qa.ULS.sendTraceTag(537154508,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of {0}",oa.errorType),xd.sE.EAj(oa.title,oa.message,oa.buttonText,function(fb){oa.UY&&(xd.sE.sC(52)&&xd.sE.removeEntry(52),oa.UY(fb))})):1===oa.errorType?
(qa.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),xd.sE.eg(47,null)):2===oa.errorType?xd.sE.eg(48,null):3===oa.errorType?xd.sE.eg(49,null):4===oa.errorType?xd.sE.eg(50,null):5===oa.errorType?xd.sE.FAj(oa.title,oa.message,oa.buttonText,function(fb){xd.sE.sC(51)&&xd.sE.removeEntry(51);oa.UY(fb)}):xd.sE.eg(46,null):qa.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):
(qa.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),xd.sE.eg(46,null))};xd.AYd=function(fc,fe){xd.K6&&(qa.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),xd.K6.a_f(),xd.K6.rZf(),xd.K6.BJf(),xd.$.Pd&64&&(fe.onSuccess&&xd.Pxa?xd.fKg():xd.K6.j$f()));xd.ga.ra("SupportsOfficeClientCoauthoring")&&(fc=xd.Br.Kn,xd.UDa=fc.AppliedPolicyId,"null"===xd.labelId&&(xd.UDa=""),xd.kCc&&(fc=fc.PolicyLabelAssignmentMethod&&
wb.c(fc.PolicyLabelAssignmentMethod)===wb.c("standard")?4:2,xd.applyPolicyLabel(xd.labelId,fc,!0,xd.VNd)));xd.nRe();xd.Oz()};xd.txf=function(){xd.QDd=!0;xd.nRe()};xd.jCf=function(fc,fe){qa.ULS.sendTraceTag(42322116,306,50,"PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = {0}, ApplyLabelFlag = {1}",La.AFrameworkApplication.protectedFile,fe.QP);xd.applyPolicyLabel(fe.$pc,fe.QP,!1,null)};xd.IFi=function(fc,fe){xd.UDa=fe.$pc;if($d.a.lr(fc.Errors)){var oa=
$d.a.raa(fc.Errors,[2045508683]);0<oa.length&&(fc.Errors=$d.a.TF(fc.Errors,[2045508683],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),xd.$.ea.Fp(fc.Errors));oa=$d.a.raa(fc.Errors,[2046680228]);0<oa.length&&(4===fe.QP||1===fe.QP)&&(fc.Errors=$d.a.TF(fc.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),xd.$.ea.Fp(fc.Errors));oa=fc=null;for(var fb=El(xd.Br.Kn.SensitivityLabels),Rb=fb.next();!Rb.done;Rb=fb.next())Rb=Rb.value,xb.a.equals(xd.labelId,
Rb.Id,!1)&&(fc=Rb),xb.a.equals(fe.pXf,Rb.Id,!1)&&(oa=Rb);fb={};fb.ApplyLabelFlag=fe.QP;fc?(fb.currentLabel="Set",fb.currentLabelEnabled=fc.Enabled,fb.currentLabelName=fc.Name?"Set":"NotSet",fb.currentLabelParentId=fc.ParentId?"Set":"NotSet"):fb.currentLabel="NotSet";oa?(fb.serverLabel="Set",fb.serverLabelEnabled=oa.Enabled,fb.serverLabelName=oa.Name?"Set":"NotSet",fb.serverLabelParentId=oa.ParentId?"Set":"NotSet"):fb.serverLabel="NotSet";qa.ULS.sendTraceTag(541638850,306,15,"PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : {0}",
JSON.stringify(fb))}};xd.eOg=function(fc,fe){if(!xd.$.workbookContext.HasRoundTrippedHFPart)return!1;var oa=xd.Br.Kn;if(!oa)return qa.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;var fb=null;oa=El(oa.SensitivityLabels);for(var Rb=oa.next();!Rb.done;Rb=oa.next())Rb=Rb.value,xb.a.equals(Rb.Id,fc,!1)&&(fb=Rb);return fb&&xd.m5h(fb)?(qa.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),
xd.oyj(fe),!0):!1};xd.Fdi=function(){var fc=!1;!xd.$.ya.IsNewWorkbook||xd.labelId&&xd.labelId.length||(fc=!0);qa.ULS.sendTraceTag(537154501,306,50,"PolicyManagerWrapper.IsANewFile: is this a new file : {0}",fc);return fc};xd.vof=function(fc,fe){1===fe.Wpe?xd.$.isEditMode?(qa.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),xd.$.Ka.Xb(new ae.a(-723527778,0,xd.$.ed,10,null))):qa.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):
(xd.Pxa=fe.Pxa,xd.$.ea.N2(xd.ire),xd.$.Zeb(),qa.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),xd.$.Ka.Xb(new ae.a(-8805455,0,xd.$.ed,10,null)))};xd.Hle=function(fc,fe){fe?(fc=!!(xd.$.Pd&64),qa.ULS.sendTraceTag(537154496,306,50,"AddMandatoryLabellingBusinessBar User has edit permission : {0}",fc),fc&&(xd.$.Zeb(),xd.sE.Jzj(fe.title,fe.message,fe.buttonText,function(oa){fe.UY(oa)}))):qa.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};
xd.IOf=function(){xd.sE.sC(40)&&xd.sE.removeEntry(40)};xd.xag=function(fc,fe){fe.wwj&&(qa.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),nd.TaskExtensions.Ba(ed.GetServiceTaskFactory.Va(xd.$.da,55,56,0),function(oa){oa.result.D2c()},xd.$.la,3))};xd.ire=function(){xd.Pxa&&xd.$.isEditMode?(xd.$.ea.x0(xd.ire),xd.I3a()):qa.ULS.sendTraceTag(537154467,306,15,"ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty {0} , edit mode : {1}.",
!xd.Pxa,xd.$.isEditMode)};xd.oLj=function(){xd.$.isEditMode?(xd.$.ea.x0(xd.oLj),xd.I3a()):qa.ULS.sendTraceTag(537154466,306,15,"TriggerDefaultLabelingOnModeChanged is not expected in View-mode. Mode.")};xd.Sja=function(){var fc=xd.$.ea.Qm;fc&&!xb.a.equals(fc.AppliedPolicyLabelId,xd.labelId,!1)&&(qa.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),qa.ULS.shipAssertTag(537154463,306,xd.$.isEditMode,
"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),xd.ga.ra("SupportsOfficeClientCoauthoring")&&xd.$.isEditMode&&(xd.kCc=!0,xd.VNd=fc.AppliedPolicyLabelId),xd.UDa=fc.AppliedPolicyLabelId,xd.I3a())};xd.ood=function(){var fc=!0;if(!xd.$.ea.amIAlone)for(var fe=El(xd.$.ea.Pm),oa=fe.next();!oa.done;oa=fe.next())if(!oa.value.SupportsClientIsMipTrusted){fc=!1;break}qa.ULS.sendTraceTag(537154462,306,50,
"PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : {0}",fc);return fc};xd.zyf=function(){qa.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");xd.kCc=!0;xd.I3a()};xd.$=le;xd.Br=lc;xd.sE=Nd;xd.ga=ke;xd.Br.One(xd.lSd);xd.K6=Nc;return xd}function l(lc){return je.call(this,lc,l.WQ(lc))||this}function m(lc,Nc,Nd,le,ke){var xd=mf.call(this)||this;xd.Hof=3;xd.augmentationLoopManager=null;xd.UA=null;xd.FZa=!1;xd.n$a=[];xd.ijf=new Kf.a(Ff.a.gK());
xd.bFd=0;xd.gFd=null;xd.erb=function(fc,fe){fc=Object(tf.a)(new Yd.a,{parentPath:["session","doc","security"],items:[Object(tf.a)(new Ge.a,{id:"clp",body:Object(tf.a)(new w,{existingLabelPriority:fe.existingLabelPriority,partialDocSITs:fe.Bze,fullDocSITs:fe.Aze})})]});xd.n$a.push(fc);xd.Yxb()};xd.Lbg=function(fc,fe){fc=Object(tf.a)(new ud.a,{parentPath:["session","doc","security"],items:[Object(tf.a)(new Ge.a,{id:"clp",body:Object(tf.a)(new w,{existingLabelPriority:fe.existingLabelPriority})})]});
xd.n$a.push(fc);xd.Yxb()};xd.Mbg=function(fc,fe){fc=Object(tf.a)(new ud.a,{parentPath:["session","doc","security"],items:[Object(tf.a)(new Ge.a,{id:"clp",body:Object(tf.a)(new w,{partialDocSITs:fe.Bze,fullDocSITs:fe.Aze})})]});xd.n$a.push(fc);xd.Yxb()};xd.o6=function(){qa.ULS.sendTraceTag(537154588,306,50,"AutoPolicyManager::OnApplicationModeChanged - isEditMode:{0}.",xd.$.isEditMode);xd.$.isEditMode?Hd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?xd.Yxb():
xd.J9e():(xd.businessBar.removeEntry(39),xd.businessBar.removeEntry(38),xd.wbh())};xd.Hmc=function(){qa.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");xd.cHe();xd.augmentationLoopManager=null};xd.Opi=function(fc,fe){var oa,fb,Rb,dc,uc;qa.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===fe.operationType)qa.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var Bd=fc=null,Od=null;if(xd.bnd()){var Td=fe.UG;if(!Td){qa.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(oa=Td.automatic)||void 0===oa?0:oa.id)fc=Td.automatic.id;if(null===(fb=Td.recommended)||void 0===fb?0:fb.id)Bd=Td.recommended.id,Td.recommended.policyTip&&(Od=Td.recommended.policyTip)}else{oa=fe.UG;if(!oa){qa.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(Rb=null===(Td=oa.automatic)||void 0===Td?void 0:Td.sensitivityLabel)||void 0===Rb?0:Rb.id)fc=oa.automatic.sensitivityLabel.id;if(null===(uc=null===(dc=oa.recommended)||void 0===dc?void 0:dc.sensitivityLabel)||void 0===uc?0:uc.id)Bd=oa.recommended.sensitivityLabel.id,oa.recommended.sensitivityLabel.policyTip&&(Od=oa.recommended.sensitivityLabel.policyTip)}xd.applyPolicyLabel(fc,Bd,Od,1)}};xd.Lri=function(fc,fe){qa.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===fe.operationType?qa.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(fc=fe.UG)?(fc=fc.classificationId,xd.applyPolicyLabel(fc,fc,null,2)):qa.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};xd.kOf=function(fc,fe){fe?fe.Vzb&&xd.businessBar.sC(39)?(xd.businessBar.removeEntry(39),qa.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!fe.Vzb&&xd.businessBar.sC(38)&&(xd.businessBar.removeEntry(38),qa.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):qa.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};xd.z2f=function(fc,fe){fe?fe.Vzb?(xd.businessBar.uAj(fe.title,fe.message,fe.buttonText,function(oa){fe.UY(oa);xd.businessBar.sC(39)&&xd.businessBar.removeEntry(39)}),qa.ULS.sendTraceTag(537154531,
306,50,"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(xd.businessBar.myj(fe.title,fe.message,fe.buttonText,function(oa){fe.UY(oa);xd.businessBar.sC(38)&&xd.businessBar.removeEntry(38)}),qa.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):qa.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};xd.PDd=
lc;xd.policyManager=Nc;xd.$=Nd;xd.ga=le;xd.businessBar=ke;xd.K8h();xd.Y6i();xd.disposed=!1;return xd}function r(){var lc=Ye.call(this)||this;lc.classificationId=null;lc.H_=Object.assign(new pe.a,{T_:r.getTypeName(),B_:r.Ae()});return lc}function h(){var lc=Jc.call(this)||this;lc.recommended=null;lc.automatic=null;lc.source=null;lc.H_=Object.assign(new pe.a,{T_:h.getTypeName(),B_:h.Ae()});return lc}function w(){var lc=n.call(this)||this;lc.existingLabelPriority=null;lc.H_=Object.assign(new pe.a,{T_:w.getTypeName(),
B_:w.Ae()});return lc}function n(){var lc=eg.call(this)||this;lc.partialDocSITs=null;lc.fullDocSITs=null;lc.H_=Object.assign(new pe.a,{T_:n.getTypeName(),B_:n.Ae()});return lc}function v(){var lc=Lf.call(this)||this;lc.recommended=null;lc.automatic=null;lc.source=null;lc.H_=Object.assign(new pe.a,{T_:v.getTypeName(),B_:v.Ae()});return lc}function u(lc,Nc,Nd,le,ke,xd,fc){fc=lc.Na(1,void 0===fc?null:fc);fc.tenantId=Nc;return de.i(lc,"GetPolicyApplicationMethod",fc,Nd,le,ke,xd,4)}function t(lc,Nc,Nd,
le,ke,xd,fc){fc=lc.Na(1,void 0===fc?null:fc);fc.tenantId=Nc;return de.i(lc,"GetPolicyLabelId",fc,Nd,le,ke,xd,4)}function y(){this.iGa=this.annotationType=null;this.OLa=this.sF=!1}function E(){this.$pc=this.pXf=null;this.QP=0}function B(){this.z1=this.Rqa=this.tb=this.Yg=null}function z(lc,Nc,Nd,le,ke){le=void 0===le?0:le;ke=void 0===ke?null:ke;this.xHc=this.G5d=null;this.lra=this.Mib=this.Oib=0;this.w8="";this.OEa=this.qFc=this.Q8d=this.jpa=this.XMc=null;this.s9d=!1;this.xCa=null;this.$Jc=0;this.sVb=
this.QEa=this.zDa=this.rVb=null;this.Za=new $a.a;this.KKb=this.Zvb=this.LEa=null;this.MKc=!1;this.tBb=null;this.vb=lc;this.Mg=Nc;this.Dh=Nd;this.vUb=le;this.Kn=new Z;this.Hde=this.vb.Ua("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.nP=ke;this.xyb=lc.ra("WacApplyManualPolicyLabelIsEnabled");this.Ufc=lc.ra("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=lc.ra("SupportsOfficeClientCoauthoring");this.dmi=!1;this.irj=3E4;this.se=Vb.a.instance;lc.ra("SupportsPolicies")&&
Ja.a("MipSupportsPolicies");this.Ufc&&this.supportsOfficeClientCoauthoring&&Ja.a("MipSupportsOfficeClientCoauthoring")}function M(){}function Q(lc,Nc,Nd,le,ke,xd,fc,fe,oa,fb,Rb,dc,uc,Bd,Od,Td,Ze,vf,wf,Wf,ug){this.url=lc;this.WUj=Nc;this.body=Nd;this.headers=le;this.mdb=ke;this.priority=xd;this.state=fc;this.Nfg=void 0===fe?null:fe;this.fL=void 0===oa?null:oa;this.gW=void 0===fb?!1:fb;this.s2i=void 0===Rb?null:Rb;this.Umj=void 0===dc?null:dc;this.name=void 0===uc?null:uc;this.FFb=void 0===Bd?null:
Bd;this.Fbd=void 0===Od?!1:Od;this.QEf=void 0===Td?null:Td;this.l9b=void 0===Ze?null:Ze;this.xfc=void 0===vf?null:vf;this.Sbb=void 0===wf?null:wf;this.G6h=void 0===Wf?null:Wf;this.responseType=void 0===ug?null:ug}function P(lc){var Nc=wa.call(this)||this;Nc.wwj=lc;return Nc}function L(lc){var Nc=kd.call(this)||this;Nc.eKg=lc;return Nc}function ca(lc,Nc,Nd,le,ke,xd,fc){le=void 0===le?null:le;ke=void 0===ke?null:ke;xd=void 0===xd?null:xd;fc=void 0===fc?null:fc;var fe=zc.call(this)||this;fe.errorType=
lc;fe.eKg=Nc;fe.n3f=Nd;fe.title=le;fe.message=ke;fe.buttonText=xd;fe.UY=fc;return fe}function U(lc,Nc){var Nd=vc.call(this)||this;Nd.$pc=lc;Nd.QP=Nc;return Nd}function aa(){return Za.call(this)||this}function F(lc,Nc){var Nd=ub.call(this)||this;Nd.mpb=lc;Nd.Vzb=Nc;return Nd}function D(lc,Nc,Nd,le){var ke=Zb.call(this)||this;ke.title=lc;ke.aqc=Nc;ke.buttonText=Nd;ke.buf=le;return ke}function J(lc,Nc){var Nd=Jb.call(this)||this;Nd.Pxa=lc;Nd.Wpe=Nc;return Nd}function R(lc){lc=void 0===lc?!1:lc;var Nc=
Mb.call(this)||this;Nc.onSuccess=lc;return Nc}function Z(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelId="";this.SensitivityLabels=
[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}function W(){return ib.call(this)||this}function ka(lc){var Nc=Qa.call(this)||this;Nc.wZj=lc;return Nc}function ma(lc,Nc,Nd){var le=qb.call(this)||this;le.Bze=lc;le.Aze=Nc;le.existingLabelPriority=Nd;return le}function pa(lc,Nc,Nd,le,ke){var xd=sa.call(this)||this;xd.mpb=lc;xd.title=Nc;xd.message=Nd;xd.buttonText=le;xd.UY=ke;return xd}function xa(lc,Nc,Nd,le,ke,xd){var fc=ba.call(this)||this;fc.mpb=lc;fc.title=Nc;fc.message=Nd;fc.buttonText=le;
fc.UY=ke;fc.Vzb=xd;return fc}function va(lc,Nc,Nd,le){this.jMc=this.kMc=null;this.q9d=this.BLc=this.ULc=this.ujb=this.Pae=this.BHc=!1;this.oVa=this.efa=this.Yfa=this.mpa=this.yWa=this.Pu=this.n9=this.Bh=null;this.wFc=0;this.t6d=this.RLc=this.HFc=null;this.La=lc;this.df=Nc;this.vb=Nd;this.Yg=le;this.dkb={};this.Ide={};this.Qae={};this.xyb=Nd.ra("WacApplyManualPolicyLabelIsEnabled");this.Yg.value.boe(Object(Xa.a)(this,this.zFd,"processAutoSensitivityLabel"));this.Yg.value.JVc(Object(Xa.a)(this,this.zFd,
"processAutoSensitivityLabel"));this.Yg.value.AZb(Object(Xa.a)(this,this.$Si,"onUpdateLabelInfo"));La.AFrameworkApplication.ta&&La.AFrameworkApplication.ta.uFg(Object(Xa.a)(this,this.D6i,"refreshDocumentPolicyLabelsOnModeChange"));Nd.ra("SupportsPolicies")&&Nd.Ua("AppliedPolicyId")&&(this.kMc=Nd.Ua("IrmPolicyTitle"),this.jMc=Nd.Ua("IrmPolicyDescription"));this.oPc=Nd.ra("ProtectedFile");this.Skg=this.vb.Dd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Tkg=this.vb.Dd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",
5E3)}function ta(lc,Nc,Nd){var le=Tb.call(this,!1,!1,ta.Fu)||this;le.pWb=lc;le.yWa=Nc;le.RD=Nd;le.jc=1;le.Pe=ta.id;le.u7(1);le.u7(0);return le}function fa(){}function Ca(){this.rjb=!!La.AFrameworkApplication.ta&&La.AFrameworkApplication.ta.Qa.vv}function Sa(lc,Nc,Nd){var le=tc.call(this,!1,!1,!0)||this;if(!lc||!Nd)return qa.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs"),le;var ke={};ke=(ke.id="MandatoryLabellingDialog",ke);le.hng=Nd;le.LMc=Nc;if(!La.AFrameworkApplication.ga.ra("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||
le.LMc&&""!==le.LMc)Nc={},Nc=(Nc.href=le.LMc,Nc.target="_blank",Nc),Nd={},ke.learnMoreLink=(Nd.type="AppLinkProps",Nd.id="mandatoryLabellingLearnMoreLink",Nd.text=CommonUIStrings.l_LearnMore,Nd.handler=Nc,Nd.customTooltip=CommonUIStrings.L_LearnMoreTooltip,Nd);Nc={};lc=(Nc.id="mandatoryLabellingFlyoutMenuSection",Nc.controls=lc,Nc);Nc={};Nc=(Nc.sections=[],Nc.shouldAutoOpen=!1,Nc);Array.add(Nc.sections,lc);lc={};ke.labelFlyout=(lc.type="AppFlyoutAnchorProps",lc.id="mandatoryLabellingFyout",lc.label=
"Pick a label",lc.hideLabel=!1,lc.hideChevron=!1,lc.hideIcon=!0,lc.menuDefinition=Nc,lc);lc={};lc=(lc.id="MandatoryLabellingDialog",lc.bodyControls=ke,lc);ke.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;ke.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;le.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(Xa.a)(le,le.Oxi,"mandatoryLabellingDialogHandler"),lc);return le}function Gb(lc,Nc){var Nd=wc.call(this,
!1,!1,Gb.Fu)||this;Nd.lqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];Nd.DVb=null;Nd.CVb=!1;Nd.pWb=lc;Nd.RD=Nc;Nd.gg=Nd.XPg();Nd.jc=1;Nd.Pe=Gb.id;Nd.Dc(1,CommonUIStrings.l_DialogChange);Nd.pL(1,!1);Nd.u7(0);return Nd}function kb(){}function lb(lc,Nc){this.QP=lc;this.displayName=Nc}function Nb(lc,Nc,Nd){Nd=void 0===Nd?null:Nd;this.id=lc.Id;Nd||(Nd="");this.G5i=Nd;this.sensitivityLabel=
lc}b.r(C);var Aa=b(0),qa=b(14),Xa=b(82),Ha=b(1060),Ra=b(202);Object(Aa.a)(Nb,"AutoPolicyLabelData",null,[]);Object(Aa.a)(lb,"PolicyLabelRequestState",null,[]);var mb=b(149),La=b(4),ha=b(156),Ia=b(13),gb=b(42),Sb=b(29);Ek.Object.defineProperties(kb,{isd:{configurable:!0,enumerable:!0,get:function(){return kb.qpi}}});kb.qpi="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(Aa.a)(kb,"JustificationDialogHtml",null,[]);var wc=mb.a;Am(Gb,wc);Gb.prototype.bSd=function(){if(Gb.Fu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(Xa.a)(this,this.mLf,"reactJustificationDialogHandler"),this.k1e(this.CVb));else{for(var lc={},Nc=0;Nc<this.lqa.length;Nc++)lc[Gb.gGd+Nc]=!1;lc[Gb.bNb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(Xa.a)(this,this.ppi,"justificationDialogHandler"),lc);this.w7i();gb.a.addHandler($get(Gb.bNb),
Ia.a.input,Object(Xa.a)(this,this.JHj,"textAreaHandler"))}};Gb.prototype.validate=function(){if(Gb.Fu)return this.Meg(this.DVb);var lc=$get(Gb.bNb);return lc.disabled?!0:this.Meg(lc.value)};Gb.prototype.Meg=function(lc){var Nc=2>lc.length,Nd=500<lc.length,le=RegExp("[{|}|;|\\\\]").test(lc);lc=""===Sb.a.lsc(lc);return!Nc&&!Nd&&!le&&!lc};Gb.prototype.ppi=function(lc,Nc){var Nd="";if(1===lc)for(var le=0;le<this.lqa.length;le++)if(Nc[Gb.gGd+le]){Nd=le===this.lqa.length-1?Nc[Gb.bNb]:this.lqa[le];break}this.RD(lc,
this.pWb,Nd)};Gb.prototype.mLf=function(lc){var Nc="";1===lc&&this.DVb&&(Nc=this.DVb);this.RD(lc,this.pWb,Nc)};Gb.prototype.ZMi=function(lc){this.DVb=lc;lc=this.validate();this.CVb!==lc&&(this.CVb=lc,this.bfb(CommonUIStrings.l_SensitivityJustificationTitle,Object(Xa.a)(this,this.mLf,"reactJustificationDialogHandler"),this.k1e(this.CVb)))};Gb.prototype.k1e=function(lc){var Nc={},Nd={},le={},ke={};return ke.id=this.Pe,ke.bodyControls=(Nd.choiceGroupProps={},Nd.textAreaProps=(Nc.placeholder=CommonUIStrings.l_SensitivityJustificationPlaceholder,
Nc),Nd),ke.actionButtonProps=(le.label=CommonUIStrings.l_DialogChange,le.disabled=!lc,le),ke.infoMessage=CommonUIStrings.l_SensitivityJustificationMessage,ke.justificationIrrelevantLabel=CommonUIStrings.l_SensitivityJustificationNoLongerApplies,ke.justificationIncorrectLabel=CommonUIStrings.l_SensitivityJustificationIncorrect,ke.justificationOtherLabel=CommonUIStrings.l_SensitivityJustificationOther,ke.onJustificationUpdated=Object(Xa.a)(this,this.ZMi,"onJustificationUpdated"),ke};Gb.prototype.JHj=
function(lc){lc.target&&this.pL(1,this.validate())};Gb.prototype.XPg=function(){return mb.a.cp(Gb.isd,La.AFrameworkApplication.VC,ha.getImageClass(Gb.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.lqa[0],this.lqa[1],this.lqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)};Gb.prototype.w7i=function(){for(var lc=document.getElementsByName(Gb.Ori),Nc=0;Nc<lc.length;Nc++)gb.a.addHandler(lc[Nc],Ia.a.focus,Object(Xa.a)(this,this.WJf,"radioButtonFocusHandler")),gb.a.addHandler(lc[Nc],
Ia.a.click,Object(Xa.a)(this,this.WJf,"radioButtonFocusHandler"))};Gb.prototype.WJf=function(lc){if(lc=lc.target){lc.checked=!0;var Nc=$get(Gb.bNb);lc.id===Gb.gGd+(this.lqa.length-1)?(Nc.disabled=!1,Sys.UI.DomElement.setVisible(Nc,!0),Nc.focus()):(Nc.disabled=!0,lc.focus());this.pL(1,this.validate())}};Ek.Object.defineProperties(Gb,{Fu:{configurable:!0,enumerable:!0,get:function(){return La.AFrameworkApplication.ta.Qa.vv&&La.AFrameworkApplication.ta.Qa.eqd}}});Gb.isd=kb.isd;Gb.Ori="ListRadioBox";
Gb.gGd="radiobox";Gb.bNb="txtJustification";Gb.iconName="Info_32x32x32";Gb.id="JustificationDialog";Object(Aa.a)(Gb,"JustificationDialog",mb.a,[]);var tc=mb.a;Am(Sa,tc);Sa.prototype.Oxi=function(lc,Nc){1===lc&&Nc.selectedLabel&&(lc=Nc.selectedLabel,""!==lc&&this.hng(lc))};Object(Aa.a)(Sa,"MandatoryLabellingDialog",mb.a,[]);Ca.prototype.l7g=function(lc,Nc,Nd){this.rjb&&new Sa(lc,Nc,Nd)};Ek.Object.defineProperties(Ca,{instance:{configurable:!0,enumerable:!0,get:function(){return Ca.Ma||(Ca.Ma=new Ca)}}});
Ca.Ma=null;Object(Aa.a)(Ca,"MandatoryLabellingDialogFactory",null,[590]);fa.MEj="sbProtectForm14";fa.OEj="SBStatusBarMarkAsReadOnly14";fa.$qi="Info_16x16x32";fa.Zpb="QuickSearchCompletedToday_16x16x32";fa.GGd="CommonControlCheckboxCheck_16";fa.u9f="On";fa.visible="Visible";fa.HCh="ImageIsVisible";fa.LI="SourceControlId";fa.menuItemId="MenuItemId";fa.menu="Menu";fa.zWc="AppLockId";fa.value="Value";fa.Bi="LabelText";fa.alt="Alt";fa.f9e="Image16by16";fa.y5a="Image16by16Class";fa.LEj="SBProtectForm_16";
fa.NEj="SBStatusBarMarkAsReadOnly_16";fa.icon="Icon";fa.iconColor="IconColor";fa.customTooltip="CustomTooltip";fa.S4i="MipTagDynamicFillWithOutline_20";fa.T4i="MipTagLockDynamicFillWithOutline_20";fa.R4i="MipTagErrorOutline_20";fa.U4i="MipTagQuestionOutline_20";fa.PWd="transparent";Object(Aa.a)(fa,"PolicyConstants",null,[]);var Tb=mb.a;Am(ta,Tb);ta.prototype.ASd=function(){var lc={};lc=(lc.id="UserDefinedPermissionsDialog",lc);ta.Fu&&this.initializeAndShow("Defined Permissions",Object(Xa.a)(this,
this.NTj,"userDefinedPermissionsDialogHandler"),lc)};ta.prototype.NTj=function(lc){1!==lc&&this.RD(lc,this.pWb,"",this.yWa)};Ek.Object.defineProperties(ta,{Fu:{configurable:!0,enumerable:!0,get:function(){return La.AFrameworkApplication.ta.Qa.vv&&La.AFrameworkApplication.ta.Qa.eqd}}});ta.id="UserDefinedPermissionsDialog";Object(Aa.a)(ta,"UserDefinedPermissionsDialog",mb.a,[]);var pb=b(653),cb=b(392),ob=b(321),rc=b(632),Db=b(100),Ja=b(187),Qb=b(625),yc=b(623),Cd=b(165),bc=b(460),Kb=b(133),ic=b(91),
wb=b(204),Wa=b(343),Xb=b(85),Gc=b(107),zb=b(27),hc=b(55);va.prototype.Qg=function(){this.La.fc(zb.a.mEf,Gc.a.frame,Object(Xa.a)(this,this.QIe,"documentLabelPaneHandler"));this.La.Te(zb.a.vab,Gc.a.frame,Object(Xa.a)(this,this.vab,"queryPolicyLabel"),96);this.La.fc(zb.a.iTa,Gc.a.frame,Object(Xa.a)(this,this.iTa,"toggleSensitivity"));this.La.fc(zb.a.fza,Gc.a.frame,Object(Xa.a)(this,this.fza,"populateSensitivityFlyout"));this.La.fc(zb.a.setSensitivity,Gc.a.frame,Object(Xa.a)(this,this.setSensitivity,
"setSensitivity"));this.La.Te(zb.a.wab,Gc.a.frame,Object(Xa.a)(this,this.wab,"querySensitivity"),96);this.La.fc(zb.a.T6,Gc.a.frame,Object(Xa.a)(this,this.T6,"querySensitivityToggleButton"));this.La.fc(zb.a.S6,Gc.a.frame,Object(Xa.a)(this,this.S6,"querySensitivitySubFlyout"));this.Dmb(zb.a.iTa)||this.La.zcb(zb.a.iTa,4);this.Dmb(zb.a.fza)||this.La.zcb(zb.a.fza,4);this.Dmb(zb.a.setSensitivity)||this.La.zcb(zb.a.setSensitivity,4);this.Dmb(zb.a.T6)||this.La.zcb(zb.a.T6,4);this.Dmb(zb.a.S6)||this.La.zcb(zb.a.S6,
4);this.df.updateCommandUI();La.AFrameworkApplication.ga&&La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Cd.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.Yg.value.$aj(Object(Xa.a)(this,this.oNf,"registerActionsHandler"))};va.prototype.oNf=function(){this.Qg()};va.prototype.WNb=function(){this.La.yD(zb.a.mEf,Gc.a.frame,Object(Xa.a)(this,this.QIe,"documentLabelPaneHandler"));
this.La.yD(zb.a.vab,Gc.a.frame,Object(Xa.a)(this,this.vab,"queryPolicyLabel"));this.La.yD(zb.a.iTa,Gc.a.frame,Object(Xa.a)(this,this.iTa,"toggleSensitivity"));this.La.yD(zb.a.fza,Gc.a.frame,Object(Xa.a)(this,this.fza,"populateSensitivityFlyout"));this.La.yD(zb.a.setSensitivity,Gc.a.frame,Object(Xa.a)(this,this.setSensitivity,"setSensitivity"));this.La.yD(zb.a.wab,Gc.a.frame,Object(Xa.a)(this,this.wab,"querySensitivity"));this.La.yD(zb.a.T6,Gc.a.frame,Object(Xa.a)(this,this.T6,"querySensitivityToggleButton"));
this.La.yD(zb.a.S6,Gc.a.frame,Object(Xa.a)(this,this.S6,"querySensitivitySubFlyout"))};va.prototype.iTa=function(){return 32};va.prototype.DWe=function(lc){var Nc="mandatoryLabelling_"+lc.Id;this.Qae[Nc]=lc.Id;var Nd={};return Nd.type="AppToggleButtonProps",Nd.id=Nc,Nd.label=lc.DisplayName,Nd.hideLabel=!1,Nd.customTooltip=lc.Tooltip,Nd};va.prototype.aNa=function(){return this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)};va.prototype.SRh=function(){var lc=[],Nc=this.n9,
Nd;for(Nd in Nc){var le=Nc[Nd],ke=this.Pu[Nd];if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!ke||!ke.Enabled||ke.HasUserDefinedPermissions)continue}else if(!ke||!ke.Enabled)continue;if(le.count){var xd={};xd=(xd.sections=[],xd.shouldAutoOpen=!1,xd);var fc={};fc=(fc.id="mandatoryLabelling_flyoutMenuSection_"+ke.Id,fc.controls=[],fc);le=El(le);for(var fe=le.next();!fe.done;fe=le.next()){fe=this.Pu[fe.value];if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",
!1)){if(!fe||!fe.Enabled||fe.HasUserDefinedPermissions)continue}else if(!fe||!fe.Enabled)continue;Array.add(fc.controls,this.DWe(fe))}Array.add(xd.sections,fc);fc={};ke=(fc.type="AppFlyoutAnchorProps",fc.id="mandatoryLabelling_"+ke.Id,fc.label=ke.DisplayName,fc.hideLabel=!1,fc.hideChevron=!1,fc.hideIcon=!1,fc.menuDefinition=xd,fc);Array.add(lc,ke)}else Array.add(lc,this.DWe(ke))}return lc};va.prototype.fza=function(lc,Nc,Nd,le,ke){if(1===Nd||!this.Yg.value.aha(!0))return 32;ke.MenuItems=Object.assign(new Qb.a,
{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});Array.add(ke.MenuItems.MenuSectionList,this.Pc(!this.isReactRibbonEnabled()));this.Bh.CustomUrl&&Array.add(ke.MenuItems.MenuSectionList,this.b7g(this.isReactRibbonEnabled()?this.Bh.CustomUrl:Sb.a.nf(this.Bh.CustomUrl)));this.isReactRibbonEnabled()||(ke.PopulationXML=ob.q(ke.MenuItems));return 32};va.prototype.wab=function(lc,Nc,Nd,le,ke){if(1===Nd||!ke||!this.xyb)return 32;this.Bh=this.Yg.value.Kn;if(this.Yg.value.aha(!0)&&(ke[fa.visible]=
!0,Ja.a("MipLabelsAvailable"),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.Bh&&this.Bh.AreLabelsAvailable&&(lc=Xb.a.instance.lc("Common.ISystemInitiatedFeedback")))){var xd=va.Fh(this.Bh.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";lc.execute(function(fc){fc.logActivity(xd,null)})}return 32};va.prototype.T6=function(lc,Nc,Nd,le,ke){if(1===Nd||!ke)return 32;var xd,fc;ke[fa.u9f]=!!(xd=ke[fa.menuItemId])&&
!!(fc=this.dkb[xd])&&fc===this.Bh.AppliedPolicyId;return 32};va.prototype.S6=function(lc,Nc,Nd,le,ke){if(1===Nd||!ke)return 32;var xd,fc,fe;lc=!!(xd=ke[fa.LI])&&!!(fc=this.dkb[xd])&&!!(fe=this.n9[fc])&&fe.contains(this.Bh.AppliedPolicyId);ke[fa.HCh]=lc;ke[fa.u9f]=lc;return 32};va.prototype.setSensitivity=function(lc,Nc,Nd,le,ke){return 1!==Nd&&ke?this.HRa(this.dkb[ke[fa.LI]],ke,2):32};va.prototype.mgc=function(){return!!La.AFrameworkApplication.ta&&1===La.AFrameworkApplication.ta.mode};va.prototype.D6i=
function(){this.BLc&&!this.mgc()&&(this.BLc=!1,this.Yg.value.C6i())};va.prototype.j$f=function(){this.Bh.DefaultLabelId&&this.Bh.MandatoryLabelingEnforced?this.BHc||this.mgc()?this.Bh.AppliedPolicyId?this.T8c(""):(this.Yg.value.pli(this.Yg.value.tBb)||this.mgc())&&this.kLe():this.xYf():this.Bh.DefaultLabelId?this.xYf():this.Bh.MandatoryLabelingEnforced&&(this.Bh.AppliedPolicyId?this.T8c(""):this.kLe())};va.prototype.ief=function(){return this.Bh.MandatoryLabelingEnforced?this.Bh&&this.Bh.AreLabelsAvailable?
this.vb.ra("TestOverrideIsReactDialogEnabled")||this.df&&this.df.Qa&&this.df.Qa.vv?!0:(qa.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(qa.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(qa.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)};va.prototype.kLe=function(){var lc=this;!this.ief()||La.AFrameworkApplication.r5||this.Pae||
(this.Pae=La.AFrameworkApplication.r5=!0,qa.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.Yg.value.nKf("",1),this.Yg.value.DUc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,function(){lc.Mxi()}))};va.prototype.T8c=function(lc){this.ief()&&La.AFrameworkApplication.r5&&(La.AFrameworkApplication.r5=!1,qa.ULS.sendTraceTag(562837518,
306,50,"Mandatory labelling is escaped successfully."),this.Yg.value.IId(),this.Yg.value.nKf(lc,2))};va.prototype.Mxi=function(){Ca.instance.l7g(this.SRh(),this.Bh.CustomUrl,Object(Xa.a)(this,this.Nxi,"mandatoryLabellingDialogCallback"))};va.prototype.Nxi=function(lc){this.T8c(this.Qae[lc])};va.prototype.Yse=function(){return this.vb.ra("CoAuthForProtectedFilesEnabled")&&this.vb.ra("SupportsOfficeClientCoauthoring")&&this.vb.ra("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.t6d&&this.J6a};
va.prototype.HRa=function(lc,Nc,Nd,le){var ke=this;le=void 0===le?null:le;this.Yg.value.z3i(Nd);var xd=32,fc=!1,fe=!0,oa=2===Nd||8===Nd||16===Nd,fb=lc===this.Bh.AppliedPolicyId;if(this.HFc&&this.HFc(lc,oa))qa.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",Nd),this.df.updateCommandUI();else if(Nc&&fa.zWc in Nc&&this.Yg.value.vqj(Nc[fa.zWc]),lc)if(this.Yg.value.vgf()||this.Yse()&&this.ULc)qa.ULS.sendTraceTag(42796168,
306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",Nd),this.df.updateCommandUI(),oa&&this.q_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.vb.ra("HasDocumentEditRights"))if(this.Yg.value.fUg(lc))if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&!this.aNa()&&this.Pu[lc]&&this.Pu[lc].HasUserDefinedPermissions&&!fb)qa.ULS.sendTraceTag(540608323,
306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",Nd),1!==Nd&&4!==Nd&&this.oIg();else if(oa&&this.Bh.MandatoryLabelingEnforced&&fb)qa.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",Nd),this.q_b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(oa&&this.vb.ra("WacLabelingJustificationDialogIsEnabled")&&
this.Bh.RequiredDowngradeJustification&&(fb||this.Pu[lc].RequiredDowngradeJustification)&&(this.aNa()?!this.q9d&&!le:!this.yWa))return qa.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",Nd),this.bSd(lc),xd;if(this.aNa()&&this.Pu[lc].HasUserDefinedPermissions&&!fb)return qa.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",Nd),this.ASd(lc,le),xd;if(this.Yse()&&!this.t6d())this.wFc<this.Skg?(qa.ULS.sendTraceTag(577356770,306,
50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.wFc,Nd),this.ULc=!0,this.wFc++,hc.Task.delay(this.Tkg).continueWith(function(){ke.ULc=!1;ke.HRa(lc,Nc,Nd)})):(qa.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",Nd),fc=1!==Nd,fe=!1,xd=8);else{if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.WacBlockParentLabelSetLabel",!1)&&this.$ji(lc)&&
(qa.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",Nd),1===Nd||8===Nd||4===Nd))return xd;qa.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",Nd);this.setPolicyLabel(fb?"":lc,this.aNa()?le:this.yWa,"",Nd);return xd}}else qa.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",Nd),this.df.updateCommandUI(),
oa&&this.q_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else qa.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",Nd),this.df.updateCommandUI(),oa&&this.q_b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else qa.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",
Nd),this.df.updateCommandUI(),fc=oa,fe=!1,xd=8;this.Yg.value.uGd(0,Nd,fc,fe);return xd};va.prototype.jZa=function(lc,Nc,Nd,le){Nd=void 0===Nd?null:Nd;le=void 0===le?!1:le;Db.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.vb.ra("SupportsOfficeClientCoauthoring")&&this.vb.ra("CoAuthForProtectedFilesIsEnabled")?(this.ujb=!1,(this.Bh=this.Yg.value.Kn)&&!this.Bh.AppliedPolicyId?this.ujb=!0:this.Bh&&this.Bh.PolicyLabelAssignmentMethod&&(this.ujb=wb.c(this.Bh.PolicyLabelAssignmentMethod)===
wb.c("standard"))):this.ujb=le;lc=va.Fh(lc)?null:this.Pu[lc];(Nc=va.Fh(Nc)?null:this.Pu[Nc])?this.Yfa=new Nb(Nc,!0,Nd):(this.Yg.value.kda(29),this.efa=null);lc?this.mpa=new Nb(lc,!1):this.oVa=null;this.zFd(null,null);return 32};va.prototype.gKg=function(lc){""!==this.Bh.AppliedPolicyId?this.Yg.value.uGd(4,16,!0):this.HRa(lc,null,16)};va.prototype.rZf=function(){this.Pu={};if(this.Bh=this.Yg.value.Kn)for(var lc=El(this.Bh.SensitivityLabels),Nc=lc.next();!Nc.done;Nc=lc.next())Nc=Nc.value,this.Pu[Nc.Id]=
Nc};va.prototype.$ji=function(lc){if(this.n9&&lc in this.n9){lc=El(this.n9[lc]);for(var Nc=lc.next();!Nc.done;Nc=lc.next())if((Nc=this.Pu[Nc.value])&&Nc.Enabled)return!0}return!1};va.prototype.a_f=function(){this.n9={};if(this.Bh=this.Yg.value.Kn){for(var lc=El(this.Bh.SensitivityLabels),Nc=lc.next();!Nc.done;Nc=lc.next())Nc=Nc.value,Nc.ParentId||(this.n9[Nc.Id]=new Ra.a);lc=El(this.Bh.SensitivityLabels);for(Nc=lc.next();!Nc.done;Nc=lc.next())Nc=Nc.value,Nc.ParentId&&Nc.ParentId in this.n9&&this.n9[Nc.ParentId].add(Nc.Id)}};
va.prototype.BJf=function(){if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.Bh=this.Yg.value.Kn;var lc=this.xyb&&this.isReactRibbonEnabled()&&this.Yg.value.aha();va.wQa(lc)}else this.xyb&&this.isReactRibbonEnabled()?(this.Bh=this.Yg.value.Kn,this.Yg.value.aha()?(va.wQa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):va.wQa(!1)):va.wQa(!1)};va.prototype.$6i=function(lc){this.HFc=lc};va.prototype.S7i=function(lc){this.RLc=
lc};va.prototype.xYf=function(){this.vb.ra("WacApplyDefaultPolicyLabelIsEnabled")&&(this.mgc()?this.BLc=!0:this.BHc||(this.BHc=!0,(this.Bh=this.Yg.value.Kn)&&this.Bh.DefaultLabelId&&!this.Bh.AppliedPolicyId&&(qa.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.Bh.DefaultLabelId),this.HRa(this.Bh.DefaultLabelId,null,1))))};va.prototype.zFd=function(){var lc=this;if(!this.Yg.value.vgf()){var Nc=this.Pu[this.Yg.value.Kn.AppliedPolicyId];this.ujb&&this.mpa&&this.oVa!==
this.mpa.id&&(!Nc||Nc.Order<this.mpa.sensitivityLabel.Order)&&(Nc=this.HRa(this.mpa.id,{},4),32!==Nc?qa.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+Nc):(this.oVa=this.mpa.id,this.efa&&(Nc=this.Pu[this.efa])&&Nc.Order<=this.mpa.sensitivityLabel.Order&&(this.Yg.value.kda(29),this.efa=null)));Nc=this.Pu[this.Yg.value.Kn.AppliedPolicyId];if(this.Yfa&&this.efa!==this.Yfa.id&&(!Nc||Nc.Order<this.Yfa.sensitivityLabel.Order)){var Nd=this.Yfa.id;
this.Yg.value.kda(29);this.Yg.value.PYb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.Vfd(this.Yfa.sensitivityLabel))+" "+this.Yfa.G5i,CommonUIStrings.l_PolicyLabelRecommendationButton,function(){lc.HRa(Nd,{},8)});this.efa=this.Yfa.id}this.Yfa=this.mpa=null}};va.prototype.setPolicyLabel=function(lc,Nc,Nd,le){le=void 0===le?2:le;this.aNa()?Nc&&(this.q9d=!0):this.yWa=Nc;this.Yg.value.setPolicyLabel(lc);this.df.updateCommandUI();Nd=
new lb(le,this.Vfd(this.Pu[lc]));this.Yg.value.kPd(lc,this.aNa()?Nc:this.yWa,Nd)};va.prototype.l2g=function(lc,Nc,Nd,le){1===lc&&this.setPolicyLabel(Nc,le,Nd)};va.prototype.k2g=function(lc,Nc,Nd){1===lc?this.aNa()?this.HRa(Nc,null,2,Nd):this.setPolicyLabel(Nc===this.Bh.AppliedPolicyId?"":Nc,Nd,""):this.df.updateCommandUI()};va.prototype.bSd=function(lc){(new Gb(lc,Object(Xa.a)(this,this.k2g,"continueToSetPolicyLabelFromJustificationDialog"))).bSd()};va.prototype.ASd=function(lc,Nc){(new ta(lc,Nc,
Object(Xa.a)(this,this.l2g,"continueToSetPolicyLabelFromUDPDialog"))).ASd()};va.prototype.q_b=function(lc,Nc){lc=void 0===lc?"":lc;Nc=void 0===Nc?"":Nc;var Nd=new Kb.StandardDialog;Nd.qv=La.AFrameworkApplication.Eyb;Nd.jc=0;Nd.Dc(1,CommonUIStrings.l_DialogClose);Nd.xX(lc,Nc,null)};va.prototype.gOg=function(lc){1===lc&&this.Yg.value.D3i()};va.prototype.oIg=function(){var lc=new Kb.StandardDialog;lc.qv=La.AFrameworkApplication.Eyb;lc.jc=1;lc.Dc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);
lc.Dc(0,CommonUIStrings.l_DialogClose);lc.xX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(Xa.a)(this,this.gOg,"blockUDPSetLabelHandler"))};va.prototype.isReactRibbonEnabled=function(){return!!this.df&&!!this.df.Qa&&this.df.Qa.Ni};va.prototype.Phc=function(){return this.df&&this.df.Qa?this.df.Qa.Phc:!1};va.prototype.QIe=function(){return 32};va.prototype.vab=function(lc,Nc,Nd,le,ke){if(1===Nd)return 32;this.Bh=this.Yg.value.Kn;
if(!this.Bh||!ke)return 32;ke[fa.value]="";ke[fa.Bi]="";ke[fa.alt]=null;ke[fa.f9e]=null;ke[fa.y5a]=null;ke[fa.customTooltip]="";ke[fa.visible]=!1;ke[fa.iconColor]="";Nd=Nc=lc=ke[fa.icon]="";if(!this.Bh.AreLabelsAvailable){if(!this.kMc)return 32;lc=this.kMc;Nd=fa.PWd;this.jMc&&(Nc=this.jMc)}else if(this.Bh.AppliedPolicyId){le=null;for(var xd=El(this.Bh.SensitivityLabels),fc=xd.next();!fc.done;fc=xd.next())if(fc=fc.value,fc.Id.toLowerCase()===this.Bh.AppliedPolicyId.toLowerCase()){le=fc;break}le&&(lc=
this.Vfd(le),Nc=le.Tooltip,this.oPc=La.AFrameworkApplication.protectedFile=le.IsEndpointProtectionEnabled,Nd=this.zXe(le))}this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(lc?(ke[fa.value]=lc,ke[fa.Bi]=lc,ke[fa.customTooltip]=Nc,this.BZf(Nd,this.oPc,ke)):this.vb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(ke[fa.iconColor]=fa.PWd,this.Bh.MandatoryLabelingEnforced?(ke[fa.value]=ke[fa.Bi]=HeaderStrings.SelectASensitivityLabel,
ke[fa.icon]=fa.R4i):(ke[fa.value]=ke[fa.Bi]=HeaderStrings.NoSensitivityLabel,ke[fa.icon]=fa.U4i)):(ke[fa.iconColor]="#000000",this.Bh.MandatoryLabelingEnforced?(ke[fa.value]=ke[fa.Bi]=HeaderStrings.SelectASensitivityLabel,ke[fa.icon]="MipTagErrorDynamicColor_20"):(ke[fa.value]=ke[fa.Bi]=HeaderStrings.NoSensitivityLabel,ke[fa.icon]="MipTagQuestionDynamicColor_20")),ke[fa.visible]=!0):lc&&(ke[fa.value]=lc,ke[fa.Bi]=lc,this.Phc()?ke[fa.customTooltip]=Nc:ke[fa.alt]=Nc,this.BZf(Nd,this.oPc,ke),ke[fa.visible]=
!0);return 32};va.prototype.Vfd=function(lc){return lc?this.Pu?lc.ParentId&&this.Pu[lc.ParentId]?this.Pu[lc.ParentId].DisplayName+"\\"+lc.DisplayName:lc.DisplayName:(qa.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),lc.DisplayName):""};va.prototype.BZf=function(lc,Nc,Nd){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Nd[fa.icon]=this.P2e(Nc),Nd[fa.iconColor]=this.Q2e(lc)):this.Phc()?Nd[fa.icon]=Nc?fa.LEj:
fa.NEj:(Nd[fa.f9e]=La.AFrameworkApplication.VC,Nd[fa.y5a]=Nc?ha.getImageClass(fa.MEj):ha.getImageClass(fa.OEj))};va.prototype.b7g=function(lc){var Nc=this.NU("LearnMoreSection",!0);lc=Object.assign(new cb.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:lc,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",Image16by16:La.AFrameworkApplication.VC,Image16by16Class:ha.getImageClass(fa.$qi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Nc.ControlList,
lc);return Nc};va.prototype.UEe=function(lc,Nc,Nd){Nd=void 0===Nd?!1:Nd;var le="Toggle_"+lc.Id;le="Sensitivity_"+le;var ke=lc.DisplayName,xd=lc.Tooltip,fc=lc.Id===this.Bh.AppliedPolicyId,fe=Nd?Sb.a.nf(le):le;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(fc=this.zXe(lc),Nc=Object.assign(new bc.a,{Id:fe,ExternalId:fe,LabelText:Nd?Sb.a.nf(ke):ke,Command:"2935633379",MenuItemId:fe,QueryCommand:"991261903",Visible:!0,Alt:Nd?Sb.a.nf(xd):xd,AriaLabel:ic.a.a0b,IconColor:this.Q2e(fc),
KeyTip:Nc}),Nc.ExternalImageId=this.P2e(lc.IsEndpointProtectionEnabled)):(fe=Object.assign(new pb.a,{Id:fe,ExternalId:fe,LabelText:Nd?Sb.a.nf(ke):ke,Command:"2935633379",MenuItemId:fe,QueryCommand:"991261903",CheckedImage:La.AFrameworkApplication.VC,Visible:!0,Alt:Nd?Sb.a.nf(xd):xd,IsChecked:fc,AriaLabel:ic.a.a0b,KeyTip:Nc}),this.isReactRibbonEnabled()?(fe.CheckedImageClass=ha.getImageClass(fa.GGd),fe.ExternalImageId=fa.GGd):fe.CheckedImageClass=ha.getImageClass(fa.Zpb),Nc=fe);fe=le;this.dkb[fe]=
lc.Id;this.Ide[lc.Id]=fe;return Nc};va.prototype.NU=function(lc,Nc){Nc=void 0===Nc?!1:Nc;return Object.assign(new yc.a,{Title:"",Id:lc,DisplayMode:fa.menu,ShowMenuSectionSeparator:Nc,ControlsId:"Ctrl_"+lc,ControlList:[]})};va.prototype.a$g=function(lc,Nc,Nd){lc=this.NU(lc+"Sub");var le=1;Nc=El(Nc);for(var ke=Nc.next();!ke.done;ke=Nc.next())(ke=this.Pu[ke.value])&&ke.Enabled&&(Array.add(lc.ControlList,this.UEe(ke,le.toString(),Nd)),le++);return lc};va.prototype.Pc=function(lc){lc=void 0===lc?!1:lc;
var Nc=this.NU("SensitivitySection"),Nd=1,le=this.n9,ke;for(ke in le){var xd=le[ke],fc=this.Pu[ke];if(fc&&fc.Enabled){if(xd.count){var fe="Sensitivity_"+fc.Name,oa=lc?Sb.a.nf(fe):fe;oa=Object.assign(new rc.a,{Id:oa,ExternalId:oa,LabelText:lc?Sb.a.nf(fc.DisplayName):fc.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new Qb.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,AriaLabel:ic.a.a0b,KeyTip:Nd.toString()});
this.isReactRibbonEnabled()?oa.ExternalImageId=fa.GGd:(oa.Image16by16=La.AFrameworkApplication.VC,oa.Image16by16Class=ha.getImageClass(fa.Zpb));Array.add(oa.Menu.MenuSectionList,this.a$g(fe,xd,lc));Array.add(Nc.ControlList,oa);this.dkb[oa.Id]=fc.Id;this.Ide[fc.Id]=oa.Id}else Array.add(Nc.ControlList,this.UEe(fc,Nd.toString(),lc));Nd++}}return Nc};va.prototype.Dmb=function(lc){return!!this.La.z4(lc)&&!!this.La.z4(lc).flags&&!!this.La.z4(lc).flags.length};va.prototype.$Si=function(lc,Nc){Nc.onSuccess&&
this.Pu&&(lc=this.Pu[this.Yg.value.Kn.AppliedPolicyId])&&(this.efa&&(Nc=this.Pu[this.efa])&&Nc.Order<=lc.Order&&(this.Yg.value.kda(29),this.efa=null),this.oVa&&this.oVa!==lc.Id&&(this.Yg.value.kda(28),this.oVa=null))};va.prototype.P2e=function(lc){return lc?fa.T4i:fa.S4i};va.prototype.Q2e=function(lc){return lc?lc:fa.PWd};va.prototype.zXe=function(lc){if(lc.Color||!lc.ParentId)return lc.Color;var Nc=this.Pu[lc.ParentId];return Nc?Nc.Color:lc.Color};va.wQa=function(lc){La.AFrameworkApplication.ga&&
La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(lc?(Wa.a.Eyd("ribbon","sensitivity"),Wa.a.zyd("ribbon","sensitivity")):Wa.a.Dyd("ribbon","sensitivity"));La.AFrameworkApplication.ga&&La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Cd.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!lc))};va.Fh=function(lc){return lc&&lc.length?
!1:!0};Ek.Object.defineProperties(va.prototype,{J6a:{configurable:!0,enumerable:!0,get:function(){return La.AFrameworkApplication.J6a||!!this.RLc&&this.RLc()}}});Object(Aa.a)(va,"PolicyActor",null,[527]);var Uc=b(738),jb=b(616),$a=b(97),I;(function(lc){lc[lc.unknown=0]="unknown";lc[lc.boot=1]="boot";lc[lc.refresh=2]="refresh";lc[lc.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(I||(I={}));Object(Aa.b)("GetPolicyLabelsReason",I);var ba=Sys.EventArgs;Am(xa,ba);Object(Aa.a)(xa,"AddAutoPolicyBusinessBarEntryEventArgs",
Sys.EventArgs,[]);var sa=Sys.EventArgs;Am(pa,sa);Object(Aa.a)(pa,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Oa;(function(lc){lc[lc.none=0]="none";lc[lc.reasonDefaultLabel=1]="reasonDefaultLabel";lc[lc.reasonManual=2]="reasonManual";lc[lc.reasonAutomatic=4]="reasonAutomatic";lc[lc.reasonRecommended=8]="reasonRecommended";lc[lc.reasonMandatory=16]="reasonMandatory"})(Oa||(Oa={}));Object(Aa.b)("ApplyLabelFlags",Oa);var qb=Sys.EventArgs;Am(ma,qb);Object(Aa.a)(ma,"AutoCLPSecurityNodesEventArgs",
Sys.EventArgs,[]);var Qa=Sys.EventArgs;Am(ka,Qa);Object(Aa.a)(ka,"GetPolicyLabelEventArgs",Sys.EventArgs,[]);var ib=Sys.EventArgs;Am(W,ib);Object(Aa.a)(W,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);Object(Aa.a)(Z,"GetPolicyLabelsData",null,[]);var Mb=Sys.EventArgs;Am(R,Mb);Object(Aa.a)(R,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);var Jb=Sys.EventArgs;Am(J,Jb);Object(Aa.a)(J,"MandatoryLabellingAppHandlerEventArgs",Sys.EventArgs,[]);var Zb=Sys.EventArgs;Am(D,Zb);Object(Aa.a)(D,"PolicyTipEventArgs",
Sys.EventArgs,[]);var ub=Sys.EventArgs;Am(F,ub);Object(Aa.a)(F,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);var Za=Sys.EventArgs;Am(aa,Za);Object(Aa.a)(aa,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var vc=Sys.EventArgs;Am(U,vc);Object(Aa.a)(U,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);var zc=Sys.EventArgs;Am(ca,zc);Object(Aa.a)(ca,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);var kd=Sys.EventArgs;Am(L,kd);Object(Aa.a)(L,"SetPolicyLabelTriggeredEventArgs",
Sys.EventArgs,[]);var wa=Sys.EventArgs;Am(P,wa);Object(Aa.a)(P,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var Na=b(108),Vb=b(103),pc=b(41),hd=b(80),Ud=b(39);Object(Aa.a)(Q,"ClientRequest",null,[]);var Zc=b(497),Ob=b(275);M.gpj=function(lc,Nc){if(!lc||!Nc||lc.count!==Nc.count)return!1;lc=El(lc);for(var Nd=lc.next();!Nd.done;Nd=lc.next())if(!Nc.contains(Nd.value))return!1;return!0};M.toArray=function(lc){if(!lc)return null;var Nc=Array(lc.count),Nd=0;lc=El(lc);for(var le=lc.next();!le.done;le=
lc.next())Nc[Nd]=le.value,Nd++;return Nc};Object(Aa.a)(M,"HashSetUtils",null,[]);var Ad=b(290),we=b(77),Wd=b(356);z.prototype.One=function(lc){this.Za.addHandler("PolicyTipEvent",lc)};z.prototype.AZb=function(lc){this.Za.addHandler("LabelInfoUpdateEvent",lc)};z.prototype.$aj=function(lc){this.Za.removeHandler("LabelInfoUpdateEvent",lc)};z.prototype.boe=function(lc){this.Za.addHandler("SetPolicyLabelEventKey",lc)};z.prototype.ocj=function(lc){this.Za.removeHandler("SetPolicyLabelEventKey",lc)};z.prototype.JVc=
function(lc){this.Za.addHandler("SetPolicyLabelFailureEventKey",lc)};z.prototype.ncj=function(lc){this.Za.removeHandler("SetPolicyLabelFailureEventKey",lc)};z.prototype.IEg=function(lc){this.Za.addHandler("GetPolicyLabelEventKey",lc)};z.prototype.HEg=function(lc){this.Za.addHandler("GetPolicyLabelFailureEventKey",lc)};z.prototype.FEg=function(lc){this.Za.addHandler("GetAutoPolicyLabelEventKey",lc);this.gnd&&(qa.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),
this.kGd(new ka(0)))};z.prototype.Gaj=function(lc){this.Za.removeHandler("GetAutoPolicyLabelEventKey",lc)};z.prototype.fEg=function(lc){this.Za.addHandler("CreateAutoCLPSecurityNodesEventKey",lc)};z.prototype.jaj=function(lc){this.Za.removeHandler("CreateAutoCLPSecurityNodesEventKey",lc)};z.prototype.XGg=function(lc){this.Za.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",lc)};z.prototype.Bcj=function(lc){this.Za.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",lc)};z.prototype.YGg=function(lc){this.Za.addHandler("UpdateAutoCLPSITNodesEventKey",
lc)};z.prototype.Ccj=function(lc){this.Za.removeHandler("UpdateAutoCLPSITNodesEventKey",lc)};z.prototype.Fme=function(lc){this.Za.addHandler("AddAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.z$i=function(lc){this.Za.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.Rne=function(lc){this.Za.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.Xbj=function(lc){this.Za.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.Gme=function(lc){this.Za.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",
lc)};z.prototype.B$i=function(lc){this.Za.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",lc)};z.prototype.Sne=function(lc){this.Za.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",lc)};z.prototype.Ybj=function(lc){this.Za.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",lc)};z.prototype.pFg=function(lc){this.Za.addHandler("MandatoryLabellingAppHandlerEventKey",lc)};z.prototype.kbj=function(lc){this.Za.removeHandler("MandatoryLabellingAppHandlerEventKey",
lc)};z.prototype.UGg=function(lc){this.Za.addHandler("UDPLabelingAppHandlerEventKey",lc)};z.prototype.zcj=function(lc){this.Za.removeHandler("UDPLabelingAppHandlerEventKey",lc)};z.prototype.FWg=function(){return La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsClpBlockedByAppSpecificScenarioEnabled",!1)?this.Q8d?this.Q8d():!1:!1};z.prototype.W6i=function(lc){this.qFc=lc};z.prototype.Gw=function(){return(new Date).getTime()};z.prototype.Zac=function(){this.Dh&&(this.rVb=
this.Dh.Gc("WebServiceCall","Call Get Policy Endpoint On Server"));var lc=Ad.a.bia(1,1);this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(lc=new Q(this.h4a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,lc),this.Mg.send(lc).MHd(Object(Xa.a)(this,this.Avf,"onDataLossPolicySuccessCallback"),Object(Xa.a)(this,this.zvf,"onDataLossPolicyFailureCallback"))):this.Mg.El(this.h4a("datalosspolicy"),1,null,null,!0,2,Object(Xa.a)(this,
this.Avf,"onDataLossPolicySuccessCallback"),Object(Xa.a)(this,this.zvf,"onDataLossPolicyFailureCallback"),null);this.Oib++;qa.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Hde,this.Oib)};z.prototype.C6i=function(){this.Wdd(this.w8,2,this.jpa)};z.prototype.Wdd=function(lc,Nc,Nd,le){Nc=void 0===Nc?0:Nc;Nd=void 0===Nd?null:Nd;le=void 0===le?!1:le;Db.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.fed(void 0,
Nc));this.Zvb=this.Gw();var ke=this.N3c(Nc);this.Yac(lc,ke,Nd,le,Nc);this.iKd(!0)};z.prototype.Avf=function(lc){this.zGf();var Nc=this.mXd(lc);lc=Nc.data;Nc.returnValue&&(qa.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),this.Oib=0,this.Dh&&(this.sVb=this.Dh.Gc("Task","Parse and Handle Get Policy Response")),this.aWi(lc),this.sVb&&(this.sVb.stop(),this.sVb=null))};z.prototype.zvf=function(lc){this.zGf();this.Oib<=this.vUb?this.Zac():(qa.ULS.sendTraceTag(25565154,
306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",lc?lc.data?lc.data.HQa:null:null),this.Oib=0)};z.prototype.vgf=function(){return 0<this.lra};z.prototype.setPolicyLabel=function(lc){this.Kn.AppliedPolicyId=lc};z.prototype.kPd=function(lc,Nc,Nd){Nd=void 0===Nd?null:Nd;var le=this.G6g(Nd);this.hrj(lc,Nc,le,Nd)};z.prototype.lCf=function(lc){this.QEa&&(this.QEa.stop(),this.QEa=null);var Nc=this.Y1e(lc);var Nd=Nc.zWf;Nc=Nc.g_f;var le=lc.data.state,ke=le?le.QP:2,xd=this.mXd(lc);
lc=xd.data;xd.returnValue?(qa.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",ke),this.lra=0,this.tWi(lc,Nd,Nc,le)):this.KLd(ke)};z.prototype.z3i=function(lc){Db.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.fed(lc));this.KKb=this.Gw();qa.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");this.Za.raiseEvent("SetPolicyLabelTriggeredEventKey",new L(lc))};z.prototype.rDi=function(){this.Ufc&&this.supportsOfficeClientCoauthoring&&
this.Bli&&this.LEa.Jda(12,null,!0)};z.prototype.kCf=function(lc){this.QEa&&(this.QEa.stop(),this.QEa=null);var Nc=this.Y1e(lc);var Nd=Nc.zWf;Nc=Nc.g_f;this.lra<=this.vUb?this.kPd(Nd,Nc):(Nd=(Nd=lc.data.state)?Nd.QP:2,qa.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",lc?lc.data?lc.data.HQa:null:null,Nd),this.tBb="WACServerConnectionFailed",this.lra=0,this.KLd(Nd))};z.prototype.pli=function(lc){if(lc&&("LabelNotSupported"===lc||"LabelErrorRetryLater"===
lc||"CoherencyFailure"===lc||"LabelIdNotFound"===lc||"LabelDisabled"===lc))return qa.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",lc),!0;qa.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",lc);return!1};z.prototype.fUg=function(lc){if(!lc)return!1;for(var Nc=null,Nd=null,le=El(this.Kn.SensitivityLabels),ke=le.next();!ke.done;ke=le.next())ke=ke.value,ke.Id===lc&&(Nc=ke),ke.Id===this.w8&&(Nd=ke);if(!Nc)return!1;if(this.Ufc&&this.supportsOfficeClientCoauthoring){if(this.qFc&&
this.qFc()||this.ood)return!0}else if(La.AFrameworkApplication.kz&&La.AFrameworkApplication.kz.Nub||this.jpa&&this.jpa())return!0;return Nc.IsEndpointProtectionEnabled===(!!Nd&&Nd.IsEndpointProtectionEnabled)};z.prototype.PYb=function(lc,Nc,Nd,le,ke){28===lc?this.YJf(new xa(lc,Nc,Nd,le,ke,!1)):this.YJf(new xa(lc,Nc,Nd,le,ke,!0))};z.prototype.kda=function(lc){28===lc?this.yKf(new F(lc,!1)):this.yKf(new F(lc,!0))};z.prototype.I2i=function(lc,Nc,Nd){qa.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");
this.Za.raiseEvent("CreateAutoCLPSecurityNodesEventKey",new ma(lc,Nc,Nd))};z.prototype.E3i=function(lc){qa.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.Za.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new ma(null,null,lc))};z.prototype.F3i=function(lc,Nc){qa.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.Za.raiseEvent("UpdateAutoCLPSITNodesEventKey",new ma(lc,Nc,null))};z.prototype.nKf=function(lc,Nc){qa.ULS.sendTraceTag(572650527,
306,50,"Raising a mandatory labelling"+(1===Nc?"Reading":"Edit")+" switch event.");this.Za.raiseEvent("MandatoryLabellingAppHandlerEventKey",new J(lc,Nc))};z.prototype.DUc=function(lc,Nc,Nd,le,ke){37===lc&&this.x2i(new pa(37,Nc,Nd,le,ke))};z.prototype.IId=function(){this.s3i(new aa)};z.prototype.D3i=function(){qa.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.Za.raiseEvent("UDPLabelingAppHandlerEventKey",new P(!0))};z.prototype.aha=function(lc){lc=void 0===lc?!1:lc;var Nc=
!!this.Kn&&this.Kn.AreLabelsAvailable&&!!this.Kn.SensitivityLabels&&0<this.Kn.SensitivityLabels.length&&Ob.a.any(this.Kn.SensitivityLabels,function(Nd){return!!Nd&&Nd.Enabled});Nc||lc||va.wQa(!1);return Nc};z.prototype.vxf=function(lc){this.zDa&&(this.zDa.stop(),this.zDa=null);this.iKd(!1);var Nc=this.mXd(lc);var Nd=Nc.data;Nc.returnValue?(qa.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.Mib=0,Nd=this.jWi(Nd),lc=this.U0e(lc.data),Db.Health.instance.recordKpiSuccess("MipGetPolicyLabel",
this.cac(void 0,lc,this.Zvb)),this.Zvb=null,lc=new ka(lc),this.U2i(lc),this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Nd&&this.gvj()?this.gnd?this.tPj():(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)||this.erb(),this.kGd(lc),this.MKc=!0):Nd||this.erc():!this.gnd&&Nd&&this.vb.ra("WacApplyManualPolicyLabelIsEnabled")&&this.ure()?(this.kGd(lc),this.MKc=!0):Nd||this.erc()):this.erc()};z.prototype.gvj=function(){if(!this.vb.ra("WacApplyManualPolicyLabelIsEnabled"))return qa.ULS.sendTraceTag(539877667,
306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.ure())return!1;if(""===this.w8)return qa.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),!0;if(this.xCa===this.$Jc)return qa.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;qa.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");
return!0};z.prototype.erb=function(){this.Nbg();qa.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.OEa.count,this.xCa);var lc=M.toArray(this.OEa);this.I2i(lc,lc,this.xCa)};z.prototype.tPj=function(){var lc=this.OEa;this.Nbg();M.gpj(lc,this.OEa)||(qa.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.OEa.count),lc=M.toArray(this.OEa),this.F3i(lc,lc));this.s9d&&(qa.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",
this.xCa),this.E3i(this.xCa))};z.prototype.Nbg=function(){for(var lc=new Uc.a(jb.a.Pk()),Nc=El(this.Kn.SensitivityLabels),Nd=Nc.next();!Nd.done;Nd=Nc.next())if((Nd=Nd.value)&&Nd.AutoLabelingSensitiveTypeIds&&0<Nd.AutoLabelingSensitiveTypeIds.length){Nd=El(Nd.AutoLabelingSensitiveTypeIds);for(var le=Nd.next();!le.done;le=Nd.next())(le=le.value)&&lc.add(le)}this.OEa=lc};z.prototype.uxf=function(lc){var Nc=this.U0e(lc.data);Db.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",
!1,!1,this.cac(void 0,Nc,this.Zvb));this.Zvb=null;this.zDa&&(this.zDa.stop(),this.zDa=null);if(this.Mib<=this.vUb){if(this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")){var Nd=lc.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in Nd&&Nd[Ad.a.FMd]&&"HostAttributionInfo.ScenarioTypeParamName"in Nd&&Nd[Ad.a.GMd]){lc.data.request.get_headers();lc.data.request.get_headers();lc=this.N3c(Nc);this.Yac(this.w8,lc,this.jpa,void 0,Nc);return}}this.Wdd(this.w8,Nc,this.jpa)}else qa.ULS.sendTraceTag(34996494,
306,15,"Request to get label policy failed with error response: {0}.",lc?lc.data?lc.data.HQa:null:null),this.erc(),this.Mib=0,this.iKd(!1)};z.prototype.U0e=function(lc){return lc.state?lc.state:0};z.prototype.h4a=function(lc,Nc){Nc=void 0===Nc?!1:Nc;var Nd=String.format("{0}{1}?action={2}&{3}",this.vb.Ua("PolicyHandlerWebServiceBase")||La.AFrameworkApplication.ta.Qa.sW,this.Hde,lc,La.AFrameworkApplication.oj);"setpolicylabel"===lc&&La.AFrameworkApplication.kz&&La.AFrameworkApplication.kz.Mcf&&(Nd=
hd.a.Dl(Nd,"sl","1"));Nc&&(Nd=hd.a.Dl(Nd,"cbd","1"));return Nd};z.prototype.Y1e=function(lc){var Nc;var Nd=Nc=null;lc&&lc.data&&lc.data.request&&lc.data.request.get_headers()&&(Nd=lc.data.request.get_headers()[Zc.a.AWf],Nc=lc.data.request.get_headers()[Zc.a.h_f]);return{zWf:Nd,g_f:Nc}};z.prototype.mXd=function(lc){lc=lc?lc.data?lc.data.ke:null:null;return lc&&lc.length&&!this.ami(lc)?{returnValue:!0,data:lc}:(qa.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),{returnValue:!1,
data:lc})};z.prototype.aWi=function(lc){try{var Nc=pc.b(lc)}catch(Nd){qa.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Nc)if(Nc.IsPolicyTipAvailable)switch(Nc.IsPolicyTipAvailable.toLowerCase()){case "false":qa.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":qa.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.xHc=Nc.NavigateUrl;this.gAj(Nc.GeneralText,
Object(Xa.a)(this,this.mIi,"onDataLossPolicyOverrideButtonClick"));break;default:qa.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Nc.IsPolicyTipAvailable)}else qa.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else qa.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")};z.prototype.tWi=function(lc,Nc,
Nd,le){var ke=this,xd=le?le.QP:2,fc=0,fe="",oa;if(function(){var Rb=pc.d(lc);oa=Rb.dv;return Rb}().returnValue)if(oa){fe="Success";var fb=this.N3c(3);if(oa.IsSuccessful){Db.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.cac(xd,void 0,this.KKb));this.tBb=this.KKb=null;qa.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",xd);2===xd&&this.kda(29);this.esj(Nc,xd);this.rDi();this.kda(28);le&&4===xd&&
this.PYb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,le.displayName),CommonUIStrings.l_DialogOk,function(){});Ja.a("MipAppliedLabels",void 0,void 0,[Object.assign(new we.a,{name:"SetPolicyLabelApplyFlag",string:Oa[xd]})]);this.Yac(Nc,fb,this.jpa,void 0,3);return}qa.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",
xd,oa.FailureReason);this.tBb=oa.FailureReason;"FileTooLarge"===oa.FailureReason?fc=1:"LabelNotSupported"===oa.FailureReason?fc=2:"LabelDisabled"===oa.FailureReason?fc=3:"MinorVersionLimitExceeded"===oa.FailureReason&&(fc=5);this.dmi&&0<=oa.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(le=new Na.a(2,1,this.irj,function(){qa.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",ke.lra);ke.lra<=ke.vUb&&ke.kPd(Nc,
Nd)}),this.se.Sg(le));this.Ufc&&this.supportsOfficeClientCoauthoring&&this.Yac(this.Kn.AppliedPolicyId,fb,this.jpa,!0,3)}else fe="setPolicyLabelData null.",qa.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",xd);else fe="TryDeserialize failed.",qa.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",xd);this.KLd(xd,fc);xd=this.cac(xd,void 0,this.KKb);this.KKb=
null;xd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.tBb);xd.extendedProperties.set("SetPolicyLabelDataParseStatus",fe.toString());Db.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,xd)};z.prototype.KLd=function(lc,Nc){Nc=void 0===Nc?0:Nc;this.setPolicyLabel(this.w8);this.lKf(new R);this.uGd(Nc,lc,2===lc||8===lc||16===lc,!1)};z.prototype.esj=function(lc,Nc){this.setPolicyLabel(this.w8=lc);if(""===lc)La.AFrameworkApplication.protectedFile=!1,La.AFrameworkApplication.enableMacrosForProtectedFile=
!1;else for(var Nd=El(this.Kn.SensitivityLabels),le=Nd.next();!le.done;le=Nd.next())if(le=le.value,le.Id===lc){La.AFrameworkApplication.protectedFile=le.IsEndpointProtectionEnabled;break}this.y3i(new U(lc,Nc))};z.prototype.mRj=function(){for(var lc=El(this.Kn.SensitivityLabels),Nc=lc.next();!Nc.done;Nc=lc.next())(Nc=Nc.value)&&Nc.Enabled&&(Nc.Id===this.w8&&(this.s9d=this.xCa!==Nc.Order,this.xCa=Nc.Order),Nc.Order>this.$Jc&&(this.$Jc=Nc.Order))};z.prototype.jWi=function(lc){var Nc=pc.d(lc);lc=Nc.dv;
if(!Nc.returnValue)return qa.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!lc)return qa.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),!1;if(!lc.AreLabelsAvailable)return!1;this.Kn=lc;this.w8=lc.AppliedPolicyId;this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.mRj();this.aha()&&qa.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");
this.lKf(new R(!0));return!0};z.prototype.ure=function(){if(!this.aha())return qa.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(var lc=El(this.Kn.SensitivityLabels),Nc=lc.next();!Nc.done;Nc=lc.next())if((Nc=Nc.value)&&Nc.AutoLabelingSensitiveTypeIds&&0<Nc.AutoLabelingSensitiveTypeIds.length)return!0;qa.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1};
z.prototype.lKf=function(lc){qa.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.Za.raiseEvent("LabelInfoUpdateEvent",lc)};z.prototype.U2i=function(lc){qa.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.Za.raiseEvent("GetPolicyLabelEventKey",lc)};z.prototype.erc=function(){va.wQa(!1);this.Za.raiseEvent("GetPolicyLabelFailureEventKey",new W)};z.prototype.kGd=function(lc){var Nc=this;this.nP&&this.nP.execute(function(Nd){Nd=[Nd.isFeatureEnabled("MsoClpSpTwo",
!0),Nd.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Nd).then(function(le){Ob.a.any(le,function(ke){return ke})&&(qa.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),Nc.Za.raiseEvent("GetAutoPolicyLabelEventKey",lc),Nc.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&Nc.erb(),Ja.a("MipAutoClassificationEnabled"));return null})})};z.prototype.fed=function(lc,Nc){lc=void 0===lc?null:lc;Nc=void 0===Nc?null:Nc;var Nd=new Map;
Nd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=lc&&Nd.set("ApplyLabelFlags",Oa[lc]);null!=Nc&&Nd.set("GetPolicyLabelsReason",I[Nc]);return Nd};z.prototype.cac=function(lc,Nc,Nd){lc=void 0===lc?null:lc;Nc=void 0===Nc?null:Nc;Nd=void 0===Nd?null:Nd;var le=new Wd.a;le.extendedProperties=this.fed(lc,Nc);null!=Nd&&(le.durationMs=this.Gw()-Nd);return le};z.prototype.y3i=function(lc){qa.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.Za.raiseEvent("SetPolicyLabelEventKey",
lc)};z.prototype.YJf=function(lc){qa.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");lc&&lc.Vzb&&Ja.a("MipRecommendations");this.Za.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.yKf=function(lc){qa.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.Za.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",lc)};z.prototype.x2i=function(lc){qa.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");
this.Za.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",lc)};z.prototype.s3i=function(lc){qa.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");this.Za.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",lc)};z.prototype.gAj=function(lc,Nc){Nc=void 0===Nc?null:Nc;qa.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.Za.raiseEvent("PolicyTipEvent",new D(CommonUIStrings.l_PolicyBusinessBarTitle,lc,CommonUIStrings.l_PolicyOverrideButton,
Nc))};z.prototype.uGd=function(lc,Nc,Nd,le){var ke=this;qa.ULS.sendTraceTag(42074656,306,void 0===le||le?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Nc);if(this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)){le=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var xd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,fc=null,fe=null;switch(lc){case 1:le=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;
xd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 2:le=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;xd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 3:le=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;xd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 4:le=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;
xd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;break;case 5:le=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,xd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,fc=CommonUIStrings.l_LearnMore,fe=function(){ke.i_f()}}lc=new ca(lc,Nc,Nd,le,xd,fc,fe)}else lc=5===lc?new ca(lc,Nc,Nd,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,
CommonUIStrings.l_LearnMore,function(){ke.i_f()}):new ca(lc,Nc,Nd);this.Za.raiseEvent("SetPolicyLabelFailureEventKey",lc)};z.prototype.vqj=function(lc){this.XMc=lc};z.prototype.mIi=function(){this.xHc?(qa.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),Ud.a.tV(this.xHc)):qa.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")};z.prototype.ami=function(lc){if(!lc.startsWith("<")||-1===lc.indexOf("Error")&&-1===lc.indexOf("Unavailable"))return!1;
qa.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0};z.prototype.zGf=function(){this.rVb&&(this.rVb.stop(),this.rVb=null)};z.prototype.wHh=function(lc){if(!lc)return"manual";switch(lc.QP){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";default:return"manual"}};
z.prototype.EIh=function(lc){if(!lc)return"privileged";lc=lc.QP;var Nc="privileged";if(4===lc||1===lc)Nc="standard";return Nc};z.prototype.Yac=function(lc,Nc,Nd,le,ke){Nd=void 0===Nd?null:Nd;le=void 0===le?!1:le;ke=void 0===ke?0:ke;this.vb.ra("WacLabelingGetPolicyLabelsIsEnabled")&&(this.w8=lc,this.jpa=Nd,this.Dh&&(this.zDa=this.Dh.Gc("WebServiceCall","Call Get Policy Endpoint On Server")),Nd={},Nd[Zc.a.WJg]=lc,this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(lc=new Q(this.h4a("getpolicylabels",
le),1,null,Nd,!0,2,ke,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Nc),this.Mg.send(lc).MHd(Object(Xa.a)(this,this.vxf,"onGetPolicyLabelsSuccessCallback"),Object(Xa.a)(this,this.uxf,"onGetPolicyLabelsFailureCallback"))):this.Mg.El(this.h4a("getpolicylabels",le),1,null,Nd,!0,2,Object(Xa.a)(this,this.vxf,"onGetPolicyLabelsSuccessCallback"),Object(Xa.a)(this,this.uxf,"onGetPolicyLabelsFailureCallback"),ke,void 0,void 0,void 0,void 0,"22"),this.Mib++,qa.ULS.sendTraceTag(34996492,
306,50,"Policy label request sent to server. Policy call times: {0}",this.Mib))};z.prototype.hrj=function(lc,Nc,Nd,le){le=void 0===le?null:le;if(this.xyb){this.Dh&&(this.QEa=this.Dh.Gc("WebServiceCall","Call Set Policy Endpoint On Server"));var ke={};ke[Zc.a.AWf]=lc;Nc&&(ke[Zc.a.h_f]=encodeURIComponent(Nc));this.XMc&&(ke[Zc.a.oJg]=this.XMc);le?(ke[Zc.a.e_f]=this.wHh(le),ke[Zc.a.f_f]=this.EIh(le)):(ke[Zc.a.e_f]="manual",ke[Zc.a.f_f]="privileged");this.supportsOfficeClientCoauthoring&&this.Kn&&(ke[Zc.a.cYi]=
this.Kn.PolicyLabelVersionToken);this.vb.ra("SendHostAttributionInfoForPolicyLabelEnabled")?(lc=new Q(this.h4a("setpolicylabel",!0),1,null,ke,!0,2,le,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Nd),this.Mg.send(lc).MHd(Object(Xa.a)(this,this.lCf,"onSetPolicyLabelSuccessCallback"),Object(Xa.a)(this,this.kCf,"onSetPolicyLabelFailureCallback"))):this.Mg.El(this.h4a("setpolicylabel",!0),1,null,ke,!0,2,Object(Xa.a)(this,this.lCf,"onSetPolicyLabelSuccessCallback"),
Object(Xa.a)(this,this.kCf,"onSetPolicyLabelFailureCallback"),le,void 0,void 0,void 0,void 0,"32");this.lra++;qa.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.lra)}else qa.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")};z.prototype.i_f=function(){var lc=new Kb.StandardDialog,Nc=this.vb.Ua("BreadcrumbFolderUrl");Nc?(lc.jc=11,lc.Dc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
lc.Dc(2,CommonUIStrings.l_DialogOk)):(lc.jc=0,lc.Dc(1,CommonUIStrings.l_DialogOk));lc.Ble(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");lc.K9i();lc.xX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,function(Nd){1===Nd&&Nc&&Ud.a.jf(Nc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})};
z.prototype.N3c=function(lc){switch(lc){case 1:return Ad.a.bia(1,1);case 2:return Ad.a.bia(7,1);case 3:return Ad.a.bia(8,1);default:return Ad.a.bia(7,0)}};z.prototype.G6g=function(lc){lc=void 0===lc?null:lc;if(!lc)return Ad.a.bia(8,0);switch(lc.QP){case 1:case 16:return Ad.a.bia(1,1);case 4:case 2:case 8:return Ad.a.bia(8,1);default:return Ad.a.bia(8,0)}};z.prototype.iKd=function(lc){this.vb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",
lc)};Ek.Object.defineProperties(z.prototype,{gnd:{configurable:!0,enumerable:!0,get:function(){return this.MKc}},ood:{configurable:!0,enumerable:!0,get:function(){if(!this.G5d)return!1;for(var lc=El(this.G5d.uZj()),Nc=lc.next();!Nc.done;Nc=lc.next())if(Nc=Nc.value,!Nc.Capabilities||!Nc.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}},Bli:{configurable:!0,enumerable:!0,get:function(){return!!this.LEa}}});Object(Aa.a)(z,"PolicyManager",null,[499]);var qc=b(139),md=b(255);B.prototype.init=
function(){var lc=this;La.AFrameworkApplication.ga.ra("ShouldInitCommonPolicyPackage")&&(La.AFrameworkApplication.ga.ra("IsDataLossPreventionEnabledForUser")&&La.AFrameworkApplication.ta&&(this.Yg=this.tb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.Yg.One(Object(Xa.a)(this,this.lSd,"showPolicyBusinessBar")),qa.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),qc.a.get_instance().Mk(6,function(){lc.Yg.Zac()})),La.AFrameworkApplication.ga.ra("WacLabelingPoliciesIsEnabled")&&
La.AFrameworkApplication.ga.ra("SupportsPolicies")?qc.a.get_instance().Mk(6,Object(Xa.a)(this,this.yFi,"onAfterRibbonBehaviorAttached")):va.wQa(!1))};B.prototype.dispose=function(){};B.prototype.ei=function(lc){lc.register(499,"Common.App.Policy.Contracts.IPolicyManager").Hc().Oc(function(){return new z(La.AFrameworkApplication.ga,La.AFrameworkApplication.Jd,La.AFrameworkApplication.ta.JD,La.AFrameworkApplication.ga.Dd("MaxGetPolicyRetries",1),lc.lc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),
La.AFrameworkApplication.ta.Qa.Sj)});lc.register(va,"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").Hc().Oc(function(){return new va(La.AFrameworkApplication.Ib,La.AFrameworkApplication.ta,La.AFrameworkApplication.ga,lc.pLd("Common.App.Policy.Contracts.IPolicyManager"))});this.tb=lc};B.prototype.yFi=function(){this.z1=this.tb.Kh("CommonUI.BusinessBar");this.Yg||(this.Yg=this.tb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.Rqa=this.tb.resolve("Common.App.Policy.PolicyActor");
La.AFrameworkApplication.ga&&La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Cd.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.Yg.AZb(Object(Xa.a)(this.Rqa,this.Rqa.oNf,"registerActionsHandler")):this.Rqa.Qg();this.Yg.AZb(Object(Xa.a)(this,this.AYd,"updateLabelInfo"));La.AFrameworkApplication.ga.ra("WacApplyManualPolicyLabelIsEnabled")&&(this.Yg.JVc(Object(Xa.a)(this,
this.P3h,"handleSetPolicyLabelFailure")),this.Yg.Fme(Object(Xa.a)(this,this.PYb,"addAutoPolicyBusinessBarEntry")),this.Yg.Rne(Object(Xa.a)(this,this.kda,"removeAutoPolicyBusinessBarEntry")),this.Yg.Gme(Object(Xa.a)(this,this.DUc,"addMandatoryLabellingBusinessBarEntry")),this.Yg.Sne(Object(Xa.a)(this,this.IId,"removeMandatoryLabellingBusinessBarEntry")))};B.prototype.AYd=function(){this.Rqa.a_f();this.Rqa.rZf();this.Rqa.BJf();var lc=this.Yg.FWg();La.AFrameworkApplication.ga.ra("HasDocumentEditRights")&&
!lc?this.Rqa.j$f():qa.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",La.AFrameworkApplication.ga.ra("HasDocumentEditRights"),lc);La.AFrameworkApplication.ta.updateCommandUI()};B.prototype.lSd=function(lc,Nc){this.S0e(Nc.title,Nc.aqc,38,Nc.buf,Nc.buttonText);qa.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")};B.prototype.P3h=
function(lc,Nc){if(Nc.n3f){lc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;var Nd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,le=null,ke=null;La.AFrameworkApplication.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(lc=Nc.title,Nd=Nc.message,le=Nc.buttonText,ke=Nc.UY):1===Nc.errorType?(lc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle,Nd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage):
2===Nc.errorType?(lc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle,Nd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage):La.AFrameworkApplication.ga.ra("ClpLabelDisabledErrorCodeIsEnabled")&&3===Nc.errorType?(lc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle,Nd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage):4===Nc.errorType?(lc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle,
Nd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage):5===Nc.errorType&&(lc=Nc.title,Nd=Nc.message,le=Nc.buttonText,ke=Nc.UY);this.S0e(lc,Nd,21,null,null,ke,le);qa.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user.")}};B.prototype.kda=function(){};B.prototype.PYb=function(lc,Nc){this.z1&&(this.Yg.kda(Nc.mpb),lc=new Ha.a(Nc.title,Nc.message,null),lc.id=Nc.mpb,lc.closeable=!0,lc.image=3,lc.addButton(Nc.buttonText,Nc.UY,
Nc.buttonText,!0),this.z1.lE(lc,!1))};B.prototype.DUc=function(lc,Nc){this.z1&&(lc=new Ha.a(Nc.title,Nc.message,null),lc.id=Nc.mpb,lc.closeable=!1,lc.image=3,lc.addButton(Nc.buttonText,Nc.UY,Nc.buttonText,!1),this.z1.lE(lc,!1))};B.prototype.IId=function(){};B.prototype.S0e=function(lc,Nc,Nd,le,ke,xd,fc){le=void 0===le?null:le;ke=void 0===ke?null:ke;xd=void 0===xd?null:xd;fc=void 0===fc?null:fc;lc=new Ha.a(lc,Nc,null);lc.id=Nd;lc.closeable=!0;le&&lc.hBg(ke,le);xd&&lc.addButton(fc,xd,fc)};B.main=function(){md.a.instance.hj(new B)};
Ek.Object.defineProperties(B.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.Policy"}}});Object(Aa.a)(B,"PackageManager",null,[4,5]);var bd=b(11),Xc=b(615),ne=b(228),ed=b(51),nd=b(36),Ub=b(83),Hc=b(38),pd=b(326),jc=b(387),vd=b(175),ae=b(95),$d=b(30),Bc=b(292),Hd=b(1),xb=b(21),rd=b(291);Object(Aa.a)(E,"ApplyPolicyContextParameters",null,[]);var tf=b(7),Kf=b(905),Ff=b(627),Pe=b(47),Xe=b(44);Object(Aa.a)(y,"AnnotationActivationOptions",null,[]);var de=b(84),Kd=b(932),
pe=b(910),Lf=Kd.a;Am(v,Lf);v.getTypeName=function(){return"AugLoop_SecurityClp_LabellingAnnotation"};v.Ae=function(){return["AugLoop_Core_Annotation"]};Object(Aa.a)(v,"LabellingAnnotation",Kd.a,[]);var Be=b(933),eg=Be.a;Am(n,eg);n.getTypeName=function(){return"AugLoop_SecurityShared_SecurityShared"};n.Ae=function(){return[]};Object(Aa.a)(n,"SecurityShared",Be.a,[]);Am(w,n);w.getTypeName=function(){return"AugLoop_SecurityShared_CLP"};w.Ae=function(){return["AugLoop_SecurityShared_SecurityShared"]};
Object(Aa.a)(w,"CLP",n,[]);var Jc=Kd.a;Am(h,Jc);h.getTypeName=function(){return"AugLoop_Automatic_Clp_LabellingAnnotation"};h.Ae=function(){return["AugLoop_Core_Annotation"]};Object(Aa.a)(h,"LabellingAnnotation",Kd.a,[]);var Yd=b(1173),Ge=b(1075),ud=b(1175),Ye=Kd.a;Am(r,Ye);r.getTypeName=function(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"};r.Ae=function(){return["AugLoop_Core_Annotation"]};Object(Aa.a)(r,"LinkedDataTypeAnnotation",Kd.a,[]);var mf=Hc.a;Am(m,mf);m.prototype.dispose=function(){this.disposed||
(this.disposed=!0,this.gdh(),this.cHe(),this.PDd=this.policyManager=this.augmentationLoopManager=null,mf.prototype.dispose.call(this))};m.prototype.jZa=function(lc,Nc,Nd,le,ke){ke=void 0===ke?!1:ke;qa.ULS.sendTraceTag(537154642,306,50,"AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource {0} with AutoLabelPresent: {1}, RecommendedLabelPresent: {2}, isStandard: {3}.",le,!!lc,!!Nc,ke);this.sc?this.PDd&&(this.gUg(Nc,le)?(this.gFd=Nc,this.bFd=le,this.ijf.ia(le,Nc)):Nc=this.gFd,lc=this.PDd.jZa(lc,
Nc,Nd,ke),qa.ULS.sendTraceTag(537154640,306,50,"AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned {0}.",lc)):qa.ULS.sendTraceTag(537154641,306,15,"AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.sc)};m.prototype.gUg=function(lc,Nc){if(!this.policyManager.aha())return qa.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),!1;var Nd=this.policyManager.Kn;
var le=this.ijf.Nc(this.bFd).value;var ke=null,xd=null,fc=null;Nd=El(Nd.SensitivityLabels);for(var fe=Nd.next();!fe.done;fe=Nd.next())fe=fe.value,fe.Id===lc&&(ke=fe),fe.Id===le&&(xd=fe),fe.Id===this.gFd&&(fc=fe);return xd&&xd.Id===lc?(qa.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.sC(39)&&this.bFd!==Nc&&fc&&(!ke||fc.Order>=ke.Order)?(qa.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0};m.prototype.bnd=function(){return Hd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)};m.prototype.Y6i=function(){this.policyManager.Fme(this.z2f);this.policyManager.Rne(this.kOf);this.$.ea.N2(this.o6);this.bnd()&&(this.policyManager.fEg(this.erb),this.policyManager.XGg(this.Lbg),this.policyManager.YGg(this.Mbg))};
m.prototype.gdh=function(){this.businessBar.removeEntry(39);this.businessBar.removeEntry(38);this.policyManager.z$i(this.z2f);this.policyManager.Xbj(this.kOf);this.$.ea.x0(this.o6);Hd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&(this.policyManager.jaj(this.erb),this.policyManager.Bcj(this.Lbg),this.policyManager.Ccj(this.Mbg))};m.prototype.K8h=function(){this.UA=new Kf.a(Ff.a.gK());var lc=this.bnd()?v.getTypeName():h.getTypeName();this.UA.add(1,Object(tf.a)(new y,
{annotationType:lc,iGa:this.Opi,sF:!1,OLa:!1}));this.UA.add(2,Object(tf.a)(new y,{annotationType:r.getTypeName(),iGa:this.Lri,sF:!1,OLa:!1}))};m.prototype.L6f=function(){for(var lc=El(this.n$a),Nc=lc.next();!Nc.done;Nc=lc.next())this.augmentationLoopManager.submitOperation(Nc.value);this.n$a=[]};m.prototype.T6i=function(lc){if(!this.UA.xb(lc))return qa.ULS.sendTraceTag(537154636,306,15,"AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource {0}.",lc),
!1;if(this.UA.oa(lc).sF)return qa.ULS.sendTraceTag(537154635,306,15,"AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource {0}.",lc),!0;this.UA.oa(lc).sF=!0;qa.ULS.sendTraceTag(537154634,306,50,"AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource {0}.",lc);if(!this.$.isEditMode)return qa.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;Hd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.Yxb():this.J9e();return!0};m.prototype.J9e=function(){for(var lc=this,Nc=!1,Nd=El(this.UA),le=Nd.next();!le.done&&!(Nc=le.value.value.sF||Nc);le=Nd.next());Nc?this.augmentationLoopManager?(qa.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.oYb()):this.FZa?qa.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):
(this.FZa=!0,Nc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,qa.ULS.sendTraceTag(537154629,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in {0} milliseconds.",Nc),Pe.a.instance.create(function(){lc.M8h()},Nc,Xe.a.Rse,!0,!0)):qa.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")};m.prototype.Yxb=function(){var lc=this,Nc=0<this.n$a.length;if(!Nc)for(var Nd=
El(this.UA),le=Nd.next();!le.done&&!(Nc=le.value.value.sF||Nc);le=Nd.next());Nc?this.augmentationLoopManager?(qa.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.oYb(),this.L6f()):this.FZa?qa.ULS.sendTraceTag(537154626,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.FZa=!0,Nc=this.$.ya.FlightingSettings.AutoCLPStartUpDelay,qa.ULS.sendTraceTag(537154625,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in {0} milliseconds.",Nc),Pe.a.instance.create(function(){lc.N8h()},Nc,Xe.a.Rse,!0,!0)):qa.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")};m.prototype.N8h=function(){var lc=this;nd.TaskExtensions.Ba(ed.GetServiceTaskFactory.Va(this.$.da,328,327,1),function(Nc){lc.augmentationLoopManager=Nc.result;lc.FZa=!1;lc.augmentationLoopManager?
(qa.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),lc.augmentationLoopManager.oUc(lc.Hmc),lc.$.isEditMode?(lc.oYb(),lc.L6f()):qa.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):qa.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};m.prototype.M8h=function(){var lc=this;
nd.TaskExtensions.Ba(ed.GetServiceTaskFactory.Va(this.$.da,328,327,1),function(Nc){lc.augmentationLoopManager=Nc.result;lc.FZa=!1;lc.augmentationLoopManager?(qa.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),lc.augmentationLoopManager.oUc(lc.Hmc),lc.$.isEditMode?lc.oYb():qa.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):qa.ULS.sendTraceTag(537154593,306,
10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)};m.prototype.cHe=function(){for(var lc=El(this.UA),Nc=lc.next();!Nc.done;Nc=lc.next())Nc=Nc.value,Nc.value.sF&&this.fdh(Nc.key)};m.prototype.fdh=function(lc){this.UA.oa(lc).OLa&&this.$Fe(lc);this.UA.oa(lc).sF=!1;qa.ULS.sendTraceTag(537154591,306,50,"AutoPolicyManager::DeregisterAnnotation completed for LabellingSource {0}.",lc)};m.prototype.oYb=function(){for(var lc=El(this.UA),Nc=lc.next();!Nc.done;Nc=
lc.next())Nc=Nc.value,Nc.value.sF&&!Nc.value.OLa&&this.activateAnnotation(Nc.key)};m.prototype.activateAnnotation=function(lc){this.augmentationLoopManager.activateAnnotation(this.UA.oa(lc).annotationType);this.augmentationLoopManager.jM(this.UA.oa(lc).annotationType,this.UA.oa(lc).iGa);this.UA.oa(lc).OLa=!0;qa.ULS.sendTraceTag(537154590,306,50,"AutoPolicyManager::ActivateAnnotation completed for LabellingSource {0}.",lc)};m.prototype.wbh=function(){for(var lc=El(this.UA),Nc=lc.next();!Nc.done;Nc=
lc.next())Nc=Nc.value,Nc.value.OLa&&this.$Fe(Nc.key)};m.prototype.$Fe=function(lc){this.augmentationLoopManager.lQa(this.UA.oa(lc).annotationType,this.UA.oa(lc).iGa);this.UA.oa(lc).OLa=!1;qa.ULS.sendTraceTag(537154589,306,50,"AutoPolicyManager::DeactivateAnnotation completed for LabellingSource {0}.",lc)};m.prototype.applyPolicyLabel=function(lc,Nc,Nd,le){var ke=this;if(this.ga.ra("SupportsOfficeClientCoauthoring"))qa.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),
this.jZa(lc,Nc,Nd,le);else{qa.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");var xd=function(fc){ke.jZa(lc,Nc,Nd,le,0===fc||1===fc||4===fc)};this.agd(xd,function(){xd(2)},this.Hof)}};m.prototype.GXc=function(lc,Nc){var Nd=this.W$f(lc);lc=Nd.sensitivityLabel;var le=Nd.mGa;if(!Nd.returnValue)return qa.ULS.sendTraceTag(537154577,306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(le&&le.Order>=
lc.Order)return qa.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(lc.Id,lc.Id,null,Nc);return!0};m.prototype.HXc=function(lc,Nc){var Nd=this;Nc=!1;var le=null,ke=null;if(!function(){var fe=Nd.W$f(lc);le=fe.sensitivityLabel;ke=fe.mGa;return fe}().returnValue)return qa.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),{returnValue:!1,nMa:Nc};if(ke&&
ke.ParentId&&le.ParentId&&ke.ParentId===le.ParentId)return qa.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,nMa:Nc};if(ke&&ke.Order>=le.Order)return qa.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,nMa:Nc};if(this.ga.ra("SupportsOfficeClientCoauthoring")){qa.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled.");var xd=this.policyManager.Kn;xd=!xd.AppliedPolicyId||!xd.PolicyLabelAssignmentMethod||wb.c(xd.PolicyLabelAssignmentMethod)===wb.c("standard");this.nre(le.Id,xd)}else{qa.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");var fc=function(fe){Nd.nre(le.Id,0===fe||1===fe||4===fe)};this.agd(fc,function(){fc(2)},
this.Hof)}return{returnValue:!0,nMa:Nc}};m.prototype.agd=function(lc,Nc,Nd,le){var ke=this;le=void 0===le?0:le;if(this.sc){var xd=this.$.na.ua.hc();u(this.$.na.ua,this.$.ya.DocumentHostInfo.TenantId,function(fc){ke.gUh(fc,lc)},function(){ke.fUh(lc,Nc,Nd,le)},null,null,xd)}else qa.ULS.sendTraceTag(537154570,306,15,"AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.sc)};m.prototype.gUh=function(lc,Nc){qa.ULS.sendTraceTag(537154569,
306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.sc?!lc||Bc.a(lc)?qa.ULS.sendTraceTag(537154567,306,15,lc?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Nc(lc.Result):qa.ULS.sendTraceTag(537154568,306,50,"AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.sc)};m.prototype.fUh=
function(lc,Nc,Nd,le){qa.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");this.sc?le>=Nd?(qa.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Nc()):this.agd(lc,Nc,Nd,le+1):qa.ULS.sendTraceTag(537154565,306,50,"AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: {0}, IsSessionActive: {1}.",this.disposed,this.$.ea.sc)};m.prototype.nre=
function(lc,Nc){Nc?this.jZa(lc,null,null,3,!0):this.jZa(null,lc,null,3,!1)};m.prototype.W$f=function(lc){var Nc;var Nd=Nc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Nc,mGa:Nd};if(!this.policyManager.aha())return qa.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Nc,mGa:Nd};var le=this.policyManager.Kn;if(!le)return qa.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),
{returnValue:!1,sensitivityLabel:Nc,mGa:Nd};if(Ob.a.Fh(le.SensitivityLabels))return qa.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),{returnValue:!1,sensitivityLabel:Nc,mGa:Nd};var ke=le.AppliedPolicyId;lc=El(lc);for(var xd=lc.next();!xd.done;xd=lc.next()){xd=xd.value;for(var fc=El(le.SensitivityLabels),fe=fc.next();!fe.done;fe=fc.next())fe=fe.value,fe.Id===xd&&(!Nc||Nc.Order<fe.Order)&&(Nc=fe),fe.Id===
ke&&(Nd=fe)}return Nc?{returnValue:!0,sensitivityLabel:Nc,mGa:Nd}:(qa.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Nc,mGa:Nd})};Ek.Object.defineProperties(m.prototype,{sc:{configurable:!0,enumerable:!0,get:function(){return!this.disposed&&this.$.ea.sc}}});Object(Aa.a)(m,"AutoPolicyManager",Hc.a,[3]);var xe=b(158),Qe=b(12),jg=b(15),je=xe.ErrorDialog;Am(l,je);l.prototype.tm=function(){var lc=this;je.prototype.tm.call(this);
if(this.error.Appearance&1&&this.$.Pd&2){var Nc=this.getButton(0);Qe.DOMElementExtensions.BOd(Nc.get_element(),jg.a.instance.fa(1285));this.MP(function(){0===lc.returnValue&&lc.$.Pd&2&&(qa.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),nd.TaskExtensions.Ba(ed.GetServiceTaskFactory.Va(lc.$.da,55,56,0),function(Nd){Nd.result.D2c()},lc.$.la,3))})}};l.WQ=function(lc){return lc.Pd&2?$d.a.gd(3,1,0,1928,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
$d.a.gd(1,1,0,1929,0,-313914360,"SensitivityLabelBlockApplyLabel")};Object(Aa.a)(l,"BlockSenitivityLabelActionDialog",xe.ErrorDialog,[]);var pf=Hc.a;Am(f,pf);f.prototype.initialize=function(){var lc=this;this.ga.ra("SupportsPolicies")?(this.UDa=this.ga.Ua("AppliedPolicyId"),this.K6.Qg(),this.$.da.$a(29,function(Nc){lc.statusBarManager=Nc;Nc.yJ(lc)}),this.Oz(),xb.a.Fh(this.ga.Ua("HostUserId"))||this.dYi(),this.K6.$6i(this.eOg),this.K6.S7i(this.Fdi),this.Br.W6i(this.ood),this.Ao=Hd.EwaSettings.getBooleanFeatureGate(pd.a.IPa,
!1)):Hd.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Cd.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!0));!xb.a.Fh(this.ga.Ua("HostUserId"))&&Hd.EwaSettings.ma(170)&&this.$.ea.Zg.get(45)&&(qa.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.mNh())};f.prototype.Aq=function(lc){this.addHandler("LabelInfoChangedKey",lc)};f.prototype.Wq=function(lc){this.removeHandler("LabelInfoChangedKey",
lc)};f.prototype.vn=function(){return!0};f.prototype.es=function(lc,Nc){if("QueryPolicyLabel"!==lc)return!1;if(this.XRa())return Nc.Visible=!1,!0;Nc.Visible=!0;return 32===La.AFrameworkApplication.Ib.ve(zb.a.vab,2,Nc)};f.prototype.dispose=function(){this.statusBarManager&&(this.statusBarManager.SF(this),this.statusBarManager=null);this.K6.WNb();this.FYc=!1;this.Br.ncj(this.P3f);this.Br.ocj(this.jCf);this.$.ea.Ev(this.Sja);if(this.ga.ra("SupportsOfficeClientCoauthoring")){var lc=this.$.da.Aa(292);
lc&&lc.abj(this.zyf)}this.Br.B$i(this.Hle);this.Br.Ybj(this.IOf);this.Br.kbj(this.vof);this.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&this.Br.zcj(this.xag);Hd.EwaSettings.ma(292)&&this.Br.Gaj(this.OKe);this.i$&&(this.i$.dispose(),this.i$=null);pf.prototype.dispose.call(this)};f.prototype.GXc=function(lc,Nc){if(!this.ga.ra("SupportsPolicies"))return qa.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),
!1;if(!this.QDd)return qa.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(Ob.a.Fh(lc))return!1;this.i$||this.Cld();return this.i$.GXc(lc,Nc)};f.prototype.Oz=function(){this.raiseEvent("LabelInfoChangedKey")};f.prototype.mNh=function(){var lc=this;Hd.EwaSettings.isChangeGateEnabled("OfficeVSO:6000793_RibbonDisplayedDependencyInDataLossPolicyCall")?qc.a.get_instance().Mk(10,function(){lc.Br.Zac()}):this.Br.Zac()};f.prototype.dYi=function(){var lc=
this;qc.a.get_instance().Mk(10,function(){lc.Br.AZb(lc.AYd);lc.Br.IEg(lc.txf);lc.Br.HEg(lc.txf);lc.Br.JVc(lc.P3f);lc.Br.boe(lc.jCf);lc.$.ea.Ot(lc.Sja);lc.Br.Gme(lc.Hle);lc.Br.Sne(lc.IOf);lc.Br.pFg(lc.vof);lc.ga.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelHasUDPEnabled",!1)&&lc.Br.UGg(lc.xag);if(lc.ga.ra("SupportsOfficeClientCoauthoring")){var Nc=lc.$.da.Aa(292);Nc&&Nc.gFg(lc.zyf)}Hd.EwaSettings.ma(292)&&(qa.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),
lc.Br.FEg(lc.OKe));lc.Ryh()});this.$.Pcb("sensitivity",!0)};f.prototype.Ryh=function(){this.ga.ra("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.I3a():this.xIh(this.$.ya.DocumentHostInfo.TenantId)};f.prototype.Cld=function(){this.i$=new m(this.K6,this.Br,this.$,this.ga,this.sE)};f.prototype.qNf=function(lc){if(!this.ga.ra("SupportsPolicies"))return qa.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),
!1;this.i$||this.Cld();return this.i$.T6i(lc)};f.prototype.HXc=function(lc,Nc){if(Hd.EwaSettings.isChangeGateEnabled("OfficeVSO:5697254_ApplyPowerBiLabel")){if(!this.ga.ra("SupportsPolicies"))return qa.ULS.sendTraceTag(537154517,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,nMa:!1};if(!this.QDd)return qa.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),
{returnValue:!1,nMa:!0};this.i$||this.Cld();return this.i$.HXc(lc,Nc)}qa.ULS.sendTraceTag(537154515,306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when BRS ApplyPowerBiLabel is disabled.");return{returnValue:!1,nMa:!1}};f.prototype.xIh=function(lc){var Nc=this;qa.ULS.sendTraceTag(537154514,306,50,"PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length {0}",lc.length);var Nd=this.$.na.ua.hc();t(this.$.na.ua,lc,function(le){Nc.NFj(le)},null,null,null,
Nd)};f.prototype.NFj=function(lc){qa.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");lc&&!Bc.a(lc)&&(this.UDa=lc.Result);this.I3a();this.labelId?qa.ULS.sendTraceTag(537154512,306,50,"PolicyManagerWrapper: Fetched LabelId length from custom.xml is {0}",this.labelId.length):qa.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")};f.prototype.I3a=function(){this.Br.Wdd(this.labelId,void 0,void 0,!1)};f.prototype.nRe=
function(){if(!this.FYc){this.$.Bf();this.FYc=!0;this.sE.C5e();var lc={};lc.hasLabel=!!this.labelId&&0<this.labelId.length;lc.isProtectedFile=this.ga.ra("ProtectedFile");lc.SupportsPolicies=this.ga.ra("SupportsPolicies");lc.AreLabelsAvailableForDisplay=this.Br.aha();lc.SupportsOfficeClientCoauthoring=this.ga.ra("SupportsOfficeClientCoauthoring");lc.IsAnonymousUser=this.ga.ra("IsAnonymousUser");qa.ULS.sendTraceTag(51238051,306,50,"CLPUsage : {0}",JSON.stringify(lc))}};f.prototype.fKg=function(){this.K6.gKg(this.Pxa);
this.Pxa=null};f.prototype.m5h=function(lc){lc=El(lc.LabelActions);for(var Nc=lc.next();!Nc.done;Nc=lc.next())if(xb.a.equals(Nc.value.Name,"ApplyWatermark",!1))return!0;return!1};f.prototype.oyj=function(lc){lc?(new l(this.$)).kf():qa.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")};f.prototype.applyPolicyLabel=function(lc,Nc,Nd,le){var ke=this,xd=pc.c(this.Br.Kn);if(void 0===lc||null===
lc)lc="";var fc=new E;fc.$pc=lc;fc.pXf=le;fc.QP=Nc;var fe=this.$.na.ua;jc.a(this.$.userOperationManager,function(oa,fb,Rb){fb=lc;var dc=ke.$.ya.DocumentHostInfo.TenantId;oa=rd.b.call(null,ke.IFi,oa);var uc=fe.Na(41,null);uc.labelsInfoJson=xd;uc.appliedLabelId=fb;uc.tenantId=dc;uc.applyLabelFlag=Nc;uc.skipApplyOutcomes=Nd;return de.i(fe,"ApplyPolicyLabel",uc,oa,null,Rb,fc,0)},function(oa){return new vd.a(222,0,oa)},null);this.kCc=!1;this.VNd=null};f.prototype.XRa=function(){var lc=this.$.da.Aa(478);
return this.Ao&&lc?lc.Ao():!1};Ek.Object.defineProperties(f.prototype,{title:{configurable:!0,enumerable:!0,get:function(){return this.Sp}},aqc:{configurable:!0,enumerable:!0,get:function(){return this.Jde}},linkText:{configurable:!0,enumerable:!0,get:function(){return this.Kfa}},vNi:{configurable:!0,enumerable:!0,get:function(){return this.Cce}},labelId:{configurable:!0,enumerable:!0,get:function(){return this.UDa}}});Object(Aa.a)(f,"PolicyManagerWrapper",Hc.a,[483,271,614]);var qg=ne.a;Am(e,qg);
e.prototype.create=function(){var lc=this,Nc=ed.GetServiceTaskFactory.Va(this.$.da,5,4,this.ub),Nd=La.AFrameworkApplication.Jd,le=La.AFrameworkApplication.ga;nd.TaskExtensions.Ba(Nc,function(){try{var ke=new Xc.a(function(){return new z(le,Nd,La.AFrameworkApplication.ta.JD,lc.$.ya.MaxGetPolicyRetries,Xb.a.instance.lc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))}),xd=new Xc.a(function(){return new va(La.AFrameworkApplication.Ib,La.AFrameworkApplication.ta,La.AFrameworkApplication.ga,
ke)}),fc=lc.$.da.Aa(274);fc||(fc=new f(ke.value,xd.value,Nc.result,lc.$,La.AFrameworkApplication.ga),fc.initialize());lc.Eb(fc)}catch(fe){throw qa.ULS.sendTraceTag(537154525,306,10,"PolicyManager was not created successfully [Exception: {0}]",fe.toString()),fe;}},this.la,3)};e.ka=function(lc){lc.da.Ga(275,new e(lc))};Object(Aa.a)(e,"PolicyManagerFactory",ne.a,[]);var Gf=b(906),Mg=b(186);c.prototype.Zc=function(){return!1};c.prototype.executeCommand=function(lc,Nc,Nd){switch(Nc.command){case zb.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||
(Nd[fa.zWc]=this.$.workbookContext.ExclusiveLockId),lc=La.AFrameworkApplication.Ib.ve(zb.a.setSensitivity,2,Nd),hc.Task.Sa(32===lc);case zb.a.S6:return lc=La.AFrameworkApplication.Ib.ve(zb.a.S6,2,Nd),hc.Task.Sa(32===lc);case zb.a.T6:return lc=La.AFrameworkApplication.Ib.ve(zb.a.T6,2,Nd),hc.Task.Sa(32===lc);default:return Mg.a(Nc.command)}};c.prototype.Lc=function(lc,Nc){switch(Nc.command){case zb.a.setSensitivity:case zb.a.S6:case zb.a.T6:return!0;default:return!1}};c.prototype.jd=function(lc,Nc,
Nd){switch(Nc){case "PopulateSensitivityFlyout":return 32===La.AFrameworkApplication.Ib.ve(zb.a.fza,2,Nd);default:return!1}};Object(Aa.a)(c,"SensitivityCommandHandler",null,[429]);var dg=Gf.a;Am(a,dg);a.prototype.Nd=function(){this.Cd([new c(this.$)])};a.ka=function(lc){Gf.a.fe(316,new a(lc))};Object(Aa.a)(a,"SensitivityCommandHandlerFactory",Gf.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");B.main();(function(){bd.a.Fa(function(lc){e.ka(lc);
a.ka(lc)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.policy.js.map/8b7e6f61ec1ff03115e275e1264054a0/EwaDS.policy.js.map