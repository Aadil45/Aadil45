(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1E3:function(x,C,b){function a(){}b.d(C,"a",function(){return a});x=b(0);a.abs="Abs";a.rel="Rel";Object(x.a)(a,"PositionBaseType",null,[])},1014:function(x,C,b){function a(Q){this.calcManager=Q}function c(){return w.call(this)||this}function e(){this.secondRow=this.firstRow=null;return this}function f(){return w.call(this)||this}function l(){this.right=this.left=this.bottom=this.top=null;return this}function m(){return w.call(this)||
this}function r(){this.secondColumn=this.firstColumn=null;return this}function h(){var Q=w.call(this)||this;Q.Fhc=!1;return Q}function w(){this.end=this.start=0;this.Bv=null}function n(){this.column=this.row=null;return this}function v(){}b.r(C);x=b(0);var u=b(7),t=b(14);Object(x.a)(v,"Reference",null,[]);Am(n,v);Object(x.a)(n,"CellReference",v,[]);w.prototype.$Jg=function(Q,P){for(var L=0;L<this.Bv.length;L++){var ca=this.L_b(Q,this.Bv[L]);P+=ca;L<this.Bv.length-1&&(P+=":")}return P};Object(x.a)(w,
"IReferenceSequence",null,[]);var y=b(25),E=b(1E3);Am(h,w);h.prototype.Pbc=function(){var Q=b(1014).RelativeAndAbsoluteReferencesManager,P=this.Bv[0];return Q.prf(P.row.kind===E.a.abs,P.column.kind===E.a.abs)};h.prototype.L_b=function(Q,P){P=y.Range.hd(P.row.index+1,P.column.index+1);return this.Fhc?P.$ac(1===Q||3===Q,1===Q||2===Q):P.n4a(1===Q||3===Q,1===Q||2===Q,!0,!0)};Object(x.a)(h,"CellReferenceSequence",w,[]);Am(r,v);Object(x.a)(r,"ColumnReference",v,[]);Am(m,w);m.prototype.Pbc=function(){var Q=
this.Bv[0];return b(1014).RelativeAndAbsoluteReferencesManager.Opf(Q.firstColumn,Q.secondColumn).kind===E.a.abs?2:3};m.prototype.L_b=function(Q,P){return y.Range.yub(P.firstColumn.index+1,P.secondColumn.index+1).n4a(1===Q||3===Q,!0,1===Q||3===Q,!0)};Object(x.a)(m,"ColumnReferenceSequence",w,[]);Am(l,v);Object(x.a)(l,"RangeReference",v,[]);Am(f,w);f.prototype.Pbc=function(){var Q=b(1014).RelativeAndAbsoluteReferencesManager,P=this.Bv[0];return Q.prf(P.top.kind===E.a.abs,P.left.kind===E.a.abs)};f.prototype.L_b=
function(Q,P){P=new y.Range(P.top.index+1,P.left.index+1,P.bottom.index+1,P.right.index+1,!1,!1);var L=1===Q||3===Q;Q=1===Q||2===Q;return P.n4a(L,Q,L,Q)};Object(x.a)(f,"RangeReferenceSequence",w,[]);Am(e,v);Object(x.a)(e,"RowReference",v,[]);Am(c,w);c.prototype.Pbc=function(){var Q=this.Bv[0];return b(1014).RelativeAndAbsoluteReferencesManager.Opf(Q.firstRow,Q.secondRow).kind===E.a.abs?0:1};c.prototype.L_b=function(Q,P){return y.Range.K$b(P.firstRow.index+1,P.secondRow.index+1).n4a(!0,1===Q||2===
Q,!0,1===Q||2===Q)};Object(x.a)(c,"RowReferenceSequence",w,[]);var B=b(1184),z=b(1185),M=b(205);b.d(C,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.$0a=function(Q,P,L){var ca=P;var U=L;if(!Q||!M.e(Q))return{returnValue:Q,Uxd:ca,Txd:U};var aa=this.calcManager.QRe(Q);if(!aa)return t.ULS.sendTraceTag(524039641,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),{returnValue:null,Uxd:ca,
Txd:U};aa=this.WWh(aa,Q,P,L);for(var F=0,D="",J=0,R=0;R<aa.length;R++)if(this.XIe(aa[R],P,L)){F=aa[R].Pbc();ca=aa[R].start;break}for(;R<aa.length&&this.XIe(aa[R],P,L);R++)D+=Q.substring(J,aa[R].start),D=aa[R].$Jg(F,D),J=aa[R].end;J&&(U=D.length);D+=Q.substring(J,Q.length);return{returnValue:D,Uxd:ca,Txd:U}};a.prototype.WWh=function(Q,P,L,ca){for(var U=[],aa=0;aa<Q.length;aa++){var F=Q[aa];if(F.kind===B.a.range)if(F=F.ref,F.type===z.a.cell){var D=F;F=Object(u.a)(new h,{start:F.span.start,end:F.span.end,
Bv:[Object(u.a)(new n,{column:D.col,row:D.row})],Fhc:this.calcManager.a2b(F.span.end,P)});U.push(F)}else if(F.type===z.a.range)this.YIe(F.topLeftSpan,L,ca)&&this.YIe(F.bottomRightSpan,L,ca)?(D=new l,F.top.index<=F.bottom.index?(D.top=F.top,D.bottom=F.bottom):(D.bottom=F.top,D.top=F.bottom),F.left.index<=F.right.index?(D.left=F.left,D.right=F.right):(D.right=F.left,D.left=F.right),F=Object(u.a)(new f,{start:F.topLeftSpan.start,end:F.bottomRightSpan.end,Bv:[D]}),U.push(F)):(D=Object(u.a)(new h,{start:F.topLeftSpan.start,
end:F.topLeftSpan.end,Bv:[Object(u.a)(new n,{column:F.left,row:F.top})],Fhc:this.calcManager.a2b(F.topLeftSpan.end,P)}),F=Object(u.a)(new h,{start:F.bottomRightSpan.start,end:F.bottomRightSpan.end,Bv:[Object(u.a)(new n,{column:F.right,row:F.bottom})],Fhc:this.calcManager.a2b(F.topLeftSpan.end,P)}),U.push(D),U.push(F));else if(F.type===z.a.column){D=F;for(F=Object(u.a)(new m,{start:F.span.start,end:F.span.end,Bv:[Object(u.a)(new r,{firstColumn:D.startIndex,secondColumn:D.endIndex})]});F.end<P.length-
1&&":"===P.charAt(F.end)&&aa<Q.length-1;)if(D=Q[aa+1].ref,D.type===z.a.column&&D.span.start===F.end+1){var J=D;F.Bv.push(Object(u.a)(new r,{firstColumn:J.startIndex,secondColumn:J.endIndex}));F.end=D.span.end;aa++}else break;U.push(F)}else if(F.type===z.a.row){D=F;for(F=Object(u.a)(new c,{start:F.span.start,end:F.span.end,Bv:[Object(u.a)(new e,{firstRow:D.startIndex,secondRow:D.endIndex})]});F.end<P.length-1&&":"===P.charAt(F.end)&&aa<Q.length-1;)if(D=Q[aa+1].ref,D.type===z.a.row&&D.span.start===
F.end+1)J=D,F.Bv.push(Object(u.a)(new e,{firstRow:J.startIndex,secondRow:J.endIndex})),F.end=D.span.end,aa++;else break;U.push(F)}}return U};a.prototype.XIe=function(Q,P,L){return!(Q.start>L||P>Q.end)};a.prototype.YIe=function(Q,P,L){return!(Q.start>L||P>Q.end)};a.Opf=function(Q,P){return Q.index<=P.index?Q:P};a.prf=function(Q,P){return P||Q?P&&Q?2:!P&&Q?3:0:1};Object(x.a)(a,"RelativeAndAbsoluteReferencesManager",null,[672])},1142:function(x,C,b){function a(y){var E=this;this.$=y;(this.Ll=this.$.da.Aa(268))||
e.ULS.shipAssertTag(537170070,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var B=n.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?w.a.current.kp(53):w.a.current.kp(56);this.logger=new h.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Yba=new c(y,this.Ll);excelOnlineCalc.config.initCalc(this.logger,this.Ll?function(z){return E.Ll.isFeatureEnabled(z)}:
function(){return!1},B);this.nmg=excelOnlineCalc.config.calcConfig(this.Yba.localeInfo)}function c(y,E){y=b(1142).CalcHelper;E&&(E.Oe||e.ULS.shipAssertTag(537169942,0,!1,"LocaleHolder constructor - locale information is not available"));this.Lrg=y.PDe(E,y.CDe(E.gja));this.Mrg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(C);x=b(0);var e=b(14),f=b(275),l;(function(y){y[y.paren=0]="paren";y[y.lead=1]="lead";y[y.intern=2]="intern";y[y.trail=3]="trail";y[y.undefined=4]="undefined"})(l||
(l={}));Object(x.b)("CurrencyFormatOption",l);var m;(function(y){y[y.none=-1]="none";y[y.mdy=0]="mdy";y[y.dmy=1]="dmy";y[y.ymd=2]="ymd";y[y.myd=3]="myd";y[y.dym=4]="dym";y[y.ydm=5]="ydm"})(m||(m={}));Object(x.b)("DateOrderOption",m);var r=b(9);c.prototype.formatNumber=function(y){return this.localeInfo.formatNumber(y)};Ek.Object.defineProperties(c.prototype,{localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Mrg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.Lrg}}});
Object(x.a)(c,"LocaleHolder",null,[]);var h=b(1182),w=b(54),n=b(1),v=b(21),u=b(15),t=b(204);b.d(C,"CalcHelper",function(){return a});a.prototype.rah=function(){if(n.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.xa)return e.ULS.shipAssertTag(537170069,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var y=this.$.xa.qa;return y?y.index:(e.ULS.shipAssertTag(537170068,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.xa.qa.index};
a.prototype.createParser=function(){var y={};y.config=this.config;return excelOnlineCalc.parse.createParser(y)};a.prototype.createNumberFormatter=function(){var y=this,E=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(B,z){return excelOnlineCalc.calc.getTime(y.config,B,z,"Estimation")});return excelOnlineCalc.numfmt.createNumberFormatter(E)};a.prototype.F9g=function(y,E,B,z){if(!z)return{range:{row:E,col:B},sheet:{document:this.documentLoc,index:y}};E=excelOnlineCalc.location.gridCell(E,
B);y=excelOnlineCalc.location.sheetIndex(this.documentLoc,y);return excelOnlineCalc.location.sheetGridCell(y,E)};a.prototype.Olh=function(y,E){var B=excelOnlineCalc.calc.getEvalResultKind(y);switch(B){case 4:return{returnValue:y?this.Yba.localeInfo.trueName:this.Yba.localeInfo.falseName,kind:B};case 1:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.JAc(this.Yba.formatNumber(y),E):this.Yba.formatNumber(y),kind:B};case 2:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.JAc(y.toString(),E):y.toString(),kind:B};case 128:return{returnValue:"",kind:B};case 8:switch(y.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Yba.localeInfo.errorNames[y.type],kind:B};default:return{returnValue:a.unknownError,kind:B}}case 32:return{returnValue:n.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.JAc(this.W9g(y,E),E):"##UNSUPPORTED: ARRAY",kind:B};default:return{returnValue:u.a.instance.fa(2167),
kind:B}}};a.prototype.JAc=function(y,E){return y.length<=E?y:y.substring(0,E-3)+"..."};a.prototype.W9g=function(y,E){for(var B=this.Yba.localeInfo.leftBrace,z=0;z<y.rows;++z){for(var M=0;M<y.cols;++M)B+=y.opers[z][M],M<y.cols-1&&(B+=this.Yba.localeInfo.columnSeparator);z<y.rows-1&&(B+=this.Yba.localeInfo.rowSeparator)}return this.JAc(B,E-1)+this.Yba.localeInfo.rightBrace};a.PDe=function(y,E){E=void 0===E?null:E;var B=a.E4b(),z=y.Oe.TrueValueString,M=y.Oe.FalseValueString,Q=y.Oe.DecimalSeparator.toString(),
P=y.Oe.ListSeparator.toString(),L=y.Oe.ColumnSeparator.toString(),ca=y.Oe.RowSeparator.toString(),U=y.Oe.ThousandsDataArray,aa=y.Oe.ThousandSeparator.toString(),F=y.Oe.Lcid,D=y.Oe.Country,J=y.Oe.DigitsNumber,R=y.Oe.ExpSeparatedBySpace,Z=y.Oe.FractionSeparator.toString(),W=y.Oe.PercentSeparatedBySpace,ka=v.a.GUg(Enum.toString(l,y.Oe.CurrencyFormat)),ma=y.Oe.CurrencySymbolLead,pa=y.Oe.CurrencySeparatedBySpace,xa=y.Oe.CurrencySymbolString,va=y.Oe.DigitsCurrency,ta=-1===y.Oe.DateOrder?"MDY":t.c(Enum.toString(m,
y.Oe.DateOrder)),fa=y.Oe.DateSeparator.toString(),Ca=y.Oe.DateAlternativeSeparator.toString(),Sa=y.Oe.Year4Digits,Gb=y.Oe.Month2Digits,kb=y.Oe.Day2Digits,lb=y.Oe.LongDateFormat,Nb=y.Oe.TimeSeparator.toString(),Aa=y.Oe.TimeAltSeparator,qa=y.Oe.Hour2Digits,Xa=y.Oe.Use24HourClock,Ha=y.Oe.AmPmSeparatedBySpace,Ra=[y.Oe.AmString,y.Oe.PmString],mb=y.Oe.DayNameShortArray,La=y.Oe.DayNameLongArray,ha=y.Oe.MonthNameShortArray,Ia=y.Oe.MonthNameLongArray,gb=y.Oe.PictureSpecialArray,Sb=f.a.map(("\x00"+y.Oe.PictureSingleString).split(""),
function(Qb){return"\x00"===Qb?null:Qb}),wc=y.Oe.PictureColorArray,tc=y.Oe.PictureDbnumArray,Tb=y.Oe.RowLetter.toString(),pb=y.Oe.ColumnLetter.toString(),cb=y.Oe.LeftBrace.toString(),ob=y.Oe.RightBrace.toString(),rc=y.Oe.LeftBracket.toString(),Db=y.Oe.RightBracket.toString(),Ja=a.QXh(y.Oe);return excelOnlineCalc.calc.localeData(E,B,z,M,Tb,pb,cb,ob,rc,Db,Q,P,L,ca,U,aa,F,D,J,R,Z,W,ka,ma,pa,xa,va,ta,fa,Ca,Sa,Gb,kb,lb,Nb,Aa,qa,Xa,Ha,Ra,mb,La,ha,Ia,gb,Sb,wc,tc,Ja,y.Oe.SysDateFormatString,y.Oe.SysTimeFormatString)};
a.CDe=function(y){var E=[];if(!y)return E;y=El(y);for(var B=y.next();!B.done;B=y.next()){B=B.value;var z=null;B.IsDynamicUdf||(z=excelOnlineCalc.calc.worksheetFunctionName(B.FunctionIndexInServer,B.NameUI));z&&E.push(z)}return E};a.E4b=function(){for(var y=[],E=Object.keys(r.a.errorNames),B=0;B<E.length;B++){var z=excelOnlineCalc.calc.errorTypeName(B+1,E[B]);z&&y.push(z)}return y};a.QXh=function(y){var E=Array(6);E[1]="#"+y.AllStructRefString;E[3]="#"+y.HeadersStructRefString;E[2]="#"+y.DataStructRefString;
E[4]="#"+y.TotalsStructRefString;E[5]="#"+y.ThisRowStructRefString;return E};Ek.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.nmg}}});a.unknownError="##ERR##";Object(x.a)(a,"CalcHelper",null,[])},1184:function(x,C,b){function a(){}b.d(C,"a",function(){return a});x=b(0);a.Sri="literal";a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.Ujf="letName";a.all="*";a.jUd="structRefRange";Object(x.a)(a,"TraverseFormulaInterestTypes",
null,[])},1185:function(x,C,b){function a(){}b.d(C,"a",function(){return a});x=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(x.a)(a,"TraverseFormulaRefTypes",null,[])},1457:function(x,C,b){function a(I){var ba=$a.call(this)||this;ba.$=I;ba.Tb();return ba}function c(I){var ba=Uc.call(this)||this;ba.$=I;ba.Tb();return ba}function e(I,ba){var sa=this;this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");
this.C5a=this.s7f=!1;this.RDb=function(){sa.C5a=!1};this.Tc=I;this.gridView=Gb.g(I);this.calcManager=ba;this.cji=ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.Uaf=ta.EwaSettings.ma(696);this.gridView.rc.mo(this.RDb)}function f(I,ba,sa,Oa){this.QHj=I;this.z8f=ba;this.Ihc=void 0===Oa?!1:Oa;sa?(this.S6a=sa.IsRangeRef,this.qwa=sa.IsAbsoluteFirstRow,this.pwa=sa.IsAbsoluteFirstColumn,this.MLa=sa.IsAbsoluteSecondRow,this.LLa=sa.IsAbsoluteSecondColumn):L.ULS.shipAssertTag(524039642,
0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function l(I){var ba=ic.call(this)||this;ba.$=I;ba.Tb();return ba}function m(I){var ba=this;this.Gl=null;this.Kfg=!1;this.rLd=this.instantaneousSupportInformationManager=this.PFb=null;this.osf={};this.qsf={};this.Myd=new Map;this.cce=null;this.Hnc=function(sa){L.ULS.sendTraceTag(537170005,0,50,"CalcManager.OnLocaleInformationAvailable() called");sa.sJd(ba.Hnc);sa.gja.length?ba.nnc(sa,Sys.EventArgs.Empty):(L.ULS.sendTraceTag(537170004,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),
sa.hne(ba.nnc))};this.nnc=function(sa){L.ULS.sendTraceTag(537170003,0,50,"CalcManager.OnFunctionsInfoReady called");sa.jJd(ba.nnc);ba.FMj(sa)};this.onContentReady=function(){ba.Gl&&(ba.instantaneousSupportInformationManager&&ba.instantaneousSupportInformationManager.umd||Qb.Task.delay(0).CWCT(function(){ba.Gl.afb(1)},null,0,yc.a.current))};this.Xtf=function(sa,Oa){ba.Gl&&(ba.instantaneousSupportInformationManager&&ba.instantaneousSupportInformationManager.umd||ba.Gl.XEe(Oa.nd.block))};L.ULS.sendTraceTag(537170067,
0,50,"Creating CalcManager");this.pbf=!1;this.wb=I;this.fr=Gb.g(I);this.eGc=null;this.gridView.Nt(this.onContentReady);this.gridView.Ea.eVc(this.Xtf);this.$.da.$a(268,function(sa){sa.Oe?(L.ULS.sendTraceTag(537170066,0,50,"CalcManager.ctor: LocaleInformation already available..."),ba.Hnc(sa,Sys.EventArgs.Empty)):(L.ULS.sendTraceTag(537170065,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),sa.Cne(ba.Hnc))})}function r(){}function h(){}function w(){this.LLa=this.MLa=this.pwa=this.qwa=this.S6a=
!1}function n(I){var ba=this;this.eHd=null;this.Otd=this.dHd=this.SEb=!1;this.dFd=0;this.UEd=this.WEd=this.XEd=this.VEd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Xm=this.errorTypeNames=null;this.jq=this.currentStateId=-1;this.tta="";this.V$=null;this.Nzf=function(){ba.setNumberFormats()};this.zd=function(){L.ULS.sendTraceTag(537170081,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");ba.$e=new lb.a;ba.jq=-1;ba.currentStateId=-1;ba.tta="";ba.Lrb=
null;ba.dHd=!1;ba.Xm&&ba.clearCache()};this.P4f=(this.Tc=I)?I.ya.CalcWebWorkerSmokeTestPingIntervalMS:this.P4f;this.$e=new lb.a;this.Lrb=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Tc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.woa();this.Uhi=ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.GetSheetInternalIndex",!1)}function v(I){this.E3d=null;this.init(I)}function u(){}function t(I){this.z7=I;this.g6=new Ra.a(mb.a.Pk());this.Rlc=!1}function y(I){this.geg=
I;this.Fge=[];this.Fbg=[];this.p_a={};this.tQd=new Map}function E(I,ba,sa,Oa,qb){this.type=I;this.fullName=ba;this.range=sa;this.sheetId=Oa;this.attributes=qb;this.AE=null}function B(I,ba){this.mve=I;this.sheetName=ba;this.Cvc=!1}function z(I){var ba=Aa.call(this)||this;ba.$=I;ba.Tb();return ba}function M(I,ba){var sa=Nb.call(this)||this;sa.tNa=D.a.Se;sa.AZc=null;sa.ljc=!1;sa.Lfb=!1;sa.btf=function(Oa,qb){var Qa;(Oa=Gb.g(sa.$))&&(qb=null!==(Qa=null===qb||void 0===qb?void 0:qb.cell)&&void 0!==Qa?Qa:
Oa.kc(null))&&sa.Oeb(qb.cell.Ak,!0)};sa.nKi=function(Oa){sa.isActive()&&(va.a.lr(Oa.Errors)||!Oa.Result?L.ULS.sendTraceTag(537155726,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",Oa.Errors?Oa.Errors.join(","):"None"):(Oa=Oa.Result,L.ULS.sendTraceTag(537155725,0,50,"Updating number format category cache, format index = {0}, category = {1}",Oa.Index,Oa.Category),sa.Lqj(Oa.Index,Oa.Category),sa.raiseEvent(M.A_c,new R.a(Oa.Index,Oa.Category),sa)))};sa.refresh=function(){L.ULS.sendTraceTag(537155722,
0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");sa.N1b();if(sa.isActive()&&sa.ea.xc.allowEdits){if(sa.Lfb||sa.wn&&!(sa.ea.uBb>sa.tNa))sa.fDc();else{L.ULS.sendTraceTag(537155721,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");var Oa=sa.$.na.ua;var qb=sa.wn?sa.wn.Digest:"",Qa=sa.WKi,ib=sa.VKi,Mb=Oa.Na(1,null);Mb.previousResponseDigest=qb;Oa=W.i(Oa,"GetInstantaneousSupportInformation",Mb,Qa,ib,null,null,132);sa.efd=Oa}L.ULS.sendTraceTag(537155720,
0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");sa.nZe()}};sa.nxf=function(Oa){L.ULS.sendTraceTag(537155716,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",Oa.data.status,Oa.data.httpStatus);sa.jKa=null};sa.Z_=function(){sa.Lfb=!1;sa.ea.VF(sa.Z_);sa.aRa(sa.ljc?M.FQd:M.iyd)};sa.od=function(Oa,qb){L.ULS.sendTraceTag(537155715,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");Z.a(qb)&&
sa.aRa(M.FQd)};sa.Hf=function(){L.ULS.sendTraceTag(537155714,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==sa.$.workbookContext.CalcMode&&sa.vyd(0===sa.$.workbookContext.CalcMode)};sa.zd=function(){L.ULS.sendTraceTag(537155713,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");sa.aRa(M.FQd);ta.EwaSettings.ma(302)&&3!==sa.$.workbookContext.CalcMode&&sa.vyd(0===sa.$.workbookContext.CalcMode)};sa.OKi=function(Oa,qb,Qa){L.ULS.sendTraceTag(537155712,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");sa.jKa=null;sa.isActive()?Oa.StateId===D.a.Se?(L.ULS.sendTraceTag(537155682,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),sa.fDc()):!Oa.Result||sa.hY&&sa.hY.length?sa.aRa(M.iyd):sa.XAf(Oa,qb,Qa):L.ULS.sendTraceTag(537155683,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};sa.XAf=function(Oa){sa.hY=Oa.Result;
L.ULS.sendTraceTag(537155681,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",sa.hY?sa.hY.length:-1);Oa=!1;if(sa.hY){for(var qb=El(sa.hY),Qa=qb.next();!Qa.done;Qa=qb.next())if(Qa=Qa.value)sa.iVe[Qa.NameUI.toLocaleUpperCase()]=Qa.FunctionIndex.toString(),Qa.NameUI!==Qa.NameDataStrings&&(sa.iVe[Qa.NameDataStrings.toLocaleUpperCase()]=Qa.FunctionIndex.toString(),Oa=!0),sa.MEh.ia(Qa.FunctionIndex,Qa.NameUI);sa.raiseEvent(M.icd,
Sys.EventArgs.Empty,sa)}Oa&&L.ULS.sendTraceTag(537155680,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};sa.WKi=function(Oa){if(sa.isActive())if(L.ULS.shipAssertTag(537155679,0,!!sa.$,"null ewaControl"),sa.ljc=!1,sa.tNa=Oa.StateId,sa.tNa===D.a.Se)sa.ljc=!0,sa.fDc();else{if(Oa.Result){var qb=sa.wn;sa.wn=Oa.Result;L.ULS.sendTraceTag(537155678,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",sa.wn.Digest);Oa=[];
if(qb)Oa=M.hSh(qb.NumberFormats,sa.wn.NumberFormats);else for(qb=0;qb<sa.wn.NumberFormats.length;qb++)sa.qmc.ia(qb,sa.wn.NumberFormats[qb].NumberFormatCategory);qb=El(Oa);for(var Qa=qb.next();!Qa.done;Qa=qb.next())Qa=Qa.value,sa.qmc.ia(Qa,sa.wn.NumberFormats[Qa].NumberFormatCategory);sa.raiseEvent(M.Ryd,new P(Oa),sa);ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&sa.raiseEvent(M.Tkf)}sa.aRa(M.iyd)}};sa.VKi=function(Oa){sa.isActive()&&(10===Oa.data.status?
L.ULS.sendTraceTag(537155677,0,50,"Instantaneous support information request cancelled."):(L.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",Oa.data.status,Oa.data.httpStatus),sa.ljc=!0,sa.fDc()))};L.ULS.sendTraceTag(537155737,0,50,"InstantaneousSupportInformationManager ctor start");sa.ea=I;sa.$=ba;sa.tHb=null;sa.efd=null;sa.jKa=null;sa.wn=null;sa.qmc=new lb.a;sa.Wub=new lb.a;sa.hY=[];sa.MEh=new lb.a;sa.iVe={};sa.ea.hk(sa.od);
sa.$.nl(sa.zd);Gb.g(sa.$).ha.Mra(sa.btf);ta.EwaSettings.ma(302)&&sa.ea.Ot(sa.Hf);sa.aRa(M.l9e);L.ULS.sendTraceTag(537155736,0,50,"InstantaneousSupportInformationManager ctor end");return sa}function Q(I){this.data=I}function P(I){var ba=ka.call(this)||this;ba.XZj=I;return ba}b.r(C);x=b(11);C=b(0);var L=b(14),ca=b(228),U=b(90),aa=b(4),F=b(202),D=b(9),J=b(38),R=b(1082),Z=b(231),W=b(84),ka=Sys.EventArgs;Am(P,ka);Object(C.a)(P,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var ma=b(47),pa=b(44),xa=
b(35),va=b(30),ta=b(1),fa=b(711),Ca=b(21),Sa=b(291),Gb=b(22),kb=b(205);Object(C.a)(Q,"NumberFormatDataHolder",null,[]);var lb=b(170),Nb=J.a;Am(M,Nb);M.prototype.Cne=function(I){this.addHandler(M.Ryd,I)};M.prototype.sJd=function(I){this.removeHandler(M.Ryd,I)};M.prototype.LDg=function(I){this.addHandler(M.A_c,I)};M.prototype.Q$i=function(I){this.removeHandler(M.A_c,I)};M.prototype.hne=function(I){this.addHandler(M.icd,I)};M.prototype.jJd=function(I){this.removeHandler(M.icd,I)};M.prototype.mFg=function(I){this.addHandler(M.Tkf,
I)};M.prototype.Oeb=function(I,ba){var sa=this.qmc.Nc(I,0);var Oa=sa.value;sa=sa.returnValue;!sa&&0<I&&this.$&&(L.ULS.sendTraceTag(537155735,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",I),this.cKh(I),ba&&(Oa=this.bKh(I),sa=!0),fa.a(I,this.$.sG)&&(Oa=6));return{returnValue:sa,category:Oa}};M.prototype.Fhi=function(I){var ba=this.Oeb(I,!0);var sa=ba.category;if(ba.returnValue)return 6===sa;L.ULS.sendTraceTag(537155733,
0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",I);return!1};M.prototype.lDh=function(I){L.ULS.sendTraceTag(537155730,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.jKa=W.x(this.$.na.ua,{FilterType:0},Sa.b(this.XAf,I),this.nxf,null,null,null)};M.prototype.BUe=function(){this.aRa(M.l9e)};M.prototype.vyd=function(I){this.AZc=I};M.prototype.cKh=function(I){if(this.Wub&&
this.$){var ba=this.Wub.Nc(I);var sa=ba.value;if(!ba.returnValue||sa.isCompleted){L.ULS.sendTraceTag(537155728,0,50,"Getting number format category for format index: {0}",I);sa=this.$.na.ua;ba=this.nKi;var Oa=sa.Na(1,null);Oa.ifmt=I;(sa=W.i(sa,"GetNumberFormatCategory",Oa,ba,null,null,null,4))&&this.Wub.ia(I,sa)}}else L.ULS.sendTraceTag(537155729,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};M.prototype.bKh=function(I){return 1<=I&&
8>=I?1:9<=I&&12>=I?2:13===I||14===I?6:15===I?8:17===I|18===I?7:19===I?4:16===I||20<=I&&29>=I||31===I?11:30===I?9:32<=I&&35>=I?3:0};M.prototype.isActive=function(){var I=void 0===this.ea||null===this.ea,ba=!I&&this.ea.sc;L.ULS.sendTraceTag(537155727,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",ba,I);return ba};M.prototype.Lqj=function(I,ba){this.qmc.ia(I,ba)};M.prototype.dispose=function(){U.a.Ha(this.tHb);
this.tHb=null;this.N1b();for(var I=El(this.Wub),ba=I.next();!ba.done;ba=I.next())(ba=ba.value.value)&&!ba.isCompleted&&aa.AFrameworkApplication.Jd.Du(ba.Qt);this.Wub=null;this.ea&&(this.ea.Dk(this.od),this.Lfb&&this.ea.VF(this.Z_),this.Lfb=!1,this.ea.Ev(this.Hf));this.ea=null;this.$&&Gb.g(this.$)&&Gb.g(this.$).ha&&(Gb.g(this.$).ha.Jza(this.btf),this.$.Sl(this.zd));this.$=null;Nb.prototype.dispose.call(this)};M.prototype.isFeatureEnabled=function(I){try{switch(I){case "LocaleLongDateFormat":return ta.EwaSettings.ma(197);
case "GetLocaleDayNames":return ta.EwaSettings.ma(198);case "CalculateTextWidthIgnoreLetterSpacing":return ta.EwaSettings.ma(284);case "OfficeVSO:3657744_CalcFixForDateFormat":return ta.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return ta.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");case "CalcAutocompleteExperiment":return ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",
!1);case "CalcNewFunctions":return ta.EwaSettings.ma(247);case "CalcContractChecks":return ta.EwaSettings.ma(248);case "CalcSupportDynamicArrays":return ta.EwaSettings.ma(249);case "CalcFormatCalculations":return ta.EwaSettings.ma(250);case "CalcFormulaCacheAPIChanges":return ta.EwaSettings.ma(251);case "CalcStrictFormulaChecking":return ta.EwaSettings.ma(252);case "CalcSupportRowReference":return ta.EwaSettings.ma(263);case "CalcParserUsesPledges":return ta.EwaSettings.ma(307);case "CalcWebWorker":return!0;
case "CalcWebWorkerTest":return ta.EwaSettings.ma(306);case "CalcLookupFunctions":return ta.EwaSettings.ma(308);case "CalcLogStopWatch":return ta.EwaSettings.ma(372);case "CalcPreventSpillingHack":return ta.EwaSettings.ma(253);case "CalcDynamicArrayOperators":return ta.EwaSettings.ma(103);case "CalcDotOperator":return ta.EwaSettings.ma(590);case "CalcLetFunction":return ta.EwaSettings.ma(707);default:return I.startsWith("OfficeVSO:")?ta.EwaSettings.isChangeGateEnabled(I):!1}}catch(ba){return L.ULS.sendTraceTag(537155724,
0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",I,ba.toString()),!1}};M.prototype.aRa=function(I){this.isActive()&&this.ea.xc.allowEdits?(U.a.Ha(this.tHb),this.tHb=null,this.tHb=ma.a.instance.create(this.refresh,I,pa.a.aci)):L.ULS.sendTraceTag(537155723,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",void 0!==this.ea&&null!==this.ea&&void 0!==
this.ea.xc&&null!==this.ea.xc?this.ea.xc.allowEdits:!1,void 0===this.ea||null===this.ea?!1:this.$.ea.isEditMode)};M.prototype.nZe=function(){L.ULS.sendTraceTag(537155719,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.jKa?L.ULS.sendTraceTag(537155718,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.hY&&this.hY.length||(this.jKa=W.x(this.$.na.ua,{FilterType:0},this.OKi,this.nxf,null,null,null)):L.ULS.sendTraceTag(537155717,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};M.prototype.fDc=function(){this.Lfb||(this.Lfb=!0,this.ea.QG(this.Z_))};M.prototype.N1b=function(){this.Du(this.efd);this.Du(this.jKa);this.jKa=this.efd=null};M.prototype.Du=function(I){I&&!I.isCompleted&&this.$.na.ua.Neb(I.Qt)};M.hSh=function(I,ba){if(!I||!I.length)return[];if(!ba||!ba.length){ba=Array(I.length);for(var sa=0;sa<I.length;++sa)ba[sa]=I[sa].IfmtIndex;return ba}var Oa=new lb.a;
I=El(I);for(sa=I.next();!sa.done;sa=I.next())sa=sa.value,Oa.ia(sa.IfmtIndex,new Q(sa));I=new F.a;sa={};ba=El(ba);for(var qb=ba.next();!qb.done;sa={hgb:sa.hgb,RPb:sa.RPb},qb=ba.next())sa.hgb=qb.value,sa.RPb=void 0,function(Qa){return function(){var ib=Oa.Nc(Qa.hgb.IfmtIndex);Qa.RPb=ib.value;return ib}}(sa)().returnValue&&sa.RPb.data.FormatString===sa.hgb.FormatString||I.add(sa.hgb.IfmtIndex);return I.toArray()};Ek.Object.defineProperties(M.prototype,{Oe:{configurable:!0,enumerable:!0,get:function(){return this.wn?
this.wn.LocaleInformation:null}},pca:{configurable:!0,enumerable:!0,get:function(){return this.wn?this.wn.NumberFormats:[]}},gja:{configurable:!0,enumerable:!0,get:function(){this.hY&&this.hY.length||this.nZe();return this.hY}},Xbi:{configurable:!0,enumerable:!0,get:function(){return this.wn&&void 0!==this.wn.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.wn.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.wn.InstantaneousCalcWebWorkerPrecisionSamplingRate:M.Ybh}},$bi:{configurable:!0,
enumerable:!0,get:function(){return this.wn&&void 0!==this.wn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.wn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.wn.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:M.bch}},Zbi:{configurable:!0,enumerable:!0,get:function(){return this.wn&&void 0!==this.wn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.wn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.wn.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
M.ach}},Ybi:{configurable:!0,enumerable:!0,get:function(){return this.wn&&void 0!==this.wn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.wn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.wn.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:M.$bh}},aaf:{configurable:!0,enumerable:!0,get:function(){return this.wn?this.wn.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:M.Zbh}},umd:{configurable:!0,enumerable:!0,get:function(){return null!==this.AZc?this.AZc:
this.wn?this.wn.InstantaneousCalcManualMode:!1}}});M.Ryd="isim0";M.A_c="isim1";M.icd="isim2";M.Tkf="isim3";M.l9e=100;M.FQd=1E3;M.iyd=3E5;M.Ybh=.001;M.bch=.1;M.ach=.2;M.$bh=.001;M.Zbh=50;Object(C.a)(M,"InstantaneousSupportInformationManager",J.a,[542,3]);var Aa=ca.a;Am(z,Aa);z.prototype.create=function(){this.$&&(L.ULS.sendTraceTag(537155672,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),this.Eb(this.$.da.Aa(268)||new M(this.$.ea,this.$)))};z.ka=function(I){if(!I)throw Error.argumentNull("ewaControl");
I.da.Ga(246,new z(I))};Object(C.a)(z,"InstantaneousSupportInformationManagerFactory",ca.a,[]);var qa=b(82),Xa=b(112),Ha=b(83);Object(C.a)(B,"CalcBlockInformation",null,[]);Object(C.a)(E,"CalcNamedObject",null,[]);y.prototype.y_f=function(I,ba){this.Fge[I]=ba;this.geg&&ba.z7&&this.tQd.set(ba.z7.sheetName,I)};y.prototype.getSheetIndex=function(I){if(this.geg){if(this.tQd.has(I))return this.tQd.get(I)}else for(var ba=1;ba<this.Ij.length;ba++)if(Ca.a.equals(this.Ij[ba].z7.sheetName,I,!1))return ba;return-1};
Ek.Object.defineProperties(y.prototype,{Ij:{configurable:!0,enumerable:!0,get:function(){return this.Fge}}});Object(C.a)(y,"GridCache",null,[]);var Ra=b(895),mb=b(616);Object(C.a)(t,"SheetInformation",null,[]);var La=b(1142),ha;(function(I){I[I.initialization=0]="initialization";I[I.contentReady=1]="contentReady";I[I.cellEdit=2]="cellEdit"})(ha||(ha={}));Object(C.b)("UpdateDataTrigger",ha);var Ia=b(63);u.local="Local";u.fIj="Thread";Object(C.a)(u,"RecalcServiceCreateMode",null,[]);var gb=b(46),Sb=
b(37),wc=b(167);v.prototype.init=function(I){this.E3d=new lb.a;if(void 0!==I&&null!==I&&void 0!==I.HeadersList&&null!==I.HeadersList&&0<I.HeadersList.length){I=El(I.HeadersList);for(var ba=I.next();!ba.done;ba=I.next())ba=ba.value,this.D$.ia(ba.Index,ba.Name)}};Ek.Object.defineProperties(v.prototype,{D$:{configurable:!0,enumerable:!0,get:function(){return this.E3d}}});Object(C.a)(v,"ColHeadersListData",null,[]);var tc=b(99);b(204);var Tb=b(256);n.prototype.dispose=function(){this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.sJd(this.Nzf);this.Tc&&this.Tc.Sl(this.zd);this.close()};n.prototype.afb=function(I){if(!this.Xm)return!1;if(!this.instantaneousSupportInformationManager&&(this.instantaneousSupportInformationManager=this.Tc.da.Aa(268),!this.instantaneousSupportInformationManager))return L.ULS.sendTraceTag(537170198,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==I&&(this.currentStateId=this.Tc.ea.uBb,this.currentStateId===
D.a.Se&&(this.currentStateId=this.Tc.ea.rf));if(1===I&&this.currentStateId<this.jq)return L.ULS.sendTraceTag(537170197,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",this.currentStateId,this.jq),!1;this.Loj();0!==I&&this.dHd||(this.atj(),this.eqj(),this.Rqj(),this.setNumberFormats(),this.instantaneousSupportInformationManager.Cne(this.Nzf),this.Tc.nl(this.zd),this.dHd=!0);this.I5i();var ba=!1;0===I&&(ba=this.O$h());if(0!==I||ba)this.ksj()?(this.Psj(I),
this.Osj(),this.jq=this.currentStateId,this.sXg()):L.ULS.sendTraceTag(537170196,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",this.currentStateId);2!==I&&this.resumeRecalc();return!0};n.prototype.evalFormula=function(I){if(!this.Xm)return L.ULS.sendTraceTag(537170195,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});I=this.Xm.evalFormula(this.Tc.ea.rf,I,Ia.d(this.Tc.xa.qa));this.resumeRecalc();return I};n.prototype.evalFormulaRange=
function(I,ba,sa){if(!this.Xm)return L.ULS.sendTraceTag(537170194,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);L.ULS.shipAssertTag(537170193,0,ba.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");sa=gb.j(sa);ba=gb.o(ba,this.Tc);ba=excelOnlineCalc.calc.cellLocation(ba.FirstRow,ba.FirstColumn);sa=n.OU("EvalFormulaRange",Ia.d(this.Tc.xa.qa),sa.FirstRow,sa.FirstColumn,sa.LastRow,sa.LastColumn);L.ULS.sendTraceTag(537170190,0,50,
"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.jq);I=this.Xm.evalFormulaRange(this.jq,I,ba,sa,null);I.then(function(Oa){if(excelOnlineCalc.util.isSuccess(Oa)){var qb=[];Oa=El(Oa.value);for(var Qa=Oa.next();!Qa.done;Qa=Oa.next())Qa=Qa.value,excelOnlineCalc.util.isSuccess(Qa.value)||(Qa=Qa.value.reason.kind.toString(),Array.contains(qb,Qa)||qb.push(Qa));L.ULS.sendTraceTag(537170191,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",
qb.length?Sys.Serialization.JavaScriptSerializer.serialize(qb):"None")}else L.ULS.sendTraceTag(537170192,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",Oa.reason.kind)}).catch(function(Oa){L.ULS.sendTraceTag(537170189,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Oa));return Promise.reject(Oa)});this.resumeRecalc();return I};n.prototype.cTg=function(I,ba,sa,Oa){Oa=void 0===
Oa?null:Oa;if(this.Xm&&I){var qb=Ia.d(this.Tc.xa.qa),Qa=I.cell.mK-1,ib=I.cell.lK-1,Mb=Qa,Jb=ib,Zb=null;Oa&&(Zb=excelOnlineCalc.calc.cellLocation(Qa,ib),Qa=Oa.top-1,ib=Oa.left-1,Mb=Oa.bottom-1,Jb=Oa.right-1);if(I.cell.du)if(Oa=I.cell.du.yYc,Oa===D.a.Se)L.ULS.sendTraceTag(537170187,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",I.cell.du.ae);else if(Oa<this.jq)L.ULS.sendTraceTag(537170185,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",
Qa,ib,Oa,this.jq);else if(Oa<this.currentStateId)L.ULS.sendTraceTag(537170184,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",Qa,ib,Oa,this.currentStateId);else if(this.SEb||(this.Xm.setOnRecalcResults(sa),this.SEb=!0),this.sbg()&&!this.afb(2))L.ULS.sendTraceTag(537170183,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{Jb=n.OU("CalculateFormula.cell",qb,Qa,ib,Mb,Jb);sa=[];var ub=Gb.g(this.Tc);Mb=ub.Gh;Gb.g(this.Tc).rb.dj&&
(Mb=ub.Tf(1).Gh,Mb.tna(1,1),Mb.tna(3,1));ub=null;Mb?ub=n.OU("CalculateFormula.viewport",qb,Mb.top-1,Mb.left-1,Mb.bottom-1,Mb.right-1):L.ULS.sendTraceTag(537170182,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(Jb,ba,Zb,ub);sa.push(ba);I=Mb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",qb,Qa,ib,Ca.a.x_b(I.cell.text),
Oa,Mb.top-1,Mb.left-1,Mb.bottom-1,Mb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",qb,Qa,ib,Ca.a.x_b(I.cell.text),Oa,"","","","");L.ULS.sendTraceTag(537170181,0,50,I);this.Xm.editRangeFormulas(Oa,sa);this.resumeRecalc()}else L.ULS.sendTraceTag(537170186,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",I.cell.mK,I.cell.lK)}else L.ULS.sendTraceTag(537170188,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",
!this.Xm,!I)};n.prototype.aTg=function(I,ba,sa,Oa){Oa=void 0===Oa?null:Oa;var qb=Ia.d(this.Tc.xa.qa),Qa=I.cell.mK-1,ib=I.cell.lK-1,Mb=Qa,Jb=ib,Zb=null;Oa&&(Zb=excelOnlineCalc.calc.cellLocation(Qa,ib),Qa=Oa.top-1,ib=Oa.left-1,Mb=Oa.bottom-1,Jb=Oa.right-1);sa=this.GZd(I,sa,"SetCell");0>sa||(Jb=n.OU("CalculateFormula.cell",qb,Qa,ib,Mb,Jb),Mb=[],Oa=this.zhd(qb),ba=excelOnlineCalc.calc.inferredRangeFormulaEdit(Jb,ba,Zb,Oa),Mb.push(ba),I=(ba=this.D3e())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
qb,Qa,ib,Ca.a.x_b(I.cell.text),sa,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",qb,Qa,ib,Ca.a.x_b(I.cell.text),sa,"","","",""),L.ULS.sendTraceTag(537170180,0,50,I),this.Xm.editRangeFormulas(sa,Mb),this.resumeRecalc())};n.prototype.ltb=function(I,ba,sa,Oa){if(!this.Xm)return L.ULS.sendTraceTag(537170179,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),
Promise.reject("RecalcService is null");if(!sa||!ba)return L.ULS.sendTraceTag(524120779,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone inputs are null. originCell null: "+!sa+", outputColumnRange null: "+!ba),Promise.reject("CalcAsyncEngine::EvalFormulaRangeOnClone: null inputs");L.ULS.shipAssertTag(537170178,0,sa.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var qb=Ia.d(this.Tc.xa.qa),Qa=this.zhd(qb),ib=null;if(I){ib=[];I=El(I);for(var Mb=I.next();!Mb.done;Mb=
I.next())if(Mb=Mb.value,Mb.column!==sa.left){var Jb=Mb.row-1;var Zb=Mb.column-1;Jb=n.OU("EvalFormulaRangeOnClone.cell",qb,Jb,Zb,Jb,Zb);Zb=Mb.text;ib.push(excelOnlineCalc.calc.rangeWrite(Jb,excelOnlineCalc.calc.valueCellData(Zb,Zb,Mb.Ak,null)))}}sa=excelOnlineCalc.calc.cellLocation(sa.top-1,sa.left-1);ba=n.OU("EvalFormulaRangeOnClone.outputColumnRange",qb,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1);Oa=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(ba,Oa,sa,Qa)];ib=this.Xm.evalOnClonedModel(ib,Oa);
this.resumeRecalc();return ib};n.prototype.XEe=function(I){var ba=null;try{if(I)if(this.tta=Gb.g(this.Tc).Ea.Yua(I),this.currentStateId=I.RSa,this.currentStateId<this.jq||this.currentStateId===D.a.Se)L.ULS.sendTraceTag(537170176,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.tta,this.currentStateId,this.jq);else{if(this.T$h(),!this.dOg()){var sa=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",
this.tta,this.currentStateId);ba=this.Tc.Ob.Gc("ModelUpdate",sa);this.Lrb=this.mwb(I.qa.sheetName);if(!this.Lrb){var Oa=!!(this.Tc.Pd&32);L.ULS.sendTraceTag(537170147,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Ij?this.$e.oa(this.currentStateId).Ij.length:0,Oa,I.qa.sheetName?I.qa.sheetName.length:-1,I.qa.hash)}else if(Gb.g(this.Tc).Ea.sm.C1a(I.ae)){var qb=
I.Ef;if(qb){var Qa=qb.getCalcBlockModel();if(!Qa)L.ULS.sendTraceTag(537170145,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.WNg(Qa)){this.$e.oa(this.currentStateId).p_a[this.tta]=new B(Qa,I.qa.sheetName);var ib=I.Be;ib?this.vBg(ib.NamedObjects):L.ULS.sendTraceTag(537170144,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else L.ULS.sendTraceTag(537170146,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.tta)}}}else L.ULS.shipAssertTag(537170177,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{ba&&ba.stop()}};n.prototype.v4a=function(I){if(!this.$e.oa(this.currentStateId).Ij||!this.$e.oa(this.currentStateId).Ij[0])return null;var ba=this.$e.oa(this.currentStateId).Ij[0].g6;if(!ba||!ba.xb(I.name))return null;ba=ba.oa(I.name);if(!ba||!ba.AE)return null;I=new F.a;ba=El(ba.AE.D$);for(var sa=ba.next();!sa.done;sa=ba.next())I.add(sa.value.value);return I};
n.prototype.getNameLoc=function(I,ba){return this.ihc()?this.$e.oa(this.currentStateId).Ij[0].g6.xb(ba)?(I=excelOnlineCalc.location.nameLoc(I,ba),excelOnlineCalc.util.success(I)):excelOnlineCalc.util.success(null):(I=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(I))};n.prototype.getContainingTable=function(I){if(!this.ihc())return I=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(I);var ba=I.range.col,sa=I.range.row,Oa=this.$e.oa(this.currentStateId).Ij[0].g6,
qb=null;Oa=El(Oa);for(var Qa=Oa.next();!Qa.done;Qa=Oa.next())if(Qa=Qa.value.value,2===Qa.type&&Ca.a.equals(I.sheet.index.toString(),Qa.sheetId,!0)){var ib=Qa.range;ba>=ib.left-1&&ba<=ib.right-1&&sa<=ib.bottom-1&&sa>=ib.top-1&&(qb=excelOnlineCalc.location.nameScope(this.documentLoc,Qa.sheetId),qb=excelOnlineCalc.location.nameLoc(qb,Qa.fullName))}return qb?excelOnlineCalc.util.success(qb):excelOnlineCalc.util.success(null)};n.prototype.getStructRefColumn=function(I,ba){if(!this.ihc()){var sa=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(sa)}sa=I.name;var Oa=this.$e.oa(this.currentStateId).Ij[0].g6;if(Oa.xb(sa)){Oa=Oa.oa(sa);var qb=Oa.range;if(2!==Oa.type)return excelOnlineCalc.util.failure(this.T3c(5));var Qa=Oa.AE?Oa.AE.D$:null;if(!Qa)return excelOnlineCalc.util.success(null);for(var ib=El(Qa),Mb=ib.next();!Mb.done;Mb=ib.next())if(Mb=Mb.value,Ca.a.equals(Mb.value,ba,!0))return I=excelOnlineCalc.location.documentLoc(I.scope.document.path,I.scope.document.name),I=excelOnlineCalc.location.sheetIndex(I,
Oa.sheetId),qb=excelOnlineCalc.location.gridRange(qb.top-1,Mb.key,qb.bottom-qb.top+1,1),qb=excelOnlineCalc.location.sheetGridRange(I,qb),sa=excelOnlineCalc.location.structRefColumnLoc(sa,qb,!!(Oa.attributes&16),!!(Oa.attributes&8)),excelOnlineCalc.util.success(sa);return qb.right-qb.left+1!==Qa.count?(sa=excelOnlineCalc.util.unavailable([17,I,ba]),excelOnlineCalc.util.failure(sa)):excelOnlineCalc.util.failure(this.T3c(0))}return excelOnlineCalc.util.success(null)};n.prototype.getStructRefSpecialRef=
function(I,ba){if(!this.ihc())return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);var sa=this.$e.oa(this.currentStateId).Ij[0].g6;if(sa.xb(I.name)){var Oa=sa.oa(I.name);if(2!==Oa.type)return excelOnlineCalc.util.failure(this.T3c(5));sa=!!(Oa.attributes&16);var qb=!!(Oa.attributes&8),Qa=sa?1:0,ib=qb?1:0;I=excelOnlineCalc.location.documentLoc(I.scope.document.path,I.scope.document.name);I=excelOnlineCalc.location.sheetIndex(I,Oa.sheetId);Oa=Oa.range;var Mb={};if(1===ba)Mb=
excelOnlineCalc.location.gridRange(Oa.top-Qa-1,Oa.left-1,Oa.bottom+ib-Oa.top+Qa+1,Oa.right-Oa.left+1);else if(2===ba)Mb=excelOnlineCalc.location.gridRange(Oa.top-1,Oa.left-1,Oa.bottom-Oa.top+1,Oa.right-Oa.left+1);else if(3===ba)if(sa)Mb=excelOnlineCalc.location.gridRange(Oa.top-2,Oa.left-1,1,Oa.right-Oa.left+1);else return excelOnlineCalc.util.success(null);else if(4===ba)if(qb)Mb=excelOnlineCalc.location.gridRange(Oa.bottom,Oa.left-1,1,Oa.right-Oa.left+1);else return excelOnlineCalc.util.success(null);
ba=excelOnlineCalc.location.sheetGridRange(I,Mb);return excelOnlineCalc.util.success(ba)}return excelOnlineCalc.util.success(null)};n.prototype.getDocumentLoc=function(I,ba){if((Ca.a.equals(I,this.documentLoc.path,!0)||!I)&&Ca.a.equals(ba,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);I=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(I,ba)]);return excelOnlineCalc.util.failure(I)};n.prototype.getSheetIndex=function(I,ba){if(!this.$e.xb(this.currentStateId)||
!this.$e.oa(this.currentStateId).Ij)return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);I=this.$e.oa(this.currentStateId).Ij;for(var sa=1;sa<I.length;sa++)if(Ca.a.equals(I[sa].z7.sheetName,ba,!0))return excelOnlineCalc.util.success(I[sa].z7.sheetId);return excelOnlineCalc.util.success(null)};n.prototype.getSheetName=function(I,ba){if(!this.$e.xb(this.currentStateId)||!this.$e.oa(this.currentStateId).Ij)return ba=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(ba);
I=this.$e.oa(this.currentStateId).Ij;for(var sa=1;sa<I.length;sa++)if(Ca.a.equals(I[sa].z7.sheetId,ba,!0))return excelOnlineCalc.util.success(I[sa].z7.sheetName);return excelOnlineCalc.util.success(null)};n.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};n.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
n.prototype.bTg=function(I,ba,sa){var Oa=Gb.g(this.Tc),qb=Oa.kc(ba);qb=this.GZd(qb,null,"CopyPaste");sa=this.GZd(Oa.kc(I),sa,"CopyPaste");if(0>qb||0>sa||qb!==sa)L.ULS.sendTraceTag(537170143,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",sa,qb);else{sa=[];Oa=Ia.d(this.Tc.xa.qa);var Qa=this.zhd(Oa);I=n.OU("CalculateFormulaForCopyPaste.srcRange",Oa,I.top-1,I.left-1,I.bottom-1,I.right-1);ba=n.OU("CalculateFormulaForCopyPaste.targetRange",
Oa,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1);ba=excelOnlineCalc.calc.copyPasteRangePasteEdit(ba,I,Qa);sa.push(ba);ba=Qa?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Oa,qb,Qa.row,Qa.column,Qa.lastRow,Qa.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Oa,qb,"","","","");L.ULS.sendTraceTag(537170142,0,50,ba);this.Xm.editRangePaste(qb,sa);
this.resumeRecalc()}};n.prototype.zhd=function(I){var ba=this.D3e(),sa=null;ba?sa=n.OU("GetViewport.viewport",I,ba.top-1,ba.left-1,ba.bottom-1,ba.right-1):L.ULS.sendTraceTag(537170141,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return sa};n.prototype.D3e=function(){var I=Gb.g(this.Tc),ba=I.Gh;if(Gb.g(this.Tc).rb.dj){ba=I.Tf(1).Gh;if(ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!ba)return L.ULS.sendTraceTag(537170140,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;ba.tna(1,1);ba.tna(3,1)}return ba};n.prototype.GZd=function(I,ba,sa){if(!this.Xm||!I)return L.ULS.sendTraceTag(537170139,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Xm,!I,sa),-1;var Oa=I.cell.mK-1,qb=I.cell.lK-1;if(I.cell.du){var Qa=I.cell.du.yYc;if(Qa===D.a.Se)return L.ULS.sendTraceTag(537170138,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
I.cell.du.ae,sa),-1}else return L.ULS.sendTraceTag(537170137,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",I.cell.mK,I.cell.lK,sa),-1;if(Qa<this.jq)return L.ULS.sendTraceTag(537170136,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",Oa,qb,Qa,this.jq,sa),-1;if(Qa<this.currentStateId)return L.ULS.sendTraceTag(537170135,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
Oa,qb,Qa,this.currentStateId,sa),-1;ba&&!this.SEb&&(this.Xm.setOnRecalcResults(ba),this.SEb=!0);return this.sbg()&&!this.afb(2)?(L.ULS.sendTraceTag(537170134,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",sa),-1):Qa};n.prototype.getFormulaBarText=function(I,ba,sa){return ba&&ba.startsWith("'")?ba:I.cell.formulaBarText||sa.toString()};n.prototype.M8g=function(I,ba,sa){var Oa=null;if(this.Uve()&&this.$e.oa(this.jq).p_a){var qb=this.$e.oa(this.jq).p_a[I];if(null===
qb||void 0===qb?0:qb.Cvc)Oa=qb.mve}sa=this.Cei(Oa,ba,sa);ba=this.W_g(Oa,ba,sa);L.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",I,this.currentStateId,ba)};n.prototype.Cei=function(I,ba,sa){var Oa=!1,qb=n.ZWe(ba);if(I){var Qa=n.ZWe(I);Ca.a.equals(Qa,qb,!1)&&(Oa=!0)}Oa?this.YBg(I,this.jq,sa):this.$Bg(ba,sa);return Oa};n.prototype.Uve=function(){var I=!1;this.Xm&&-1!==this.jq&&(I=this.Xm.stateIdAvailable(this.jq));
return I&&this.$e.xb(this.jq)&&this.jq<this.currentStateId};n.prototype.W_g=function(I,ba,sa){var Oa=0;var qb,Qa;for(ba.reset();qb=ba.getNextCell();)kb.e(qb.formula)&&Oa++,(Qa=sa?I.getCell(qb.row,qb.col):null)?this.S_g(ba,qb,Qa):this.ZBg(ba,qb);if(sa)for(I.reset();Qa=I.getNextCell();)(qb=ba.getCell(Qa.row,Qa.col))||this.Yle(I,Qa);return Oa};n.prototype.Rqj=function(){this.Xm.setOnUpdateRequest(function(){})};n.prototype.Qqj=function(){var I=this;this.Xm.setOnUnresponsive(function(ba,sa,Oa,qb){I.WSi(ba,
sa,Oa,qb)})};n.prototype.WSi=function(I,ba,sa,Oa){L.ULS.sendTraceTag(537170126,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",I,ba,sa,Oa);Oa&&(this.Rfj(),this.woa())};n.prototype.Rfj=function(){this.zd(null,null);this.Otd=this.SEb=!1;this.dFd=0;this.UEd=this.WEd=this.XEd=this.VEd=-1};n.prototype.close=function(){this.Xm.close()};n.prototype.clearCache=function(){this.Xm.clearCache()};n.prototype.resumeRecalc=function(){this.Xm.resumeRecalc()};
n.prototype.eqj=function(){this.Xm.setA1ReferenceStyle(!0)};n.prototype.I5i=function(){if(this.instantaneousSupportInformationManager){var I=this.instantaneousSupportInformationManager.Xbi,ba=this.instantaneousSupportInformationManager.$bi,sa=this.instantaneousSupportInformationManager.Zbi,Oa=this.instantaneousSupportInformationManager.Ybi,qb=!1;I!==this.VEd&&(qb=!0,this.VEd=I);ba!==this.XEd&&(qb=!0,this.XEd=ba);sa!==this.WEd&&(qb=!0,this.WEd=sa);Oa!==this.UEd&&(qb=!0,this.UEd=Oa);var Qa=[];ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",
!1)&&(qb=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Qa.push(qb),qb=!0);ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(qb=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Qa.push(qb),qb=!0);ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(qb=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",null),Qa.push(qb),qb=!0);qb&&(I=excelOnlineCalc.calc.recalcServiceConfig(null,I,
null,ba,null,null,null,sa,Qa,Oa),this.Xm.reconfigure(I))}};n.prototype.Psj=function(I){var ba=this,sa=null;if(this.$e.xb(this.currentStateId))try{this.V$=[];var Oa=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,ha[I]);sa=this.Tc.Ob.Gc("ModelUpdate",Oa);Xa.a.forEach(this.$e.oa(this.currentStateId).p_a,function(qb,Qa){Qa.Cvc||(ba.M8g(qb,Qa.mve,Qa.sheetName),Qa.Cvc=!0)},null);this.Xm.updateRanges(this.currentStateId,this.V$)}finally{sa&&sa.stop()}else L.ULS.sendTraceTag(537170122,
0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};n.prototype.Osj=function(){var I=[],ba=this.Uve(),sa=ba&&this.$e.oa(this.jq).Ij&&this.$e.oa(this.jq).Ij[0]&&this.$e.oa(this.jq).Ij[0].Rlc?this.$e.oa(this.jq).Ij[0].g6:null;this.GAe(sa,this.$e.oa(this.currentStateId).Ij[0].g6,null,this.jq,I);this.$e.oa(this.currentStateId).Ij[0].Rlc=!0;for(var Oa=1;Oa<this.$e.oa(this.currentStateId).Ij.length;Oa++)sa=-1,ba&&this.$e.oa(this.jq).Ij&&(sa=this.Jgd(this.$e.oa(this.currentStateId).Ij[Oa].z7.sheetName,
this.jq)),sa=-1!==sa&&this.$e.oa(this.jq).Ij[sa].Rlc?this.$e.oa(this.jq).Ij[sa].g6:null,this.GAe(sa,this.$e.oa(this.currentStateId).Ij[Oa].g6,this.$e.oa(this.currentStateId).Ij[Oa].z7.sheetId,this.jq,I),this.$e.oa(this.currentStateId).Ij[Oa].Rlc=!0;this.Xm.updateNamedObjects(this.currentStateId,I)};n.prototype.GAe=function(I,ba,sa,Oa,qb){if(void 0!==sa&&null!==sa){var Qa=excelOnlineCalc.calc.undefinedNamesWrite(sa);qb.push(Qa)}if(I){var ib=!1,Mb=[];Qa=[];if(ba)for(var Jb=El(ba),Zb=Jb.next();!Zb.done;Zb=
Jb.next()){Zb=Zb.value;var ub=Zb.value;if(I.xb(Zb.key)){var Za=I.oa(Zb.key);n.ICi(Za,ub)?ib=!0:(Za=excelOnlineCalc.calc.namedObject(Zb.key,null),Mb.push(Za),n.EUc(Zb.key,ub,Qa))}else n.EUc(Zb.key,ub,Qa)}I=El(I);for(Zb=I.next();!Zb.done;Zb=I.next())Jb=Zb.value,ba&&ba.xb(Jb.key)||(Jb=excelOnlineCalc.calc.namedObject(Jb.key,null),Mb.push(Jb));ib&&(ba=excelOnlineCalc.calc.namedObjectsPromote(sa,Oa),qb.push(ba));0<Mb.length&&(ba=excelOnlineCalc.calc.namedObjectsWrite(sa,Mb),qb.push(ba));0<Qa.length&&(sa=
excelOnlineCalc.calc.namedObjectsWrite(sa,Qa),qb.push(sa))}else if(ba){Qa=[];ba=El(ba);for(Oa=ba.next();!Oa.done;Oa=ba.next())Oa=Oa.value,n.EUc(Oa.key,Oa.value,Qa);0<Qa.length&&(sa=excelOnlineCalc.calc.namedObjectsWrite(sa,Qa),qb.push(sa))}};n.prototype.dOg=function(){return this.$e.oa(this.currentStateId).p_a[this.tta]?(L.ULS.sendTraceTag(537170121,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.tta,this.currentStateId),!0):!1};n.prototype.WNg=function(I){return 1===
I.getColumnNumbers().length&&I.getColumnNumbers()[0]===n.fwd+1?!1:!0};n.prototype.O$h=function(){var I=this,ba=!1;Gb.g(this.Tc).Ea.zbd(function(sa){sa.state&1&&I.Tc.ea.rf===sa.qe.Revision&&(I.XEe(sa),ba=!0)});return ba};n.prototype.WCe=function(I,ba){var sa=I.getRowNumbers(),Oa=I.getColumnNumbers();I=sa[0]-1;sa=sa[sa.length-1]-1;var qb=Oa[0]-1;Oa=Oa[Oa.length-1]-1;(ba=this.mwb(ba))||L.ULS.sendTraceTag(537170120,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",
this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Ij?this.$e.oa(this.currentStateId).Ij.length:0);return n.OU("CreateBlockRangeLocation",ba,I,qb,sa,Oa)};n.prototype.YBg=function(I,ba,sa){if(sa=this.WCe(I,sa)){var Oa=n.F4b(I.getRowNumbers());I=n.F4b(I.getColumnNumbers());ba=excelOnlineCalc.calc.rangePromote(sa,ba,Oa,I);this.V$[this.V$.length]=ba}};n.prototype.$Bg=function(I,ba){if(ba=this.WCe(I,ba)){var sa=n.F4b(I.getRowNumbers());I=n.F4b(I.getColumnNumbers());I=excelOnlineCalc.calc.rangeWrite(ba,
null,sa,I);this.V$[this.V$.length]=I}};n.prototype.S_g=function(I,ba,sa){var Oa=null,qb=0,Qa=0;switch(ba.valueType){case 2:Oa=this.whd(ba);var ib=this.whd(sa);ib=Ca.a.equals(ib,Oa,!1);break;case 1:null===ba.value&&null===sa.value?ib=!0:(qb=parseFloat(ba.value),ib=parseFloat(sa.value)===qb);break;default:null===ba.value&&null===sa.value?ib=!0:(Qa=parseFloat(ba.value),ib=Qa===parseFloat(sa.value))}ib&&ba.valueType===sa.valueType&&ba.ifmt===sa.ifmt&&ba.formulaType===sa.formulaType&&Ca.a.equals(sa.formula,
ba.formula,!1)||(void 0!==ba.formula&&null!==ba.formula||void 0!==ba.value&&null!==ba.value||void 0!==ba.text&&null!==ba.text?this.cZb(I,ba,Oa,qb,Qa):this.Yle(I,ba))};n.prototype.vBg=function(I){if(this.Tc.Hb&&this.Tc.Hb.items)for(var ba=0;ba<this.Tc.Hb.count;ba++){var sa=this.Tc.Hb.items[ba];if(2===sa.type||3===sa.type){var Oa=0,qb=sa.name,Qa=qb.lastIndexOf("!");if(0<Qa){Oa=qb.substr(0,Qa);"'"===Oa.charAt(0)&&(Oa=Oa.substr(1,Oa.length-2));Oa=this.Jgd(Oa,this.currentStateId);if(-1===Oa){L.ULS.sendTraceTag(595096334,
0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Ij?this.$e.oa(this.currentStateId).Ij.length:0);continue}qb=qb.substr(Qa+1)}Oa=this.$e.oa(this.currentStateId).Ij[Oa].g6;var ib=sa.usedRange;2===sa.type&&(ib=wc.a(sa));if(Oa.xb(qb)){if(Qa=Oa.oa(qb),ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(Qa.range=ib,Qa.attributes=sa.attributes),2===Qa.type&&
(qb=n.hTe(sa.name,I),sa=(Oa=ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc"))?sa.QO:null===qb||void 0===qb?void 0:qb.ColHeadersList,qb||Oa))if(!Qa.AE)Qa.AE=new v(sa);else if(sa)for(sa=El(sa.HeadersList),qb=sa.next();!qb.done;qb=sa.next())qb=qb.value,Qa.AE.D$.ia(qb.Index,qb.Name)}else if(Qa=this.mwb(sa.sheetName)){Qa=new E(sa.type,sa.name,ib,Qa,sa.attributes);if(2===Qa.type)if(ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6053425_loadHeadersForAllTablesCalc")&&sa.QO)Qa.AE=
new v(sa.QO);else if(sa=n.hTe(sa.name,I))Qa.AE=new v(sa.ColHeadersList);Oa.ia(qb,Qa)}else L.ULS.sendTraceTag(537170117,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Ij?this.$e.oa(this.currentStateId).Ij.length:0)}}};n.prototype.cZb=function(I,ba,sa,Oa,qb){var Qa=I.getRowNumbers()[ba.row]-1;I=I.getColumnNumbers()[ba.col]-1;Qa=n.OU("AddRangeUpdateCommand",this.Lrb,Qa,I,Qa,I);I=null;var ib=
ba.formula||ba.text,Mb=excelOnlineCalc.calc.blankValue,Jb=null;void 0!==ba.text&&null!==ba.text||void 0!==ba.value&&null!==ba.value||(sa="",Jb="This cell contains blanks only",0===ba.formulaType&&(ib=""));switch(ba.valueType){case 2:null!==sa&&(0===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData(ib,sa,ba.ifmt,Jb)),1===ba.formulaType&&(I=excelOnlineCalc.calc.cellFormulaCellData(ib,sa,ba.ifmt,Jb)),2===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData("",Mb,0,"This cell is a part of an array")));
break;case 1:isNaN(Oa)?L.ULS.sendTraceTag(537170116,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",ba.row,ba.col):(0===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData(ib,Oa,ba.ifmt,null)),1===ba.formulaType&&(I=excelOnlineCalc.calc.cellFormulaCellData(ib,Oa,ba.ifmt,null)),2===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData("",Mb,0,"This cell is a part of an array")));break;case 3:isNaN(qb)?L.ULS.sendTraceTag(537170115,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
ba.row,ba.col):(sa=1===qb?!0:!1,0===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData(ib,sa,ba.ifmt,null)),1===ba.formulaType&&(I=excelOnlineCalc.calc.cellFormulaCellData(ib,sa,ba.ifmt,null)),2===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData("",Mb,0,"This cell is a part of an array")));break;case 4:isNaN(qb)?L.ULS.sendTraceTag(537170114,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",ba.row,ba.col):(sa=excelOnlineCalc.calc.errorValue(qb),0===ba.formulaType&&
(I=excelOnlineCalc.calc.valueCellData(ib,sa,ba.ifmt,null)),1===ba.formulaType&&(I=excelOnlineCalc.calc.cellFormulaCellData(ib,sa,ba.ifmt,null)),2===ba.formulaType&&(I=excelOnlineCalc.calc.valueCellData("",Mb,0,"This cell is a part of an array")));break;default:I=excelOnlineCalc.calc.valueCellData("",Mb,ba.ifmt,null)}I&&(ba=excelOnlineCalc.calc.rangeWrite(Qa,I,null,null),this.V$[this.V$.length]=ba)};n.prototype.ZBg=function(I,ba){switch(ba.valueType){case 2:this.cZb(I,ba,this.whd(ba),null,0);break;
case 1:this.cZb(I,ba,null,parseFloat(ba.value),0);break;default:this.cZb(I,ba,null,null,parseFloat(ba.value))}};n.prototype.Yle=function(I,ba){var sa=I.getRowNumbers()[ba.row]-1;I=I.getColumnNumbers()[ba.col]-1;sa=n.OU("AddRangeUpdateCommandEmptyCell",this.Lrb,sa,I,sa,I);ba=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,ba.ifmt,null);ba=excelOnlineCalc.calc.rangeWrite(sa,ba,null,null);this.V$[this.V$.length]=ba};n.prototype.mwb=function(I){I=this.Jgd(I,this.currentStateId);
return 0<I?this.$e.oa(this.currentStateId).Ij[I].z7.sheetId:null};n.prototype.Jgd=function(I,ba){if(!this.$e.xb(ba))return L.ULS.sendTraceTag(537170113,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",ba),-1;var sa=this.$e.oa(ba);return sa.Ij?sa.getSheetIndex(I):(L.ULS.sendTraceTag(537170112,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",ba),-1)};n.prototype.ksj=function(){if(!this.$e.xb(this.currentStateId)||!this.$e.oa(this.currentStateId).Ij.length)return L.ULS.sendTraceTag(537170083,
0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var I=[],ba=1;ba<this.$e.oa(this.currentStateId).Ij.length;ba++){var sa=this.$e.oa(this.currentStateId).Ij[ba];sa&&I.push(sa.z7)}this.Xm.updateSheetNames(this.currentStateId,I);this.Xm.updateUnusedCells(this.currentStateId,this.$e.oa(this.currentStateId).Fbg);return!0};n.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var I=
[],ba=El(this.instantaneousSupportInformationManager.pca),sa=ba.next();!sa.done;sa=ba.next())sa=sa.value,sa=excelOnlineCalc.calc.numberFormat(sa.IfmtIndex,sa.FormatString,sa.Builtin),I.push(sa);this.Xm.setNumberFormats(I,!0)}};n.prototype.Loj=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Oe){var I=this.R$h();if(!this.Otd||I)this.E4b(),this.instantaneousSupportInformationManager.Oe.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Oe.TrueValueString),
this.instantaneousSupportInformationManager.Oe.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Oe.FalseValueString),I=La.CalcHelper.PDe(this.instantaneousSupportInformationManager,I),this.Xm.setLocale(I),this.Otd=!0}};n.prototype.atj=function(){var I=null;if(void 0!==this.Tc.workbookContext.TimeZoneInformation&&null!==this.Tc.workbookContext.TimeZoneInformation){I=null;this.Tc.workbookContext.TimeZoneInformation.StandardDate.Month&&(I=excelOnlineCalc.date.dateTime(this.Tc.workbookContext.TimeZoneInformation.StandardDate.Year,
this.Tc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Tc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Tc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Tc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Tc.workbookContext.TimeZoneInformation.StandardDate.Second,this.Tc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Tc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var ba=null;this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Month&&
(ba=excelOnlineCalc.date.dateTime(this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Hour,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Tc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,
3));I=excelOnlineCalc.date.tzData(this.Tc.workbookContext.TimeZoneInformation.Bias,I,this.Tc.workbookContext.TimeZoneInformation.StandardBias,ba,this.Tc.workbookContext.TimeZoneInformation.DaylightBias)}else L.ULS.sendTraceTag(537170082,0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");I=excelOnlineCalc.calc.workbookProps(this.Tc.workbookContext.F1904,this.Tc.workbookContext.FDateCompatibility,I);this.Xm.setWorkbookProps(I)};n.prototype.woa=function(){var I=this;ta.EwaSettings.ma(306)&&
Tb.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.P4f,!0)).continueWith(function(qb){qb.exception?L.ULS.sendTraceTag(537170079,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",qb.exception.toString()):L.ULS.sendTraceTag(537170080,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var ba=ta.EwaSettings.ma(660)?u.local:u.fIj,sa=El(Sb.a.XV()?[excelOnlineCalc.x10.PluginSchedulerSingleton.instance(),excelOnlineCalc.x10.GridImportManagerSingleton.instance()]:
[void 0,void 0]),Oa=sa.next().value;sa=sa.next().value;this.eHd=Tb.c(excelOnlineCalc.calc.createRecalcService(ba,Oa,sa));this.eHd.continueWith(function(qb){qb.exception?L.ULS.sendTraceTag(537170075,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",qb.exception.toString()):(L.ULS.sendTraceTag(537170078,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),I.Xm=I.eHd.result,I.Xm?I.afb(0)?I.Qqj():L.ULS.sendTraceTag(537170077,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):
L.ULS.sendTraceTag(537170076,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};n.prototype.R$h=function(){var I=this.instantaneousSupportInformationManager.gja;if(!I||this.dFd===I.length)return null;this.dFd=I.length;return La.CalcHelper.CDe(I)};n.prototype.E4b=function(){this.errorTypeNames=La.CalcHelper.E4b()};n.prototype.T$h=function(){if(!(this.$e.xb(this.currentStateId)&&0<this.$e.oa(this.currentStateId).Ij.length)){this.$e.ia(this.currentStateId,new y(this.Uhi));this.$e.oa(this.currentStateId).y_f(0,
new t(null));for(var I=this.Tc.xa,ba=0;ba<I.count;ba++){var sa=Object(Ha.a)(tc.a,I.getItem(ba));if(sa){void 0!==sa.sheetId&&null!==sa.sheetId&&void 0!==sa.name&&null!==sa.name&&sa.sheetId.length&&sa.sheetName.length||L.ULS.sendTraceTag(537170074,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",ba,sa.sheetId,sa.hash,sa.name?sa.name.length:-1);var Oa=excelOnlineCalc.calc.sheetName(sa.sheetId,sa.name);this.$e.oa(this.currentStateId).y_f(ba+1,
new t(Oa));Oa=sa.usedRange.SS();Oa=excelOnlineCalc.calc.rangeLocation(0,0,Oa.LastRow,Oa.LastColumn);sa=excelOnlineCalc.calc.unusedCellsUpdate(sa.sheetId,Oa);Array.add(this.$e.oa(this.currentStateId).Fbg,sa)}else L.ULS.sendTraceTag(537170073,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,ba)}}};n.prototype.sXg=function(){for(var I=El(this.$e),ba=I.next();!ba.done;ba=I.next())ba=ba.value,ba.key<this.jq&&this.$e.remove(ba.key)};n.prototype.whd=
function(I){I=I.value||I.text;if(void 0===I||null===I)I="";return I};n.prototype.sbg=function(){if(!this.$e.xb(this.currentStateId))return!1;var I=!1;Xa.a.forEach(this.$e.oa(this.currentStateId).p_a,function(ba,sa){sa.Cvc||(I=!0)},null);return I};n.prototype.T3c=function(I){var ba={};ba.reason=I;ba.kind=1;return ba};n.prototype.ihc=function(){return this.$e.xb(this.currentStateId)&&this.$e.oa(this.currentStateId).Ij&&this.$e.oa(this.currentStateId).Ij[0]&&this.$e.oa(this.currentStateId).Ij[0].g6?
!0:!1};n.Q4g=function(I){var ba=[];if(null===I||void 0===I?0:I.D$){I=El(I.D$);for(var sa=I.next();!sa.done;sa=I.next())sa=sa.value,sa=excelOnlineCalc.calc.columnData(sa.key,sa.value),ba.push(sa)}return ba};n.ICi=function(I,ba){if(I.type!==ba.type||I.attributes!==ba.attributes||!Ca.a.equals(I.fullName,ba.fullName,!1)||!I.range.equals(ba.range))return!1;if(!I.AE&&!ba.AE)return!0;if(!I.AE||!ba.AE||I.AE.D$.count!==ba.AE.D$.count)return!1;var sa={};I=El(I.AE.D$);for(var Oa=I.next();!Oa.done;sa={jgb:sa.jgb,
qgb:sa.qgb},Oa=I.next())if(sa.jgb=Oa.value,sa.qgb=void 0,!(sa.jgb.value&&function(qb){return function(){var Qa=ba.AE.D$.Nc(qb.jgb.key);qb.qgb=Qa.value;return Qa}}(sa)().returnValue&&sa.qgb&&Ca.a.equals(sa.jgb.value,sa.qgb,!1)))return!1;return!0};n.EUc=function(I,ba,sa){var Oa=n.OU("NamedObject",ba.sheetId,ba.range.top-1,ba.range.left-1,ba.range.bottom-1,ba.range.right-1);if(2===ba.type){var qb=!!(ba.attributes&16),Qa=!!(ba.attributes&8);ba=n.Q4g(ba.AE);Oa=excelOnlineCalc.calc.namedTableData(Oa,qb,
Qa,ba);I=excelOnlineCalc.calc.namedObject(I,Oa)}else Oa=excelOnlineCalc.calc.namedRangeData(Oa),I=excelOnlineCalc.calc.namedObject(I,Oa);sa.push(I)};n.ZWe=function(I){var ba=Sys.Serialization.JavaScriptSerializer.serialize(I.getRowNumbers());I=Sys.Serialization.JavaScriptSerializer.serialize(I.getColumnNumbers());return ba+I};n.F4b=function(I){var ba=null;if(1<I.length)for(var sa=1;sa<I.length;sa++)for(var Oa=0;I[sa-1]+1+Oa<I[sa];)ba=ba||[],ba.push(I[sa-1]+Oa),Oa++;return ba};n.hTe=function(I,ba){if(!ba)return null;
for(var sa=0,Oa=ba.length;sa<Oa;++sa)if(Ca.a.equals(I,ba[sa].Name,!1))return ba[sa];return null};n.OU=function(I,ba,sa,Oa,qb,Qa){function ib(Mb,Jb,Zb,ub){(0>Zb||Zb>=ub)&&L.ULS.sendTraceTag(537170072,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",Mb,Jb,Zb)}void 0!==ba&&null!==ba||L.ULS.sendTraceTag(537170071,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",I);ib(I,"top",sa,n.bpf);ib(I,"left",Oa,n.fwd);ib(I,"bottom",qb,n.bpf);ib(I,"right",
Qa,n.fwd);return excelOnlineCalc.calc.sheetRangeLocation(ba,sa,Oa,qb,Qa)};n.bpf=1048576;n.fwd=16384;Object(C.a)(n,"CalcAsyncEngine",null,[3]);Object(C.a)(w,"AbsoluteRelativeReferenceInfo",null,[]);var pb=b(1183),cb=b(25);h.gHf="#";Object(C.a)(h,"Operators",null,[]);var ob=b(1184);r.sheet="Sheet";r.sheetRange="SheetRange";r.document="Document";r.A7h="Ident";Object(C.a)(r,"TraverseFormulaQualifierTypes",null,[]);var rc=b(1185),Db=b(1083),Ja=b(1E3),Qb=b(55),yc=b(62),Cd=b(567);m.prototype.dispose=function(){var I=
this;L.ULS.sendTraceTag(537170064,0,50,"CalcManager.Dispose called");this.$.da.$a(268,function(ba){ba.sJd(I.Hnc);ba.jJd(I.nnc)});this.gridView&&(this.gridView.cx(this.onContentReady),this.gridView.Ea&&this.gridView.Ea.nPf(this.Xtf),this.fr=null);this.qsf=this.osf=this.eGc=null};m.prototype.dTg=function(I,ba,sa,Oa){Oa=void 0===Oa?null:Oa;this.Gl&&(ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.Gl.aTg(I,ba,sa,Oa):this.Gl.cTg(I,ba,sa,Oa))};m.prototype.evalFormula=
function(I){return this.Gl?this.Gl.evalFormula(I):Promise.reject("calc engine not initialized")};m.prototype.evalFormulaRange=function(I,ba,sa){return this.Gl?this.Gl.evalFormulaRange(I,ba,sa):Promise.reject("calc engine not initialized")};m.prototype.ltb=function(I,ba,sa,Oa){return this.Gl?this.Gl.ltb(I,ba,sa,Oa):Promise.reject("CalcEngine is null")};m.prototype.v4a=function(I){return this.Gl?(L.ULS.shipAssertTag(537170059,0,2===I.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),
this.Gl.v4a(I)):null};m.prototype.xIg=function(I,ba){if(!ba||2!==I.type)return!1;I=wc.a(I);return I.right-I.left+1===ba.count};m.prototype.QRe=function(I){if(!this.PFb)return this.Kfg||L.ULS.sendTraceTag(537170057,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var ba=this.eta(cb.Range.hd(1,1));ba=this.PFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,ba.range),I);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(ba))return L.ULS.sendTraceTag(537170056,0,10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),
null;try{if(ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var sa=this.gridView.ha.sa.activeCell,Oa=excelOnlineCalc.location.gridCell(sa.top-1,sa.left-1),qb=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),Qa=excelOnlineCalc.location.sheetIndex(qb,this.$.xa.qa.sheetId),ib=this.h9g(Oa,Qa);this.rLd||(this.rLd=excelOnlineCalc.util.createResolver(this.g9g()));var Mb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ba,
this.Ur.config.localeInfo,ta.EwaSettings.ma(601),ib,this.rLd)}else Mb=excelOnlineCalc.parse.parseResultHelper.extractReferences(ba,this.Ur.config.localeInfo,ta.EwaSettings.ma(601));ta.EwaSettings.ma(103)&&this.aSj(Mb,I);return Mb}catch(Jb){return L.ULS.sendTraceTag(537170055,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",Jb.message),null}};m.prototype.extractLetVariables=function(I,ba){if(!this.PFb)return this.Kfg||L.ULS.sendTraceTag(537170054,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),
null;var sa=this.eta(cb.Range.hd(1,1));I=this.PFb.parseFormula(excelOnlineCalc.parse.parseLocals(1,sa.range),I);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(I))return L.ULS.sendTraceTag(537170053,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(I,ba,this.Ur.config.localeInfo)}catch(Oa){return L.ULS.sendTraceTag(537170052,0,10,"CalcManager.ExtractLetVariables - exception: {0}",Oa.message),null}};m.prototype.extractReferences=
function(I,ba,sa,Oa){if(!ba)return L.ULS.sendTraceTag(537170051,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!sa)return L.ULS.sendTraceTag(537170050,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var qb=this.QRe(I);if(!qb)return L.ULS.sendTraceTag(537170049,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),null;try{return this.f8g(qb,ba,sa,I,Oa)}catch(Qa){return L.ULS.sendTraceTag(537170048,0,10,"CalcManager.ExtractReferences - exception: {0}",
Qa.message),null}};m.prototype.lYh=function(I,ba,sa,Oa){if(!I)return L.ULS.sendTraceTag(537170019,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!ba||0>=ba.length)return L.ULS.sendTraceTag(537170018,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;I=this.eta(I);if(!this.Ur||!I)return null;var qb=this.Xub(I).returnValue;if(!qb||qb.i6a)return null;sa=excelOnline.utils.getCharIndexInTextFromPoint(sa,Oa,ta.EwaSettings.ma(601));
return 0>sa?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.Ur.config,sa,ba,I)};m.prototype.SSg=function(I,ba,sa,Oa){var qb=this;if(!I)return L.ULS.sendTraceTag(537170017,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var Qa=null;return this.evalFormula(ba).then(function(ib){var Mb=qb.Ur.Olh(ib,sa),Jb=Mb.returnValue;8!==Mb.kind||Jb.length&&Jb!==La.CalcHelper.unknownError?ib=0:(L.ULS.sendTraceTag(537170016,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),
ib=excelOnlineCalc.calc.getEvalFailureReason(ib),void 0!==ib&&null!==ib||L.ULS.shipAssertTag(537170015,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),ib=1);return Qa=Oa?new pb.a(Jb,Oa.start,Oa.end,ib):new pb.a(Jb,-1,-1,ib)},function(ib){L.ULS.sendTraceTag(537170014,0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",ib);return Promise.resolve(Qa)})};m.prototype.getSubExpressionSpan=function(I){return this.Ur&&I?excelOnlineCalc.runtime.getSubExpressionSpan(I):
null};m.prototype.getFormulaSubExpressionObject=function(I,ba,sa){return this.Ur&&I&&ba&&sa?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.Ur.config,ba,sa,this.eta(I)):null};m.prototype.oYh=function(I,ba,sa){return this.Ur&&I&&ba?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.Ur.config,ba,sa,this.eta(I)):null};m.prototype.mYh=function(I,ba,sa){return this.Ur&&I&&ba?excelOnlineCalc.runtime.getSubExpressionSubspans(this.Ur.config.localeInfo,ba,sa):null};m.prototype.CRh=function(){return this.Ur?
this.Ur.config.localeInfo.listSeparator:null};m.prototype.isFormulaSubExpressionVolatile=function(I){return this.Ur?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.Ur.config.localeInfo,I):!1};m.prototype.eta=function(I,ba){ba=void 0===ba?!0:ba;return I&&this.Ur?this.Ur.F9g(this.Ur.rah(),I.top-1,I.left-1,ba):null};m.prototype.Jhi=function(I,ba){I=this.Tbc(I);if(void 0===I||null===I)return null;I=this.Eo.createFormat(I.FormatString,I.Builtin);if(!excelOnlineCalc.util.isSuccess(I))return null;
ba=this.Eo.parseEdit(ba,I.value);return excelOnlineCalc.util.isSuccess(ba)?ba.value.kind===Db.a.formula:null};m.prototype.Dfd=function(I){if(!I.isValid())return L.ULS.sendTraceTag(537170013,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",null!=I.PQ?I.PQ.toString():"null",I.formatString?Ca.a.BJ(I.formatString):"null",I.numberFormat?"!null":"null"),null;var ba=I.oQh();if("String"===Object.getType(ba).getName())var sa=this.qsf;else if("Number"===
Object.getType(ba).getName())sa=this.osf;else return L.ULS.sendTraceTag(537170012,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;ba=ba.toString();if(ba in sa)return sa[ba].numberFormat;sa[ba]=I;return I.numberFormat};m.prototype.Rbc=function(I){if(null==this.Eo)return Object(Cd.a)("Number formatter is null");if(null==this.instantaneousSupportInformationManager)return Object(Cd.a)("Instantaneous manager is null");if(this.Myd.has(I))return Object(Cd.d)(this.Myd.get(I));if("number"===
typeof I){var ba=this.Tbc(I);if(null==ba)return Object(Cd.a)("Invalid ifmt="+I);var sa=ba.FormatString;ba=ba.Builtin}else sa=I,ba=!1;sa=this.Eo.createFormat(sa,ba);return excelOnlineCalc.util.isSuccess(sa)?(this.Myd.set(I,sa.value),Object(Cd.d)(sa.value)):Object(Cd.a)("Could not create number format")};m.prototype.getWorksheetFuncId=function(I){return this.localeInfo.getWorksheetFuncId(I)};m.prototype.f8g=function(I,ba,sa,Oa,qb){for(var Qa={Items:[]},ib=0;ib<I.length;ib++){var Mb=I[ib],Jb={};Jb.Start=
Mb.span.start;Jb.End=Mb.span.end;if(qb||Mb.kind!==ob.a.func)if(qb||Mb.kind!==ob.a.Sri){if(this.$gh(Mb,ba,sa)){var Zb=new w,ub=this.iVh(Mb,ba,Zb,Oa);if(ta.EwaSettings.ma(601)){var Za=this.sRh(Mb),vc=this.rRh(Mb);if(ub||vc&&0<=Za)Jb={Span:Jb,LetNumber:Za,LetName:vc,Range:ub},Jb.IsRangeRef=Zb.S6a,Jb.IsAbsoluteFirstRow=Zb.qwa,Jb.IsAbsoluteFirstColumn=Zb.pwa,Jb.IsAbsoluteSecondRow=Zb.MLa,Jb.IsAbsoluteSecondColumn=Zb.LLa,Jb.IsStructRef=Mb.kind===ob.a.jUd,Qa.Items.push(Jb)}else ub&&(Jb={Span:Jb,Range:ub},
Jb.IsRangeRef=Zb.S6a,Jb.IsAbsoluteFirstRow=Zb.qwa,Jb.IsAbsoluteFirstColumn=Zb.pwa,Jb.IsAbsoluteSecondRow=Zb.MLa,Jb.IsAbsoluteSecondColumn=Zb.LLa,Jb.IsStructRef=Mb.kind===ob.a.jUd,Qa.Items.push(Jb))}}else Mb=Mb.ref.value.oper.kind,Qa.Items.push({Span:Jb,IsString:2===Mb,IsBoolean:4===Mb,IsNumber:1===Mb});else Jb.End=Mb.span.start+Mb.ref.name.length,Mb={Span:Jb,IsFunction:!0},Mb.FunctionId=this.getWorksheetFuncId(Oa.substring(Jb.Start,Jb.End)),Qa.Items.push(Mb)}Qa.Items.sort(function(zc,kd){return zc.Span.Start-
kd.Span.Start});return Qa};m.prototype.sRh=function(I){return I.kind===ob.a.Ujf?I.ref.number:-1};m.prototype.rRh=function(I){return I.kind===ob.a.Ujf?I.ref.name:null};m.prototype.iVh=function(I,ba,sa,Oa){if(I.kind===ob.a.range)return sa.S6a=!0,this.RBe(I,ba,sa,Oa);if(I.kind===ob.a.namedRange){sa=I.ref;(I=this.$.Hb.getItemByName(sa.name))||(I=this.$.Hb.getItemByName(ba+"!"+sa.name));if(!(I&&I.sheetName&&I.usedRange&&Ca.a.equals(I.sheetName,ba,!0)))return null;ba=2===I.type?wc.a(I):I.usedRange;return gb.m(ba,
I)}if(I.kind===ob.a.jUd){var qb=I.ref,Qa;qb.name?(Qa=this.$.Hb.getItemByName(qb.name))||(Qa=this.$.Hb.getItemByName(ba+"!"+qb.name)):Qa=this.gridView.Rb.Qj(this.gridView.ha.sa.activeCell);if(!(Qa&&Qa.sheetName&&Qa.usedRange&&Ca.a.equals(Qa.sheetName,ba,!0)))return null;sa.S6a=!1;return this.RBe(I,ba,sa,Oa)}return null};m.prototype.RBe=function(I,ba,sa,Oa){I=I.ref;if(I.type){if(I.type===rc.a.column){var qb=I.startIndex;I=I.endIndex;sa.pwa=qb.kind===Ja.a.abs;sa.LLa=I.kind===Ja.a.abs;return this.createRange(0,
qb.index,D.a.Hh,I.index,ba)}if(I.type===rc.a.row)return qb=I.endIndex,sa.qwa=I.startIndex.kind===Ja.a.abs,sa.MLa=qb.kind===Ja.a.abs,this.createRange(I.startIndex.index,0,I.endIndex.index,D.a.Qh,ba);if(I.type===rc.a.cell){qb=I.row;var Qa=I.col;sa.qwa=sa.MLa=qb.kind===Ja.a.abs;sa.pwa=sa.LLa=Qa.kind===Ja.a.abs;return this.a2b(I.span.end,Oa)&&(sa=cb.Range.hd(qb.index+1,Qa.index+1),sa=this.gridView.Rb.s2e(sa))?gb.n(sa,ba):this.createRange(qb.index,Qa.index,qb.index,Qa.index,ba)}if(I.type===rc.a.range){qb=
I.top;Qa=I.left;Oa=I.bottom;I=I.right;var ib=Math.min(qb.index,Oa.index),Mb=Math.min(Qa.index,I.index),Jb=Math.max(qb.index,Oa.index),Zb=Math.max(Qa.index,I.index);sa.qwa=qb.kind===Ja.a.abs;sa.MLa=Oa.kind===Ja.a.abs;sa.pwa=Qa.kind===Ja.a.abs;sa.LLa=I.kind===Ja.a.abs;return this.createRange(ib,Mb,Jb,Zb,ba)}L.ULS.sendTraceTag(537170010,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",I.type);return null}L.ULS.sendTraceTag(537170011,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");
return null};m.prototype.a2b=function(I,ba){return ba.length>=I&&0<I&&ba.charAt(I-1)===h.gHf};m.prototype.YSg=function(I,ba,sa){this.Gl&&this.Gl.bTg(I,ba,sa)};m.prototype.Tbc=function(I){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.pca&&this.instantaneousSupportInformationManager.pca[I]&&this.Eo?this.instantaneousSupportInformationManager.pca[I]:null};m.prototype.toXLNumber=function(I){if(!this.Eo)return null;I=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,
this.Eo,I);return excelOnlineCalc.util.isSuccess(I)?I.value:null};m.prototype.aSj=function(I,ba){if(I){I=El(I);for(var sa=I.next();!sa.done;sa=I.next())if(sa=sa.value,sa.ref.type&&sa.ref.type===rc.a.cell){var Oa=sa.ref;m.vZi(Oa,ba)&&(Oa.span.end+=1,sa.span.end+=1)}}};m.prototype.createRange=function(I,ba,sa,Oa,qb){var Qa={};Qa.FirstRow=I;Qa.FirstColumn=ba;Qa.LastRow=sa;Qa.LastColumn=Oa;Qa.SheetName=qb;return Qa};m.prototype.$gh=function(I,ba,sa){var Oa=I.ref.qualifier;if(!Oa)return!0;switch(I.ref.qualifier.type){case r.sheet:return I=
Oa.document,Ca.a.equals(Oa.sheet,ba,!0)&&(!I||Ca.a.equals(I.document,sa,!0));case r.sheetRange:return ba=this.$.xa.getItemByName(ba),sa=this.$.xa.getItemByName(Oa.sheet1),Oa=this.$.xa.getItemByName(Oa.sheet2),!!ba&&!!sa&&!!Oa&&(sa.index<=ba.index&&ba.index<=Oa.index||Oa.index<=ba.index&&ba.index<=sa.index);case r.document:return Ca.a.equals(Oa.document,sa,!0);case r.A7h:return Oa=Oa.name,Ca.a.equals(Oa,ba,!0)||Ca.a.equals(Oa,sa,!0);default:return L.ULS.sendTraceTag(537170009,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",
Oa.type),!1}};m.prototype.FMj=function(I){this.instantaneousSupportInformationManager=I;I.pca.length&&I.gja.length?(this.eGc=new La.CalcHelper(this.gridView.$),this.PFb=this.Ur.createParser(),this.cce=this.Ur.createNumberFormatter(),this.pbf=!0,L.ULS.sendTraceTag(537170007,0,50,"CalcManager.TryInitializeInternal: calc initialized"),this.Gl||(L.ULS.sendTraceTag(537170006,0,50,"CalcManager creating calc engine"),this.Gl=new n(this.$))):L.ULS.sendTraceTag(537170008,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",
I.pca.length,I.gja.length.toString())};m.prototype.Xub=function(I){if(!I)return{returnValue:null,emptyCell:!1};var ba=this.getSheetName(I.sheet.index);if(!ba)return L.ULS.sendTraceTag(537169998,0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",I.sheet.index),{returnValue:null,emptyCell:!1};var sa=m.convertToRange(I);ba=this.gridView.Xub(ba,sa.top,sa.left);return ba?ba.Vgh?{returnValue:ba,emptyCell:!1}:(L.ULS.sendTraceTag(537169996,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",
I.range.row,I.range.col),{returnValue:null,emptyCell:!0}):(L.ULS.sendTraceTag(537169997,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",I.range.row,I.range.col),{returnValue:null,emptyCell:!1})};m.prototype.getSheetName=function(I){var ba=this.gridView.$.xa.getItem(I);return ba?ba.sheetName:(L.ULS.sendTraceTag(537169995,0,50,"CalcManager.GetSheetName - no sheet in index {0}",I),null)};m.prototype.h9g=function(I,ba){var sa={allowUnqualifiedCell:!0,wrapCellReferences:!0};
sa.config=this.Ur.config;sa.originGridCell=excelOnlineCalc.util.success(I);sa.originSheet=excelOnlineCalc.util.success(ba);return sa};m.prototype.g9g=function(){var I={};I.config=this.Ur.config;I.getNameLoc=Object(qa.a)(this.Gl,this.Gl.getNameLoc,"getNameLoc");I.getContainingTable=Object(qa.a)(this.Gl,this.Gl.getContainingTable,"getContainingTable");I.getStructRefColumn=Object(qa.a)(this.Gl,this.Gl.getStructRefColumn,"getStructRefColumn");I.getStructRefSpecialRef=Object(qa.a)(this.Gl,this.Gl.getStructRefSpecialRef,
"getStructRefSpecialRef");I.getDocumentLoc=Object(qa.a)(this.Gl,this.Gl.getDocumentLoc,"getDocumentLoc");I.getSheetIndex=Object(qa.a)(this.Gl,this.Gl.getSheetIndex,"getSheetIndex");I.getSheetName=Object(qa.a)(this.Gl,this.Gl.getSheetName,"getSheetName");I.getUserDefinedFuncLoc=Object(qa.a)(this.Gl,this.Gl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");I.getSheetRangeIndexes=Object(qa.a)(this.Gl,this.Gl.getSheetRangeIndexes,"getSheetRangeIndexes");return I};m.vZi=function(I,ba){return ba.length>I.span.end&&
ba.charAt(I.span.end)===h.gHf};m.convertToRange=function(I){return cb.Range.hd(I.range.row+1,I.range.col+1)};Ek.Object.defineProperties(m.prototype,{Ur:{configurable:!0,enumerable:!0,get:function(){return this.eGc}},gridView:{configurable:!0,enumerable:!0,get:function(){return this.fr}},$:{configurable:!0,enumerable:!0,get:function(){return this.wb}},Eo:{configurable:!0,enumerable:!0,get:function(){return this.cce}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.Ur?this.Ur.config.localeInfo:
null}},config:{configurable:!0,enumerable:!0,get:function(){return this.Ur.config}}});Object(C.a)(m,"CalcManager",null,[678,3]);var bc=b(36),Kb=b(54),ic=ca.a;Am(l,ic);l.prototype.create=function(){var I=this;if(this.$){L.ULS.sendTraceTag(537169993,0,50,"CalcManagerFactory.Create: Start loading script");if(ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var ba=53;var sa="Current"}else ba=56,sa="Stable";L.ULS.sendTraceTag(537169992,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",
sa);bc.TaskExtensions.Ba(Kb.a.loadScript(ba,4,this.ub,void 0,void 0,265),function(){L.ULS.sendTraceTag(537169991,0,50,"CalcManagerFactory.Create: Raised create service event");var Oa=I.$.da.Aa(266,!1);Oa||(L.ULS.sendTraceTag(537169990,0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Oa=new m(I.$));I.Eb(Oa)},this.la,3)}else L.ULS.sendTraceTag(537169994,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};l.ka=function(I){I&&I.da&&
I.da.Ga(265,new l(I))};Object(C.a)(l,"CalcManagerFactory",ca.a,[]);var wb=b(7),Wa=b(5),Xb=b(337);Object(C.a)(f,"MarqueeMetadata",null,[]);var Gc=b(141),zb=b(699),hc=b(354);e.prototype.IX=function(I,ba){this.cji&&I.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");if(this.s7f||I.rK)return!1;var sa=void 0===ba||null===ba?I.text:ba;if(this.calcManager&&1<sa.length&&kb.e(sa)){var Oa=this.Rfd(),qb=this.y0e(),Qa=this.Tc.workbookContext.WorkbookFileName,ib=!1,Mb=.01>Math.random()?
Object(Ha.a)(Gc.a,this.Tc.Ob.Gc("LoadingUIShown","ColoredReferencesManager")):null;try{var Jb=this.calcManager.extractReferences(sa,qb,Qa,!this.Uaf);if(!Jb)return L.ULS.sendTraceTag(524039689,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),!1;qb=[];Qa=[];for(var Zb=[],ub=[],Za=0,vc=0,zc=new xa.a(!1),kd="",wa=El(Jb.Items),Na=wa.next();!Na.done;Na=wa.next()){var Vb=Na.value;ib=Vb.IsStructRef||ib;if(Vb.IsBoolean||Vb.IsNumber||Vb.IsString){var pc=
Vb.IsBoolean?e.pOg:Vb.IsNumber?e.cEi:e.oFj;this.FFa(Qa,sa,Za,Vb.Span.Start,null);this.FFa(Qa,sa,Vb.Span.Start,Vb.Span.End,pc);Za=Vb.Span.End}else if(ta.EwaSettings.ma(601)){if(Vb.Range||Vb.LetName&&0<=Vb.LetNumber){Jb=null;if(Vb.Range){var hd=gb.D(Vb.Range);Jb=this.cvb(hd,zc,1);qb.push(new hc.a(hd,Oa))}else Vb.LetName&&0<=Vb.LetNumber&&(Jb=kd=this.OKh(Vb.LetName,Vb.LetNumber,zc,kd),vc!==zc.count&&I.colors.add(Vb.Span.Start+"-"+Vb.Span.End,this.colors[(zc.count-1)%this.colors.length]));this.FFa(Qa,
sa,Za,Vb.Span.Start,null);this.FFa(Qa,sa,Vb.Span.Start,Vb.Span.End,Jb);Za=Vb.Span.End;Zb.push(Vb.Span);var Ud=Qa.length-1;ub.push(new f(Ud,Qa[Ud].text,Vb));vc=zc.count}}else if(Vb.Range){var Zc=gb.D(Vb.Range),Ob=this.cvb(Zc,zc,1);this.FFa(Qa,sa,Za,Vb.Span.Start,null);this.FFa(Qa,sa,Vb.Span.Start,Vb.Span.End,Ob);qb.push(new hc.a(Zc,Oa));Za=Vb.Span.End;Zb.push(Vb.Span);var Ad=Qa.length-1;ub.push(new f(Ad,Qa[Ad].text,Vb))}}this.FFa(Qa,sa,Za,sa.length,null);this.Hsj(I,Qa,!!ba);var we=I.textBox.text;if(!Ca.a.equals(we,
sa,!1)){L.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",we.length,sa.length);var Wd=I.textBox.caretPosition;I.textBox.text=sa;I.textBox.caretPosition=Wd;return!0}this.hec(qb,zc,ub);ta.EwaSettings.ma(601)&&0<qb.length&&L.ULS.sendTraceTag(524039688,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");
ta.EwaSettings.ma(601)&&0<I.colors.count&&L.ULS.sendTraceTag(524039687,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.C5a=!0}finally{Mb&&Mb.XAa(function(){ib&&L.ULS.sendTraceTag(524039686,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",Mb.Bc)})}}else return this.hec(null,null),this.C5a&&(this.C5a=!1,Oa=I.textBox.caretPosition,I.textBox.setPlainText(sa),I.textBox.caretPosition=Math.min(Oa,
sa.length),ba)?!0:!1};e.prototype.lqf=function(I,ba,sa){if(!I||!ba||!sa)return L.ULS.shipAssertTag(524039685,0,!!I,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),L.ULS.shipAssertTag(524039684,0,!!ba,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),L.ULS.shipAssertTag(524039683,0,!!sa,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var Oa=Object(Ha.a)(f,ba.metadata);if(!Oa)return L.ULS.shipAssertTag(524039682,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),
!1;var qb=Oa.QHj,Qa=Oa.z8f,ib=this.gridView.Rb.pcf(sa)?sa.$ac(Oa.pwa,Oa.qwa):sa.n4a(Oa.pwa,Oa.qwa,Oa.LLa,Oa.MLa);if(!ib)return L.ULS.shipAssertTag(524039681,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),!1;var Mb=Qa.indexOf("!");-1!==Mb&&(ib=Qa.substring(0,Mb+1)+ib);if(!I.textBox.changeTextInExistingTextPart(qb,Qa,ib))return L.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Oa.z8f=ib;qb=!0;for(Qa=1;4>=Qa;Qa++)(ib=
Gb.g(this.Tc).Cb.Hw(3,Qa,ba.E$))?(ib.range=sa,ib.metadata=Oa):(L.ULS.shipAssertTag(524039680,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),qb=!1);this.gridView.Cb.update(!1,!1);this.gridView.Dj&&(this.gridView.wc.textBox.text=I.text);this.gridView.wc.TGb(new Xb.a({Uyb:!0}));return qb};e.prototype.gji=function(I){if(3!==I.ur)return L.ULS.shipAssertTag(524039651,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;I=Object(Ha.a)(f,
I.metadata);return I?I.S6a&&!I.Ihc:(L.ULS.shipAssertTag(524039650,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};e.prototype.$db=function(I,ba){L.ULS.sendTraceTag(524039649,0,50,"ColoredReferencesManager.SuspendResumeColoredReferences: "+(ba?"suspending":"resuming")+" colored references");ba&&this.C5a&&(this.C5a=!1,this.hec(null,null),I.textBox.PXg());this.s7f=ba};e.prototype.dispose=function(){this.gridView&&this.gridView.rc&&this.gridView.rc.Dn(this.RDb)};
e.prototype.x6h=function(I){var ba=this.Rfd(),sa=this.y0e(),Oa=this.Tc.workbookContext.WorkbookFileName,qb=[],Qa=new xa.a(!1),ib=[];if(sa=this.calcManager.extractReferences(I,sa,Oa,!this.Uaf)){sa=El(sa.Items);for(Oa=sa.next();!Oa.done;Oa=sa.next())if(Oa=Oa.value,Oa.Range){var Mb=gb.D(Oa.Range);qb.push(new hc.a(Mb,ba));this.cvb(Mb,Qa,1);ib.push(new f(Oa.Span.Start,I.substring(Oa.Span.Start,Oa.Span.End),Oa,!0))}this.hec(qb,Qa,ib)}};e.prototype.cvb=function(I,ba,sa){var Oa=ba.getItem(I.toString());Oa||
(Oa=this.colors[ba.count%this.colors.length],ba.add(I.toString(),Oa));return String.format(Oa,sa)};e.prototype.OKh=function(I,ba,sa,Oa){I="["+I+", "+ba+"]";ba=sa.getItem(I);ba||(ba=sa.count%this.colors.length,ba=this.colors[ba],Oa===String.format(ba,1)&&(sa.add("skip-"+I,ba),ba=sa.count%this.colors.length,ba=this.colors[ba]),sa.add(I,ba));return String.format(ba,1)};e.prototype.FFa=function(I,ba,sa,Oa,qb){L.ULS.shipAssertTag(524039648,0,sa<=Oa,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");
sa<Oa&&(ba=ba.substring(sa,Oa),I.push(Object(wb.a)(new zb.a,{text:ba,color:qb})))};e.prototype.hec=function(I,ba,sa){var Oa=this;sa=void 0===sa?null:sa;I&&I.length?(L.ULS.sendTraceTag(524039647,0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+I.length),I.reverse(),sa.reverse(),this.gridView.Cb.jx(I,[3],!0,function(qb,Qa){if(qb&&qb.range&&Qa){L.ULS.shipAssertTag(524039643,0,ba.xb(qb.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",
qb.range.toString());var ib=Oa.cvb(qb.range,ba,.1),Mb=Oa.cvb(qb.range,ba,1);Oa.Tc.frame&&Oa.Tc.frame.LH&&Oa.Tc.frame.LH.zka||(Qa.style.background=ib);Qa.style.borderColor=Mb;sa&&(Qa.setAttribute(Wa.a.Wxb,qb.E$.toString()),qb.metadata=sa[qb.E$])}else L.ULS.shipAssertTag(524039646,0,!!qb,"ColoredReferencesManager.HighlightRanges: state is null"),L.ULS.shipAssertTag(524039645,0,!!qb.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),L.ULS.shipAssertTag(524039644,0,!!Qa,"ColoredReferencesManager.HighlightRanges: div is null")})):
(I=this.Tc.Ob.Gc("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Cb.Nh([3]),this.gridView.Cb.FKb(new hc.a(null,this.Rfd()),[3]),I.stop())};e.prototype.Hsj=function(I,ba,sa){var Oa=I.textBox;Oa.kK=!0;var qb=Oa.selection,Qa=qb.index;qb=Qa+qb.length;Oa.setTextFromTextParts(ba);ba=Oa.text.length;Oa.selectRange(Math.min(Qa,ba),Math.min(qb,ba));sa&&I.TGb(new Xb.a);Oa.kK=!1};e.prototype.Rfd=function(){return this.x0e().sheetId};e.prototype.y0e=function(){return this.x0e().sheetName};e.prototype.x0e=
function(){return this.gridView.yt&&this.gridView.yt.TK?this.gridView.yt.TK:this.Tc.qa};e.cEi="rgba(9, 134, 88, 1)";e.pOg="rgba(0, 0, 255, 1)";e.oFj="rgba(163, 21, 21, 1)";Object(C.a)(e,"ColoredReferencesManager",null,[675,3]);var Uc=ca.a;Am(c,Uc);c.prototype.create=function(){var I=this;this.$.da.$a(266,function(ba){ba=ta.EwaSettings.em()?I.$.da.Aa(281)||I.$.da.Ga(281,new e(I.$,ba)):new e(I.$,ba);I.Eb(ba)})};c.ka=function(I){I.da.Ga(282,new c(I))};Object(C.a)(c,"ColoredReferencesManagerFactory",
ca.a,[]);var jb=b(1014),$a=ca.a;Am(a,$a);a.prototype.create=function(){var I=this;this.$.da.$a(266,function(ba){ba=ta.EwaSettings.em()?I.$.da.Aa(294)||I.$.da.Ga(294,new jb.RelativeAndAbsoluteReferencesManager(ba)):new jb.RelativeAndAbsoluteReferencesManager(ba);I.Eb(ba)})};a.ka=function(I){I.da.Ga(295,new a(I))};Object(C.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",ca.a,[]);Type.registerNamespace("_Ewa");x.a.Fa(z.ka);x.a.Fa(l.ka);x.a.Fa(c.ka);x.a.Fa(a.ka)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDS.calc.js.map/34c9fbc05dd310377ffa76f493da3086/EwaDS.calc.js.map